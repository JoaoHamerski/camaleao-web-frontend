import{G as c,L as d}from"./BankEntry-8eefdd6d.js";import{n as s,aq as u,ar as p,N as y,i as r,b as m,P as f,z as _,r as h,as as v,D as C}from"./index-fae63e1f.js";import{G as b}from"./Order-7b0e72c5.js";import{D as l}from"./DailyPaymentModal-355556e3.js";import{M as o}from"./ModalExpensesNew-c98dcb28.js";import{c as g,d as E}from"./SelectEntriesFind-e5d39e3c.js";import"./_PaginatorFragment-c01a3fe7.js";import"./ActivityFragments-a3df58d3.js";import"./DailyPaymentForm-1ae5e719.js";import"./Via-eb0eedf9.js";import"./Payment-7f758fb7.js";import"./DailyCash-da8f8b01.js";import"./PaymentExpense-9583d97d.js";import"./masks-168ccaff.js";import"./SelectClientsFind-0687f9cc.js";import"./Resources-b591129f.js";import"./omit-574aa98c.js";import"./_flatRest-a6acb8a9.js";import"./ExpensesForm-9d8c3592.js";import"./filesMixin-e7ac34d1.js";import"./filter-58b32e89.js";import"./pasteFilesMixin-1129ca11.js";import"./Expense-8b8780bc.js";import"./User-8fb57da5.js";import"./ViewerItemsCardFile-6146f446.js";import"./vue-load-image-65c59e9a.js";import"./has-1f08a56a.js";import"./truncate-9ccec01d.js";const x={apollo:{bankEntries:{query:c,variables(){return{first:6,page:this.page}}}},props:{entry:{type:Object,default:()=>({})},isLoading:{type:Boolean,default:!1}},data(){return{bankEntries:{data:[],paginatorInfo:{}},icons:{faDownload:u,faSync:p},page:1}},computed:{isLoadingQuery(){return!!this.$apollo.queries.bankEntries.loading}},methods:{formatDatetime:y,isEmpty:r,refresh(){this.$apollo.queries.bankEntries.refetch()},onEntryClick(n){this.$emit("load-entry",n)},isActive(n){var e;return n.filename===((e=this.entry)==null?void 0:e.filename)}}};var k=function(){var e=this,t=e._self._c;return t("AppContainer",{attrs:{collapsible:"",value:!0},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Lista de entradas bancárias ")]},proxy:!0},{key:"body",fn:function(){return[t("AppLoading",{directives:[{name:"show",rawName:"v-show",value:e.isLoadingQuery||e.isLoading,expression:"isLoadingQuery || isLoading"}],staticClass:"py-5"}),e.bankEntries.data.length?t("div",{staticClass:"row row-cols-1 row-cols-sm-3 gx-0 mb-2"},e._l(e.bankEntries.data,function(a){return t("button",{key:a.id,staticClass:"btn d-flex align-items-center",class:e.isActive(a)?"btn-outline-success":"btn-outline-primary",on:{click:function(i){return i.preventDefault(),e.onEntryClick(a)}}},[t("div",{staticClass:"me-2"},[t("FontAwesomeIcon",{attrs:{icon:e.icons.faDownload,size:"lg"}})],1),t("div",{staticClass:"text-start text-truncate"},[t("div",{staticClass:"text-truncate"},[e._v(" "+e._s(a.filename)+" ")]),t("span",{staticClass:"datetime text-secondary"},[e._v(e._s(e.formatDatetime(a.created_at)))])])])}),0):t("div",{staticClass:"text-center text-secondary small my-5"},[e._v(" Nenhuma entrada encontrada ")]),t("div",{staticClass:"d-flex flex-column flex-sm-row justify-content-between"},[t("AppPaginator",{attrs:{pagination:e.bankEntries.paginatorInfo},model:{value:e.page,callback:function(a){e.page=a},expression:"page"}}),t("AppButton",{attrs:{outlined:"","btn-class":"btn-sm",icon:e.icons.faSync},on:{click:function(a){return a.preventDefault(),e.refresh.apply(null,arguments)}}})],1)]},proxy:!0}])})},$=[],w=s(x,k,$,!1,null,"9078d3ae",null,null);const D=w.exports,L={props:{fileEntry:{type:Object,required:!0}},data(){return{hideDuplicates:!1,hideCanceled:!1,icons:{faExclamationCircle:m}}},computed:{entriesCount(){return this.fileEntry.entries.length},duplicatesCount(){return this.fileEntry.entries.filter(n=>n.isDuplicated).length},canceledCount(){return this.fileEntry.entries.filter(n=>n.isCanceled).length}},watch:{fileEntry(){this.hideDuplicates=!1,this.hideCanceled=!1}},methods:{onHideDuplicatesClick(){this.$emit("hide-duplicates",!this.hideDuplicates)},onHideCanceledClick(){this.$emit("hide-canceled",!this.hideCanceled)}}};var A=function(){var e=this,t=e._self._c;return t("div",[t("span",{staticClass:"badge bg-primary mb-2"},[e._v(" "+e._s(e.entriesCount)+" entradas carregadas ")]),t("span",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"badge bg-secondary ms-1 mb-2",attrs:{content:"Já constam no banco de dados"}},[e._v(" "+e._s(e.duplicatesCount)+" duplicadas ")]),t("span",{staticClass:"badge ms-1 bg-secondary mb-2"},[e._v(" "+e._s(e.canceledCount)+" canceladas ")]),t("div",{staticClass:"d-flex"},[t("AppCheckboxSwitch",{staticClass:"me-2",attrs:{id:"hideDuplicatesCheckbox"},on:{input:e.onHideDuplicatesClick},model:{value:e.hideDuplicates,callback:function(a){e.hideDuplicates=a},expression:"hideDuplicates"}},[e._v(" Ocultar duplicatas ")]),t("AppCheckboxSwitch",{attrs:{id:"hideCanceledCheckbox"},on:{input:e.onHideCanceledClick},model:{value:e.hideCanceled,callback:function(a){e.hideCanceled=a},expression:"hideCanceled"}},[e._v(" Ocultar cancelados ")])],1),t("div",{staticClass:"small text-secondary"},[t("span",{directives:[{name:"tippy",rawName:"v-tippy"}],attrs:{content:"Significa que ela já consta no banco de dados de Pagamentos ou Despesas do sistema."}},[t("FontAwesomeIcon",{attrs:{icon:e.icons.faExclamationCircle,"fixed-width":""}}),e._v(" Entradas duplicadas ou canceladas são marcadas em cinza. ")],1),t("div",[t("FontAwesomeIcon",{attrs:{icon:e.icons.faExclamationCircle,"fixed-width":""}}),e._v(" Entradas canceladas são riscadas. ")],1)])])},B=[],M=s(L,A,B,!1,null,null,null,null);const R=M.exports,T={props:{item:{type:Object,required:!0},disabled:{type:Boolean,default:!1},color:{type:String,required:!0}},data(){return{icons:{faExternalLinkAlt:f,faPlus:_},loading:!1}},computed:{getContentMessage(){return this.item.value>0?"Entrada":"Saída"},isEntryCancelable(){return!this.item.isDuplicated&&!this.item.isCanceled}},methods:{isEntryLoading(n){return this.loading.bank_uid===n.bank_uid},onAddEntryClick(n){this.$emit("add-entry",n)},onCancelEntryClick(n){this.$emit("cancel-entry",n)},async openRelatedOrder(){this.loading=!0;const{data:{payment:n}}=await this.$apollo.query({query:b,variables:{where:{column:"BANK_UID",operator:"EQ",value:this.item.bank_uid}}});this.loading=!1;const e=this.$helpers.getUrl("orders.show",{client:n.order.client.id,order:n.order.id});this.$helpers.openInNewTab(e)}}};var q=function(){var e=this,t=e._self._c;return t("div",{staticClass:"text-center"},[e.item.hasOrder?t("div",[t("AppButton",{directives:[{name:"tippy",rawName:"v-tippy"}],attrs:{content:"Ver pedido relacionado",icon:e.icons.faExternalLinkAlt,"btn-class":"btn-sm",loading:e.loading},on:{click:function(a){return a.preventDefault(),e.openRelatedOrder()}}})],1):t("div",[t("AppButton",{directives:[{name:"tippy",rawName:"v-tippy"}],attrs:{content:e.getContentMessage,disabled:e.disabled,"btn-class":"btn-sm",color:e.color,icon:e.icons.faPlus},on:{click:function(a){return a.preventDefault(),e.onAddEntryClick(e.item)}}}),e.isEntryCancelable?t("div",[t("span",{staticClass:"link-primary clickable extra-small text-uppercase fw-bold text-decoration-none",on:{click:function(a){return a.preventDefault(),e.onCancelEntryClick(e.item)}}},[e._v("Cancelar ")])]):e._e()],1)])},H=[],S=s(T,q,H,!1,null,null,null,null);const I=S.exports,O={components:{BankEntriesTableActionBtn:I},props:{fileEntry:{type:Object,required:!0}},computed:{entries(){return this.fileEntry.entries},headers(){return[{value:"action",text:""},{value:"value",text:"Valor"},{value:"date",text:"Data"},{value:"description",text:"Descrição",wrap:!0}]}},methods:{formatCurrencyBRL:h,onAddEntry(n){this.$emit("add-entry",n)},onCancelEntry(n){this.$emit("cancel-entry",n)},isItemDisabled(n){return n.isDuplicated||n.isCanceled},getItemColor(n){return this.isItemDisabled(n)?"secondary":n.value>0?"success":"danger"},tableRowClass(n){const e=this.getItemColor(n),t=[];return n.isCanceled&&t.push("text-decoration-line-through"),t.push(`table-${e}`),t}}};var F=function(){var e=this,t=e._self._c;return t("AppTable",{attrs:{"row-class":e.tableRowClass,headers:e.headers,items:e.entries},scopedSlots:e._u([{key:"items.action",fn:function({item:a}){return[t("BankEntriesTableActionBtn",{attrs:{item:a,disabled:e.isItemDisabled(a),color:e.getItemColor(a)},on:{"add-entry":e.onAddEntry,"cancel-entry":e.onCancelEntry}})]}},{key:"items.value",fn:function({item:a}){return[t("b",{class:`text-${e.getItemColor(a)}`},[e._v(e._s(e.formatCurrencyBRL(a.value)))])]}},{key:"items.date",fn:function({item:a}){return[t("span",{class:e.isItemDisabled(a)&&"text-secondary"},[e._v(e._s(a.date))])]}},{key:"items.description",fn:function({item:a}){return[t("span",{class:e.isItemDisabled(a)&&"text-secondary"},[e._v(e._s(a.description||"N/A"))])]}}],null,!0)})},N=[],j=s(O,F,N,!1,null,null,null,null);const P=j.exports,Q={components:{BankEntriesHeader:R,BankEntriesTable:P},props:{fileEntry:{type:Object,required:!0}},methods:{onAddEntry(n){this.$emit("add-entry",n)},onCancelEntry(n){this.$emit("cancel-entry",n)},onHideDuplicates(n){this.$emit("hide-duplicates-toggle",n)},onHideCanceled(n){this.$emit("hide-canceled-toggle",n)}}};var z=function(){var e=this,t=e._self._c;return t("div",[t("BankEntriesHeader",{attrs:{"file-entry":e.fileEntry},on:{"hide-duplicates":e.onHideDuplicates,"hide-canceled":e.onHideCanceled}}),t("BankEntriesTable",{attrs:{"file-entry":e.fileEntry},on:{"add-entry":e.onAddEntry,"cancel-entry":e.onCancelEntry}})],1)},G=[],U=s(Q,z,G,!1,null,null,null,null);const V=U.exports,J={components:{DailyPaymentModal:l,ModalExpensesNew:o},props:{value:{type:Boolean,required:!0},entry:{type:Object,required:!0}},data(){return{modal:!1}},computed:{emptyFields(){return{bank_uid:"",value:"R$ ",date:"",description:""}},getAttrs(){return r(this.entry)?this.emptyFields:this.isExpense?{expense:{filename_entry_from:this.entry.filename,bank_uid:this.entry.bank_uid,value:Math.abs(this.entry.value),date:this.entry.date,description:this.entry.description,expense_via_id:this.entry.via_id}}:{payment:{filename_entry_from:this.entry.filename,bank_uid:this.entry.bank_uid,value:this.entry.value,date:this.entry.date,note:this.entry.description,via_id:this.entry.via_id}}},isExpense(){return this.entry.value<0},getComponent(){return this.isExpense?o:l}},methods:{componentCreated(){this.modal=this.value},onModalHidden(){this.modal=!1},onSuccess(){this.modal=!1,this.$emit("success",this.entry)}}};var K=function(){var e=this,t=e._self._c;return e.value?t(e.getComponent,e._g(e._b({tag:"Component",attrs:{value:e.modal,"hide-bank-entries":""},on:{"hook:created":e.componentCreated,hidden:e.onModalHidden,success:e.onSuccess}},"Component",e.getAttrs,!1),e.$listeners)):e._e()},W=[],X=s(J,K,W,!1,null,null,null,null);const Y=X.exports,Z={props:{value:{type:Boolean,default:!1},entry:{type:Object,default:()=>({})}},data(){return{isLoading:!1}},methods:{isEmpty:r,async onConfirmClick(){this.isLoading=!0;try{await this.$apollo.mutate({mutation:g,variables:{uid:this.entry.bank_uid}}),this.$toast.success("Entrada cancelada!"),this.$emit("success",this.entry)}catch{this.$toast.error("Ops! Algo deu errado!")}this.isLoading=!1}}};var ee=function(){var e=this,t=e._self._c;return t("AppModal",e._g(e._b({attrs:{id:"entryCancelModal",value:e.value,color:"danger",centered:""},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Cancelar entrada ")]},proxy:!0},{key:"body",fn:function(){return[t("h5",{staticClass:"text-center my-4"},[e._v(" Tem certeza que deseja cancelar a entrada: ")]),e.isEmpty(e.entry)?e._e():t("div",[t("div",{staticClass:"mb-3"},[t("div",{staticClass:"fw-bold text-secondary"},[e._v(" Valor ")]),t("h5",[e._v(e._s(e.$helpers.toBRL(e.entry.value)))])]),t("div",{staticClass:"mb-3"},[t("div",{staticClass:"fw-bold text-secondary"},[e._v(" Descrição ")]),t("div",{staticClass:"small"},[e._v(" "+e._s(e.entry.description)+" ")])]),t("div",{staticClass:"mb-3"},[t("div",{staticClass:"fw-bold text-secondary"},[e._v(" Data ")]),t("div",[e._v(e._s(e.entry.date))])])]),t("div",{staticClass:"row mt-3"},[t("div",{staticClass:"col"},[t("AppButton",{attrs:{color:"success","btn-class":"fw-bold",block:"",loading:e.isLoading},on:{click:function(a){return a.preventDefault(),e.onConfirmClick.apply(null,arguments)}}},[e._v(" CONFIRMAR ")])],1),t("div",{staticClass:"col"},[t("AppButton",{attrs:{color:"light",block:"","data-bs-dismiss":"modal",disabled:e.isLoading}},[e._v(" Cancelar ")])],1)])]},proxy:!0}])},"AppModal",e.$attrs,!1),e.$listeners))},te=[],ne=s(Z,ee,te,!1,null,null,null,null);const ae=ne.exports,se={components:{BankEntries:V,BankModalEntry:Y,EntryCancelModal:ae},props:{isLoading:{type:Boolean,default:!1},fileEntry:{type:Object,default:()=>({})}},data(){return{modalEntry:{value:!1,entry:{}},entryCancelModal:{value:!1,entry:{}},icons:{faListUl:v}}},methods:{isEmpty:r,onHideDuplicatesToggle(n){this.$emit("hide-duplicates-toggle",n)},onHideCanceledToggle(n){this.$emit("hide-canceled-toggle",n)},onAddEntry(n){this.modalEntry.value=!0,this.modalEntry.entry={filename:this.fileEntry.filename,...n}},onCancelEntry(n){this.entryCancelModal.value=!0,this.entryCancelModal.entry=n},onCancelEntrySuccess(n){this.entryCancelModal.value=!1,this.entryCancelModal.entry={},this.$emit("entry-canceled",n)},onAddEntrySuccess(n){this.$emit("entry-registered",n)}}};var re=function(){var e=this,t=e._self._c;return t("AppCard",{scopedSlots:e._u([{key:"header",fn:function(){return[t("h6",{staticClass:"fw-bold mb-0"},[t("FontAwesomeIcon",{attrs:{icon:e.icons.faListUl,"fixed-width":""}}),e._v(" Entradas carregadas ")],1)]},proxy:!0},{key:"body",fn:function(){return[t("BankModalEntry",{attrs:{entry:e.modalEntry.entry},on:{success:e.onAddEntrySuccess},model:{value:e.modalEntry.value,callback:function(a){e.$set(e.modalEntry,"value",a)},expression:"modalEntry.value"}}),t("EntryCancelModal",{attrs:{entry:e.entryCancelModal.entry},on:{success:e.onCancelEntrySuccess},model:{value:e.entryCancelModal.value,callback:function(a){e.$set(e.entryCancelModal,"value",a)},expression:"entryCancelModal.value"}}),e.isEmpty(e.fileEntry)?t("div",{staticClass:"text-secondary text-center py-5"},[e._v(" Carregue um arquivo de entradas bancárias para exibir aqui ")]):t("div",[t("BankEntries",{attrs:{"file-entry":e.fileEntry},on:{"hide-duplicates-toggle":e.onHideDuplicatesToggle,"hide-canceled-toggle":e.onHideCanceledToggle,"add-entry":e.onAddEntry,"cancel-entry":e.onCancelEntry}})],1)]},proxy:!0}])})},ie=[],le=s(se,re,ie,!1,null,null,null,null);const oe=le.exports,ce={apollo:{entriesMonthlyBalance:{query:E,fetchPolicy:"network-only",skip(){return!this.collapse}}},data(){return{DateTime:C,entriesMonthlyBalance:null,collapse:!1}},computed:{isQueryLoading(){return this.$apollo.queries.entriesMonthlyBalance.loading},balance(){return this.entriesMonthlyBalance??null}}};var de=function(){var e=this,t=e._self._c;return t("AppContainer",{attrs:{collapsible:""},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Receita mensal ")]},proxy:!0},{key:"body",fn:function(){return[t("div",{directives:[{name:"show",rawName:"v-show",value:e.isQueryLoading,expression:"isQueryLoading"}]},[t("AppLoading")],1),e.balance!==null?t("div",[t("div",{staticClass:"text-center"},[t("div",{staticClass:"text-secondary mb-2"},[e._v(" Soma dos valores não lançados de "),t("b",[e._v(" "+e._s(e.DateTime.now().toFormat("LLLL",{locale:"pt-BR"}))+" ")])]),t("h3",{staticClass:"text-success",domProps:{innerHTML:e._s(e.$helpers.toBRL(e.balance.current,!0))}})]),t("div",{staticClass:"text-end"},[t("span",{staticClass:"text-secondary me-1"},[e._v("Mês passado:")]),t("span",{staticClass:"fw-bold text-success"},[e._v(e._s(e.$helpers.toBRL(e.balance.previous)))])])]):e._e()]},proxy:!0}]),model:{value:e.collapse,callback:function(a){e.collapse=a},expression:"collapse"}})},ue=[],pe=s(ce,de,ue,!1,null,null,null,null);const ye=pe.exports,me={metaInfo:{title:"Entradas financeiras"},components:{TheEntriesList:D,TheEntriesBody:oe,EntriesMonthlyBalance:ye},data(){return{entry:{},isLoading:!1}},methods:{findEntry(n){return this.entry.entries.find(e=>e.bank_uid===n.bank_uid)},onEntryRegistered(n){const e=this.findEntry(n);e.isDuplicated=!0},onEntryCanceled(n){const e=this.findEntry(n);e.isCanceled=!0},onHideDuplicatesToggle(n){this.entry.entries.forEach(e=>{e.isDuplicated&&(e.display=n)})},onHideCanceledToggle(n){this.entry.entries.forEach(e=>{e.isCanceled&&(e.display=n)})},async onLoadEntry(n){this.isLoading=!0;try{const{data:{bankEntryLoad:e}}=await this.$apollo.query({query:d,variables:{id:n.id},fetchPolicy:this.entry.filename===n.filename?"network-only":"cache-first"}),t=JSON.parse(e),a=Object.entries(t).map(([,i])=>({...i}));this.entry={entries:a,filename:n.filename,created_at:n.created_at}}catch{this.$toast.error("Ops! Algo deu errado.")}this.isLoading=!1}}};var fe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"pt-3 pb-5"},[t("TheEntriesList",{attrs:{entry:e.entry,"is-loading":e.isLoading},on:{"load-entry":e.onLoadEntry}}),t("EntriesMonthlyBalance",{staticClass:"mt-3"}),t("TheEntriesBody",{staticClass:"mt-3",attrs:{"file-entry":e.entry,"is-loading":e.isLoading},on:{"hide-duplicates-toggle":e.onHideDuplicatesToggle,"hide-canceled-toggle":e.onHideCanceledToggle,"entry-registered":e.onEntryRegistered,"entry-canceled":e.onEntryCanceled}})],1)},_e=[],he=s(me,fe,_e,!1,null,null,null,null);const Ue=he.exports;export{Ue as default};
