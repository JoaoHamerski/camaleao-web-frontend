import{n as o,d as i,D as n,R as c,S as d,b as u,i as p,u as f,F as m,U as h}from"./index-4e05606f.js";import{G as _,a as v}from"./CashFlow-40db983d.js";import{m as y}from"./masks-168ccaff.js";import{P as b,h as l}from"./PaymentExpenseTable-a07d514e.js";import"./_PaginatorFragment-c01a3fe7.js";import"./PaymentExpense-9583d97d.js";import"./PaymentExpenseStatus-b4702367.js";const C={props:{form:{type:Object,required:!0},onSubmit:{type:Function,required:!0},isLoading:{type:Boolean,default:!1}},data(){return{hasDateInterval:!1,maskDate:y,icons:{faFilter:i}}},methods:{onTodayClick(){this.hasDateInterval=!1,this.form.set({start_date:n.now().toFormat("dd/MM/yyyy"),final_date:""})},onCurrentWeekClick(){this.hasDateInterval=!0;const s=n.now().startOf("week").toFormat("dd/MM/yyyy"),e=n.now().endOf("week").toFormat("dd/MM/yyyy");this.form.set({start_date:s,final_date:e})},onCurrentMonthClick(){this.hasDateInterval=!0;const s=n.now().startOf("month").toFormat("dd/MM/yyyy"),e=n.now().endOf("month").toFormat("dd/MM/yyyy");this.form.set({start_date:s,final_date:e})},onClearFilterClick(){this.hasDateInterval=!1,this.$emit("clear-filter")},balanceToggle(s){this.$emit("balance-show-toggle",s)}}};var w=function(){var e=this,t=e._self._c;return t("AppCard",{attrs:{color:"success",collapsible:""},scopedSlots:e._u([{key:"header",fn:function(){return[t("h6",{staticClass:"mb-0 fw-bold"},[t("FontAwesomeIcon",{attrs:{icon:e.icons.faFilter,"fixed-width":""}}),e._v(" Filtros ")],1)]},proxy:!0},{key:"body",fn:function(){return[t("AppForm",{attrs:{"on-submit":e.onSubmit,form:e.form}},[t("div",{staticClass:"mb-3"},[e._v(" Filtrar "),t("b",[e._v("pagamentos recebidos")]),e._v(" e "),t("b",[e._v("despesas")]),e._v(" pela data ")]),t("label",{staticClass:"form-label fw-bold"},[e._v(" "+e._s(e.hasDateInterval?"Datas":"Data")+" ")]),t("div",{staticClass:"row"},[t("div",{staticClass:"col"},[t("AppInput",{attrs:{value:e.form.start_date,name:"start_date",type:"date",numeric:"",placeholder:"dd/mm/aaaa",mask:e.maskDate,error:e.form.errors.get("start_date")},on:{input:function(a){return e.form.set({start_date:a})}}})],1),e.hasDateInterval?t("div",{staticClass:"col"},[t("AppInput",{attrs:{value:e.form.final_date,name:"final_date",type:"date",numeric:"",placeholder:"dd/mm/aaaa",mask:e.maskDate,error:e.form.errors.get("final_date")},on:{input:function(a){return e.form.set({final_date:a})}}})],1):e._e()]),t("AppCheckbox",{attrs:{id:"date_interval",name:"date_interval"},model:{value:e.hasDateInterval,callback:function(a){e.hasDateInterval=a},expression:"hasDateInterval"}},[e._v(" Por intervalo de datas ")]),t("AppCheckbox",{attrs:{id:"show_balance",value:e.form.showBalance,name:"show_balance"},on:{input:e.balanceToggle}},[e._v(" Exibir balanço final ")]),t("div",{staticClass:"d-flex mb-4"},[t("AppButton",{attrs:{type:"button",outlined:"","btn-class":"btn-sm"},on:{click:function(a){return a.preventDefault(),e.onTodayClick.apply(null,arguments)}}},[e._v(" Hoje ")]),t("AppButton",{staticClass:"mx-2",attrs:{type:"button",outlined:"","btn-class":"btn-sm"},on:{click:function(a){return a.preventDefault(),e.onCurrentWeekClick.apply(null,arguments)}}},[e._v(" Semana atual ")]),t("AppButton",{attrs:{type:"button",outlined:"","btn-class":"btn-sm"},on:{click:function(a){return a.preventDefault(),e.onCurrentMonthClick.apply(null,arguments)}}},[e._v(" Mês atual ")])],1),t("div",{staticClass:"d-flex mt-2"},[t("AppButton",{staticClass:"me-2",attrs:{color:"success","btn-class":"fw-bold",loading:e.isLoading},on:{click:function(a){return a.preventDefault(),e.onSubmit.apply(null,arguments)}}},[e._v(" Filtrar ")]),t("AppButton",{attrs:{type:"button",color:"success",outlined:""},on:{click:function(a){return a.preventDefault(),e.onClearFilterClick.apply(null,arguments)}}},[e._v(" Limpar filtros ")])],1)],1)]},proxy:!0}])})},g=[],F=o(C,w,g,!1,null,null,null,null);const D=F.exports,E={props:{showBalance:{type:Boolean,default:!1},balance:{type:Object,default:()=>{}}},methods:{isNil:c}};var x=function(){var e=this,t=e._self._c;return e.showBalance&&!e.isNil(e.balance.value)?t("div",{staticClass:"mb-3"},[t("div",{staticClass:"text-secondary text-center text-subtitle fw-bold"},[e._v(" BALANÇO ")]),t("h4",{staticClass:"text-center fw-bold",class:e.balance.value>=0?"text-success":"text-danger"},[e._v(" "+e._s(e.$helpers.toBRL(e.balance.value))+" ")])]):e._e()},k=[],A=o(E,x,k,!1,null,null,null,null);const S=A.exports,B={components:{PaymentExpenseTable:b,CashFlowBalance:S},props:{isLoading:{type:Boolean,default:!1},filterDates:{type:Object,default:()=>({})},data:{type:Array,default:()=>[]},pagination:{type:Object,default:()=>({})},page:{type:Number,required:!0},balance:{type:Object,default:()=>{}},showBalance:{type:Boolean,default:!1}},data(){return{icons:{faCashRegister:d,faExclamationCircle:u}}},computed:{headers(){const s=l.findIndex(e=>e.value==="created_at");return l.splice(s,1,{text:"CADASTRO EM",value:"created_at",format:"datetime",formatting:"dd/MM/y HH:mm"}),l},displayFilteredDate(){const{start_date:s,final_date:e}=this.filterDates;return s&&e?`${s} ~ ${e}`:`${s}`}},methods:{isEmpty:p}};var I=function(){var e=this,t=e._self._c;return t("div",[t("AppCard",{staticClass:"mt-2",scopedSlots:e._u([{key:"header",fn:function(){return[t("h6",{staticClass:"mb-0 fw-bold d-flex justify-content-between"},[t("div",[t("FontAwesomeIcon",{attrs:{icon:e.icons.faCashRegister,"fixed-width":""}}),e._v(" Fluxo de caixa ")],1),t("div",[t("FontAwesomeIcon",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:"left"},expression:"{placement: 'left'}"}],attrs:{content:"Lista de informações de DESPESAS com PAGAMENTOS RECEBIDOS",icon:e.icons.faExclamationCircle,size:"lg"}})],1)])]},proxy:!0},{key:"body",fn:function(){return[t("AppLoading",{directives:[{name:"show",rawName:"v-show",value:e.isLoading,expression:"isLoading"}]}),e.isEmpty(e.filterDates.start_date)?e._e():t("div",{staticClass:"text-center"},[t("div",[t("small",{staticClass:"text-secondary"},[e._v("Filtragem por data")])]),t("h5",{staticClass:"fw-bold"},[e._v(" "+e._s(e.displayFilteredDate)+" ")])]),e.balance.isLoading?t("AppLoading"):t("CashFlowBalance",{attrs:{balance:e.balance,"show-balance":e.showBalance}}),t("PaymentExpenseTable",{attrs:{items:e.data,headers:e.headers}})]},proxy:!0}])}),t("AppPaginator",{staticClass:"mt-2",attrs:{value:e.page,pagination:e.pagination},on:{input:function(a){return e.$emit("update:page",a)}}})],1)},O=[],T=o(B,I,O,!1,null,null,null,null);const L=T.exports,r={DESCRIPTION:"DESCRIPTION",VALUE:"VALUE"},$={metaInfo(){return{title:"Fluxo de caixa"}},components:{TheCashFlowFilter:D,TheCashFlowBody:L},apollo:{cashFlowEntries:{query:_,variables(){return{page:this.page,first:10,where:this.where,orderBy:this.orderBy}},result({loading:s}){if(!s){const{start_date:e,final_date:t}=this.filterForm;this.filterDates={start_date:e,final_date:t}}},error(s){"message"in{...s}&&(f(this,s,{formProp:"filterForm"}),this.where={})}}},data(){return{cashFlowEntries:{data:[],paginatorInfo:{}},filterForm:new m({start_date:"",final_date:"",showBalance:!1}),filterDates:{},balance:{isLoading:!1,value:null},page:1,search:"",searchOption:r.DESCRIPTION,where:{},orderBy:[{column:"CREATED_AT",order:"DESC"}],icons:{faSearch:h}}},computed:{isLoading(){return!!this.$apollo.queries.cashFlowEntries.loading},searchOptions(){return[{id:r.DESCRIPTION,label:"Descrição"},{id:r.VALUE,label:"Valor"}]}},methods:{async onSearch(){const s=this.search;if(this.orderBy=[{column:"DATE",order:"DESC"}],this.searchOption===r.VALUE){this.where={column:this.searchOption.replace(",","."),operator:"EQ",value:this.search.replace(",",".")};return}this.where={column:this.searchOption,operator:"LIKE",value:`%${s}%`}},onSearchClear(){this.search="",this.where={}},onFilterClear(){this.page=1,this.filterForm.reset(),this.orderBy=[{column:"CREATED_AT",order:"DESC"}],this.filterDates={},this.where={},this.balance.value=null},async submitBalance({start_date:s,final_date:e}){this.balance.isLoading=!0;try{const{data:{cashFlowBalance:t}}=await this.$apollo.query({query:v,variables:{input:{start_date:s,final_date:e}}});this.balance.value=t}catch{this.$toast.error("Ops! Algo deu errado.")}this.balance.isLoading=!1},async onSubmit(){const s=this.filterForm.data(),{showBalance:e}=s,{start_date:t,final_date:a}=s;if(e&&this.submitBalance(s),t&&a){this.orderBy=[{column:"DATE",order:"DESC"}],this.where={column:"DATE",operator:"BETWEEN",value:[t,a]};return}this.where={column:"DATE",operator:"EQ",value:t}},onBalanceShowToggle(s){this.filterForm.set({showBalance:s}),s||(this.balance.value=null)}}};var M=function(){var e=this,t=e._self._c;return t("div",{staticClass:"py-5"},[t("TheCashFlowFilter",{attrs:{"is-loading":e.isLoading,form:e.filterForm,"on-submit":e.onSubmit},on:{"update:form":function(a){e.filterForm=a},"clear-filter":e.onFilterClear,"balance-show-toggle":e.onBalanceShowToggle}}),t("div",{staticClass:"mt-2"},[t("div",{staticClass:"col col-sm-4 ms-auto"},[t("AppInput",{attrs:{name:"search",placeholder:"Digite a busca...","default-margin":!1},on:{keypress:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:(a.preventDefault(),e.onSearch.apply(null,arguments))}},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("AppSimpleSelect",{attrs:{"remove-default-margin":"",name:"search-options",options:e.searchOptions,"label-prop":"label",placeholder:"Selecione..."},model:{value:e.searchOption,callback:function(a){e.searchOption=a},expression:"searchOption"}})]},proxy:!0},{key:"append",fn:function(){return[t("AppButton",{attrs:{outlined:"",icon:e.icons.faSearch},on:{click:e.onSearch}})]},proxy:!0}]),model:{value:e.search,callback:function(a){e.search=a},expression:"search"}}),e.search!==""?t("div",{staticClass:"small link-primary clickable text-end",on:{click:e.onSearchClear}},[e._v(" Limpar busca ")]):e._e()],1)]),t("TheCashFlowBody",{attrs:{"is-loading":e.isLoading,"show-balance":e.filterForm.showBalance,page:e.page,balance:e.balance,"filter-dates":e.filterDates,data:e.cashFlowEntries.data,pagination:e.cashFlowEntries.paginatorInfo},on:{"update:page":function(a){e.page=a}}})],1)},R=[],N=o($,M,R,!1,null,null,null,null);const W=N.exports;export{W as default};
