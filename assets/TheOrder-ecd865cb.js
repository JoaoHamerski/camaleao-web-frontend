import{T as B,d as x,e as I,U as M,D as V,f as j}from"./Order-7b0e72c5.js";import{o as q}from"./orderStatesMixin-3d8dcb0c.js";import{n as a,G as f,p as _,aP as w,aQ as H,aR as v,a0 as $,X as y,aS as U,aT as G,am as O,a1 as Q,i as l,A as k,J as A,F as D,s as g,u as b,aU as z,N as i,a4 as R,r as K,a5 as p,w as E,b as J,K as W,ax as X,aV as Y,ay as Z,aW as ee,c as te,a6 as re}from"./index-fae63e1f.js";import{C as se}from"./ClientCard-497c8834.js";import{O as ae}from"./OrderReminder-d2ede3d6.js";import{P as oe}from"./PaymentExpenseStatus-2fd23c74.js";import{P as ne}from"./PaymentConfirmErrorModal-da2f8ea4.js";import{A as ie}from"./ActivityItem-827aa268.js";import{M as le}from"./ModalOrderStatusOverrideDates-8935b0ac.js";import"./_PaginatorFragment-c01a3fe7.js";import"./ActivityFragments-a3df58d3.js";import"./ClientForm-2fc68fde.js";import"./Client-cfdef3aa.js";import"./City-ae18d4e9.js";import"./Resources-b591129f.js";import"./ShippingCompany-204ada3f.js";import"./masks-168ccaff.js";const de={props:{order:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isReportLoading:{type:Boolean,default:!1},isOrderClosed:{type:Boolean,required:!0},isOrderPaid:{type:Boolean,required:!0},isOrderPreRegistered:{type:Boolean,required:!0}},data(){return{isToggleLoading:!1,icons:{faEdit:f,faTrashAlt:_,faExchangeAlt:w,faTimesCircle:H,faBoxOpen:v}}},methods:{async toggleOrder(){const s=this.order.closed_at===null;this.isToggleLoading=!0;try{await this.$apollo.mutate({mutation:B,variables:{id:this.order.id}}),this.$emit("toggle-success"),this.$toast.success(s?"Pedido fechado":"Pedido reaberto")}catch{this.$toast.error("Ops! Algo deu errado.")}this.isToggleLoading=!1},redirectToOrderEdit(){const{clientKey:s,orderKey:e}=this.$route.params;if(!this.order.client){this.$helpers.redirectTo($.editPreRegistered,{order:this.order});return}this.$helpers.redirectTo($.edit,{client:s,order:e})},onDeleteOrderClick(){this.$emit("open-modal",{modal:"delete-order"})},onChangeStatusClick(){this.$emit("open-modal",{modal:"change-status"})}}};var ce=function(){var e=this,t=e._self._c;return e.isLoading?e._e():t("ul",{staticClass:"dropdown-menu",attrs:{"aria-labelledby":"dropdownOptions"},on:{click:function(r){r.stopPropagation()}}},[e.isToggleLoading?t("AppLoading"):e._e(),t("AppDropdownItem",{attrs:{"disabled-message":e.isOrderClosed&&"Não é possível editar pedidos fechados.",icon:e.icons.faEdit,text:e.isOrderPreRegistered?"Concluir cadastro":"Editar","icon-color":"primary"},on:{click:function(r){return r.preventDefault(),e.redirectToOrderEdit.apply(null,arguments)}}}),t("AppDropdownItem",{attrs:{icon:e.icons.faTrashAlt,text:"Excluir","icon-color":"danger"},on:{click:e.onDeleteOrderClick}}),t("div",{staticClass:"dropdown-divider"}),t("AppDropdownItem",{attrs:{"disabled-message":e.isOrderClosed&&"Não é possível alterar status de pedidos fechados.",icon:e.icons.faExchangeAlt,text:"Alterar status","icon-color":"primary"},on:{click:e.onChangeStatusClick}}),t("AppDropdownItem",{attrs:{"disabled-message":!e.isOrderPaid&&"Não é possível fechar pedidos com pendência financeira.",icon:e.isOrderClosed?e.icons.faBoxOpen:e.icons.faTimesCircle,text:e.isOrderClosed?"Reabrir pedido":"Fechar pedido","icon-color":"primary"},on:{click:function(r){return r.preventDefault(),e.toggleOrder.apply(null,arguments)}}})],1)},ue=[],me=a(de,ce,ue,!1,null,null,null,null);const pe=me.exports,fe={components:{TheOrderHeaderCogOptions:pe},props:{order:{type:Object,default:()=>{}},isLoading:{type:Boolean,default:!1},isReportLoading:{type:Boolean,default:!1},isOrderClosed:{type:Boolean,required:!0},isOrderPaid:{type:Boolean,required:!0},isOrderPreRegistered:{type:Boolean,required:!0}},data(){return{clients:y,icons:{faEllipsisH:U,faFileInvoice:G,faDollarSign:O,faArrowAltCircleLeft:Q}}},computed:{isReportDisabled(){return!this.order||!this.order.code},paymentBtnDisabledMessage(){return l(this.order)?!0:this.isOrderPaid?"Pedido já pago":this.isOrderClosed?"Não é possível registrar pagamento em pedidos fechados.":this.order.price===null?"Pedido em pré-registro sem preço, impossível efetuar pagamentos.":!1}},methods:{isEmpty:l,onAddPaymentClick(){this.$emit("open-modal",{modal:"payment",payload:{isEdit:!1}})},onGenerateReportClick(){this.$emit("open-modal",{modal:"report"})},onOpenModal(s){this.$emit("open-modal",s)},onToggleSuccess(){this.$emit("toggle-success")}}};var _e=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-flex row flex-column flex-sm-row justify-content-between"},[t("div",{staticClass:"col-sm-3 mb-2 mb-sm-0"},[t("AppButton",{attrs:{outlined:"","disabled-message":!e.order.client&&"O pedido não possui cliente"},on:{click:function(r){return e.$helpers.redirectTo(e.clients.show,{client:e.order.client})}}},[t("FontAwesomeIcon",{attrs:{icon:e.icons.faArrowAltCircleLeft}}),e._v(" Cliente ")],1)],1),t("div",{staticClass:"col d-flex flex-column flex-sm-row justify-content-between"},[t("div",{staticClass:"col col-sm-4 d-flex mb-2 mb-sm-0"},[t("AppButton",{staticClass:"flex-grow-1 flex-sm-grow-0",attrs:{color:"success",outlined:"",icon:e.icons.faDollarSign,"disabled-message":e.paymentBtnDisabledMessage},on:{click:e.onAddPaymentClick}},[e._v(" Adicionar pagamento ")])],1),t("div",{staticClass:"col col-sm-4 d-flex justify-content-end"},[t("AppButton",{staticClass:"me-1 flex-grow-1 flex-sm-grow-0",attrs:{icon:e.icons.faFileInvoice,disabled:e.isReportDisabled,loading:e.isReportLoading},on:{click:function(r){return r.preventDefault(),e.onGenerateReportClick.apply(null,arguments)}}},[e._v(" Gerar relatório ")]),t("AppButton",{attrs:{id:"dropdownOptions","data-bs-toggle":"dropdown",icon:e.icons.faEllipsisH,disabled:!e.order}}),t("TheOrderHeaderCogOptions",e._b({on:{"open-modal":e.onOpenModal,"toggle-success":e.onToggleSuccess}},"TheOrderHeaderCogOptions",{order:e.order,isLoading:e.isLoading,isOrderClosed:e.isOrderClosed,isOrderPreRegistered:e.isOrderPreRegistered,isOrderPaid:e.isOrderPaid},!1))],1)])])},ve=[],he=a(fe,_e,ve,!1,null,null,null,null);const ye=he.exports;var d={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"NoteParts"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Note"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"text"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created_at"},arguments:[],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CreateNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"order_id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"text"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"noteCreate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"order_id"},value:{kind:"Variable",name:{kind:"Name",value:"order_id"}}},{kind:"Argument",name:{kind:"Name",value:"text"},value:{kind:"Variable",name:{kind:"Name",value:"text"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NoteParts"},directives:[]},{kind:"Field",name:{kind:"Name",value:"order"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"client"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UpdateNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"text"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"noteUpdate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"text"},value:{kind:"Variable",name:{kind:"Name",value:"text"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NoteParts"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"noteDelete"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NoteParts"},directives:[]}]}}]}}],loc:{start:0,end:436}};d.loc.source={body:`fragment NoteParts on Note {
  id
  text
  created_at
}

mutation CreateNote ($order_id: ID! $text: String!) {
  noteCreate (order_id: $order_id text: $text) {
    ...NoteParts
    order {
      id

      client {
        id
      }
    }
  }
}

mutation UpdateNote ($id: ID! $text: String!) {
  noteUpdate (id: $id text: $text) {
    ...NoteParts
  }
}

mutation DeleteNote ($id: ID!) {
  noteDelete (id: $id) {
    ...NoteParts
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function m(s,e){if(s.kind==="FragmentSpread")e.add(s.name.value);else if(s.kind==="VariableDefinition"){var t=s.type;t.kind==="NamedType"&&e.add(t.name.value)}s.selectionSet&&s.selectionSet.selections.forEach(function(r){m(r,e)}),s.variableDefinitions&&s.variableDefinitions.forEach(function(r){m(r,e)}),s.definitions&&s.definitions.forEach(function(r){m(r,e)})}var C={};(function(){d.definitions.forEach(function(e){if(e.name){var t=new Set;m(e,t),C[e.name.value]=t}})})();function N(s,e){for(var t=0;t<s.definitions.length;t++){var r=s.definitions[t];if(r.name&&r.name.value==e)return r}}function h(s,e){var t={kind:s.kind,definitions:[N(s,e)]};s.hasOwnProperty("loc")&&(t.loc=s.loc);var r=C[e]||new Set,o=new Set,c=new Set;for(r.forEach(function(n){c.add(n)});c.size>0;){var F=c;c=new Set,F.forEach(function(n){if(!o.has(n)){o.add(n);var u=C[n]||new Set;u.forEach(function(L){c.add(L)})}})}return o.forEach(function(n){var u=N(s,n);u&&t.definitions.push(u)}),t}h(d,"NoteParts");const ge=h(d,"CreateNote"),be=h(d,"UpdateNote"),Ce=h(d,"DeleteNote"),xe={props:{note:{type:Object,default:()=>({})},isEdit:{type:Boolean,default:!1},orderId:{type:String,required:!0}},data(){return{isLoading:!1,icons:{faCheck:k,faTimes:A},form:new D({text:""})}},mounted(){this.$refs.input.focusInput(),this.isEdit&&(this.form.text=this.note.text)},methods:{async onSubmit(){this.isEdit?await this.onUpdate():await this.onCreate()},onCancel(){this.$emit("cancel")},async onCreate(){const{text:s}=this.form.data();this.isLoading=!0;try{await this.$apollo.mutate({mutation:ge,variables:{order_id:this.orderId,text:s},refetchQueries:[x],awaitRefetchQueries:!0}),g(this,{message:"Anotação registrada!"})}catch(e){b(this,e)}this.isLoading=!1},async onUpdate(){const{id:s}=this.note,{text:e}=this.form.data();this.isLoading=!0;try{await this.$apollo.mutate({mutation:be,variables:{id:s,text:e}}),g(this,{message:"Anotação atualizada!"})}catch(t){b(this,t)}this.isLoading=!1}}};var Oe=function(){var e=this,t=e._self._c;return t("AppForm",{staticClass:"w-100",attrs:{form:e.form,"on-submit":e.onSubmit}},[t("div",{staticClass:"d-flex flex-column"},[t("div",{staticClass:"mb-2"},[t("AppTextarea",{ref:"input",attrs:{name:"text",placeholder:"Digite a anotação...","default-margin":!1,error:e.form.errors.get("text")},model:{value:e.form.text,callback:function(r){e.$set(e.form,"text",r)},expression:"form.text"}})],1),t("div",[t("AppButton",{attrs:{"btn-class":"btn-sm me-2 px-4",loading:e.isLoading,icon:e.icons.faCheck,color:"success"},on:{click:function(r){return r.preventDefault(),e.onSubmit.apply(null,arguments)}}}),t("AppButton",{attrs:{"btn-class":"btn-sm px-4",disabled:e.isLoading,type:"button",icon:e.icons.faTimes,color:"light"},on:{click:function(r){return r.preventDefault(),e.onCancel.apply(null,arguments)}}})],1)])])},ke=[],$e=a(xe,Oe,ke,!1,null,null,null,null);const Ne=$e.exports,Se={props:{deleteNote:{type:Object,required:!0},note:{type:Object,required:!0}},data(){return{icons:{faTrashAlt:_,faEdit:f}}},methods:{onEditClick(){this.$emit("edit",this.note)},onDeleteClick(){this.$emit("delete",this.note)},onCancelDeleteClick(){this.$emit("cancel-delete")},onConfirmDeleteClick(){this.$emit("confirm-delete")}}};var Pe=function(){var e=this,t=e._self._c;return e.deleteNote.note.id===e.note.id?t("div",{staticClass:"d-flex"},[t("AppButton",{attrs:{"btn-class":"btn-sm fw-bold",color:"success",loading:e.deleteNote.isLoading},on:{click:function(r){return r.preventDefault(),e.onConfirmDeleteClick(e.note)}}},[e._v(" Confirmar ")]),t("AppButton",{staticClass:"ms-2",attrs:{"btn-class":"btn-sm",color:"light",disabled:e.deleteNote.isLoading},on:{click:function(r){return r.preventDefault(),e.onCancelDeleteClick(e.note)}}},[e._v(" Cancelar ")])],1):t("div",{staticClass:"d-flex"},[t("AppButton",{staticClass:"me-3",attrs:{tooltip:"Editar","btn-class":"btn-sm px-4",outlined:"",icon:e.icons.faEdit},on:{click:function(r){return r.preventDefault(),e.onEditClick(e.note)}}}),t("AppButton",{attrs:{color:"danger",tooltip:"Deletar","btn-class":"btn-sm px-4",outlined:"",icon:e.icons.faTrashAlt},on:{click:function(r){return r.preventDefault(),e.onDeleteClick(e.note)}}})],1)},we=[],Ae=a(Se,Pe,we,!1,null,null,null,null);const De=Ae.exports,Re={components:{OrderNotesForm:Ne,OrderNotesActionButtons:De},props:{orderId:{type:String,default:""},notes:{type:Array,default:()=>[]}},data(){return{newNote:{value:!1},editNote:{note:{}},deleteNote:{note:{},isLoading:!1},form:new D({text:""}),icons:{faStickyNote:z}}},methods:{formatDatetime:i,async onDelete(){const{id:s}=this.deleteNote.note;this.deleteNote.isLoading=!0;try{await this.$apollo.mutate({mutation:Ce,variables:{id:s}}),this.$helpers.clearCacheFrom({id:s,__typename:"Note"}),this.$toast.success("Anotação deletada!")}catch{this.$toast.error("Ops! Algo deu errado, tente novamente!")}this.deleteNote.note={},this.deleteNote.isLoading=!1},onNewNoteClick(){this.form.reset(),this.editNote.note={},this.newNote.value=!this.newNote.value},onEditNote(s){this.form.reset(),this.newNote.value=!1,this.form.text=s.text,this.editNote.note=s},dismissNewNote(){this.newNote.value=!1},dismissEditNote(){this.editNote.note={}},onDeleteNote(s){this.deleteNote.note=s},onConfirmDelete(){this.onDelete()},onCancelDelete(){this.deleteNote.note={}}}};var Ee=function(){var e=this,t=e._self._c;return t("AppContainer",{scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faStickyNote}}),e._v(" Anotações "),t("span",{staticClass:"link-white clickable small ms-2",on:{click:function(r){return r.preventDefault(),e.onNewNoteClick.apply(null,arguments)}}},[e._v(" (+ NOVA NOTA) ")])]},proxy:!0},{key:"body",fn:function(){return[e.notes.length||e.newNote.value?t("ul",{staticClass:"list-group list-group-flush"},[e.newNote.value?t("li",{staticClass:"list-group-item d-flex align-items-center"},[t("OrderNotesForm",{attrs:{"order-id":e.orderId},on:{cancel:e.dismissNewNote,success:e.dismissNewNote}})],1):e._e(),e._l(e.notes,function(r){return t("li",{key:r.id,staticClass:"list-group-item text-subtitle"},[e.editNote.note.id===r.id?[t("OrderNotesForm",{attrs:{"is-edit":!0,"order-id":e.orderId,note:e.editNote.note},on:{cancel:e.dismissEditNote,success:e.dismissEditNote}})]:t("div",{staticClass:"d-flex flex-column"},[t("div",{staticClass:"d-flex justify-content-between mb-2"},[t("div",[e._v(" "+e._s(r.text)+" ")]),t("div",{staticClass:"text-secondary small"},[e._v(" "+e._s(e.formatDatetime(r.created_at,"dd/MM/y 'ás' HH:mm"))+" ")])]),t("OrderNotesActionButtons",e._b({on:{edit:e.onEditNote,delete:e.onDeleteNote,"cancel-delete":e.onCancelDelete,"confirm-delete":e.onConfirmDelete}},"OrderNotesActionButtons",{note:r,deleteNote:e.deleteNote},!1))],1)],2)})],2):t("div",{staticClass:"text-secondary text-center py-3"},[e._v(" Nenhuma anotação registrada ")])]},proxy:!0}])})},Te=[],Fe=a(Re,Ee,Te,!1,null,null,null,null);const Le=Fe.exports,Be={components:{PaymentForm:()=>R(()=>import("./PaymentForm-be557c98.js"),["assets/PaymentForm-be557c98.js","assets/index-fae63e1f.js","assets/index-d1f48889.css","assets/Via-eb0eedf9.js","assets/Payment-7f758fb7.js","assets/_PaginatorFragment-c01a3fe7.js","assets/SelectEntriesFind-e5d39e3c.js","assets/masks-168ccaff.js","assets/SelectClientsFind-0687f9cc.js","assets/Resources-b591129f.js"])},props:{value:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},payment:{type:Object,default:()=>{}},order:{type:Object,default:()=>{}}},data(){return{formatCurrencyBRL:K,formatDatetime:i,icons:{faDollarSign:O}}},methods:{onSuccess(){this.$emit("success")}}};var Ie=function(){var e=this,t=e._self._c;return t("AppModal",e._g({attrs:{id:"paymentModal",color:"success",value:e.value,centered:""},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faDollarSign,"fixed-width":""}}),e._v(" "+e._s(e.isEdit?"Alterar pagamento":"Novo pagamento")+" ")]},proxy:!0},{key:"body",fn:function(){return[e.payment?t("div",{staticClass:"text-center my-3"},[e._v(" Pagamento de "),t("b",[e._v(e._s(e.formatCurrencyBRL(e.payment.value)))]),e._v(" em "),t("b",[e._v(e._s(e.formatDatetime(e.payment.date)))])]):e._e(),e.value?t("PaymentForm",{attrs:{order:e.order,"is-edit":e.isEdit,payment:e.payment},on:{success:e.onSuccess}}):e._e()]},proxy:!0}])},e.$listeners))},Me=[],Ve=a(Be,Ie,Me,!1,null,null,null,null);const T=Ve.exports,je={components:{PaymentExpenseStatus:oe},props:{payment:{type:Object,required:!0}},data(){return{roles:p,icons:{faEdit:f,faTrashAlt:_}}},computed:{isEditEnabled(){return!!(this.payment.is_confirmed===null||this.payment.is_confirmed===!0&&this.$helpers.canView(p.GERENCIA))}}};var qe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-flex flex-row align-items-center"},[t("PaymentExpenseStatus",{staticClass:"me-2",attrs:{entry:e.payment,"is-expense":!1}}),t("AppButton",{attrs:{disabled:!e.isEditEnabled,color:e.isEditEnabled?"primary":"secondary",tooltip:e.isEditEnabled?"Editar":"Não é possível editar",icon:e.icons.faEdit,"btn-class":"btn-sm px-3",outlined:""},on:{click:function(r){return r.preventDefault(),e.$emit("edit",e.payment)}}}),e.$helpers.canView(e.roles.GERENCIA)?t("AppButton",{attrs:{icon:e.icons.faTrashAlt,color:"danger",outlined:"",tooltip:"Excluir","btn-class":"btn-sm ms-1 px-3"},on:{click:function(r){return r.preventDefault(),e.$emit("delete",e.payment)}}}):e._e()],1)},He=[],Ue=a(je,qe,He,!1,null,null,null,null);const Ge=Ue.exports,Qe={null:"PENDENTE",false:"RECUSADO",true:"APROVADO"},ze={components:{ModalPaymentForm:T,OrderPaymentState:Ge,PaymentConfirmErrorModal:ne,PaymentExpenseDeleteModal:()=>R(()=>import("./PaymentExpenseDeleteModal-23865549.js"),["assets/PaymentExpenseDeleteModal-23865549.js","assets/index-fae63e1f.js","assets/index-d1f48889.css","assets/Payment-7f758fb7.js","assets/_PaginatorFragment-c01a3fe7.js","assets/Expense-8b8780bc.js","assets/Order-7b0e72c5.js","assets/ActivityFragments-a3df58d3.js"])},props:{payments:{type:Array,default:()=>[]}},data(){return{roles:p,icons:{faEdit:f,faCheck:k,faTimes:A,faHandHoldingUsd:E,faExclamationCircle:J,faTruck:W},selectedPayment:{},loadingId:"",modalPaymentError:{value:!1,payment:{}},modalPaymentDelete:{value:!1,payment:{}}}},methods:{formatDatetime:i,getPaymentState(s){return Qe[s.is_confirmed]},onEditPayment(s){this.$emit("open-modal",{modal:"payment",payload:{payment:s,isEdit:!0}})},onDeletePayment(s){this.modalPaymentDelete.payment=s,this.modalPaymentDelete.value=!0},onDeletePaymentSuccess(){this.modalPaymentDelete.value=!1,this.modalPaymentDelete.payment={}},onPaymentError(s){this.modalPaymentError.payment=s,this.modalPaymentError.value=!0},onPaymentModalErrorHidden(){this.modalPaymentError.value=!1,this.modalPaymentError.payment={}},getListGroupClass(s){return{"list-group-item-success":s.is_confirmed===!0,"list-group-item-danger":s.is_confirmed===!1,"list-group-item-warning":s.is_confirmed===null}}}};var Ke=function(){var e=this,t=e._self._c;return t("AppContainer",{scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faHandHoldingUsd}}),e._v(" Pagamentos ")]},proxy:!0},{key:"body",fn:function(){return[e.payments.length?t("div",[t("ModalPaymentForm",{attrs:{"modal-id":"editPaymentModal","is-edit":!0,payment:e.selectedPayment},on:{refresh:function(r){return e.$emit("refresh")}}}),e.$helpers.canView(e.roles.GERENCIA)?t("PaymentExpenseDeleteModal",{attrs:{entry:e.modalPaymentDelete.payment,"is-expense":!1},on:{success:e.onDeletePaymentSuccess},model:{value:e.modalPaymentDelete.value,callback:function(r){e.$set(e.modalPaymentDelete,"value",r)},expression:"modalPaymentDelete.value"}}):e._e(),t("PaymentConfirmErrorModal",{attrs:{value:e.modalPaymentError.value,payment:e.modalPaymentError.payment},on:{hidden:e.onPaymentModalErrorHidden}}),t("ul",{staticClass:"list-group list-group-flush"},e._l(e.payments,function(r){return t("li",{key:r.id,staticClass:"list-group-item text-subtitle",class:e.getListGroupClass(r)},[t("div",{staticClass:"d-flex flex-column flex-sm-row justify-content-between align-items-sm-center"},[t("div",{staticClass:"mb-3 mb-sm-0"},[t("div",[t("b",[e._v(e._s(e.$helpers.toBRL(r.value)))]),r.date?[e._v(" em "),t("b",[e._v(e._s(e.formatDatetime(r.date)))])]:e._e(),e._v(" via "),t("b",[e._v(e._s(e.$helpers.fallback(r.via,"name")))]),r.is_confirmed?e._e():t("span",{staticClass:"fw-bold"},[e._v(" - ["+e._s(e.getPaymentState(r))+"] ")]),r.is_shipping?t("small",[e._v(" • "),t("FontAwesomeIcon",{staticClass:"small",attrs:{icon:e.icons.faTruck}})],1):e._e()],2),r.is_sponsor?t("div",{staticClass:"small text-secondary"},[t("b",[e._v("PATROCINADOR:")]),e._v(" "),t("a",{staticClass:"fw-bold text-decoration-none",attrs:{href:e.$helpers.getUrl("clients.show",{client:r.sponsorship_client.id}),target:"blank"}},[e._v(e._s(r.sponsorship_client.name))])]):e._e(),r.note?t("div",{staticClass:"small text-secondary"},[t("strong",[e._v("NOTA:")]),e._v(" "+e._s(r.note)+" ")]):e._e(),r.clientBalances.length?t("div",{staticClass:"small text-secondary"},[t("b",[e._v("SALDO:")]),e._l(r.clientBalances,function(o){return t("span",{key:o.id,staticClass:"me-1"},[e._v(" "+e._s(e.$helpers.toBRL(o.value,!1,o.value>0))+" ")])}),r.is_sponsor?t("FontAwesomeIcon",{directives:[{name:"tippy",rawName:"v-tippy"}],attrs:{icon:e.icons.faExclamationCircle,content:"Saldo contabilizado para o patrocinador"}}):e._e()],2):e._e(),r.is_bonus?t("div",[t("div",{staticClass:"small text-secondary"},[e._v(" Bônus do cliente utilizado ")])]):e._e()]),t("div",{staticClass:"d-flex"},[t("OrderPaymentState",{attrs:{payment:r},on:{error:e.onPaymentError,edit:e.onEditPayment,delete:e.onDeletePayment}})],1)])])}),0)],1):t("div",{staticClass:"text-secondary text-center py-3"},[e._v(" Nenhum pagamento registrado ")])]},proxy:!0}])})},Je=[],We=a(ze,Ke,Je,!1,null,null,null,null);const Xe=We.exports,Ye={props:{order:{type:Object,required:!0},filesMap:{type:Object,required:!0}},methods:{isEmpty:l}};var Ze=function(){var e=this,t=e._self._c;return t("div",[e._l(e.filesMap,function(r,o){return[t("div",{key:`order_label_${e.filesMap[o]}`,staticClass:"text-subtitle fw-bold text-secondary mb-1"},[e._v(" "+e._s(r)+" ")]),e.isEmpty(e.order[o])?t("div",{key:`order_files_empty_${e.filesMap[o]}`},[t("div",{staticClass:"text-center text-secondary py-5"},[e._v(" Nenhum anexo registrado ")])]):t("AppViewerItems",{key:`order_files_${e.filesMap[o]}`,staticClass:"mb-3",attrs:{alt:r,files:e.order[o]}})]})],2)},et=[],tt=a(Ye,Ze,et,!1,null,null,null,null);const rt=tt.exports,S={art_paths:"Imagens da arte",size_paths:"Imagens do tamanho",payment_voucher_paths:"Comprovantes de pagamento"},st={components:{OrderFilesItems:rt},props:{order:{type:Object,required:!0}},data(){return{FILES_MAP:S,icons:{faFileImage:X}}},computed:{filesCount(){return Y(S).reduce((e,t)=>(l(this.order[t])?0:this.order[t].length)+e,0)}}};var at=function(){var e=this,t=e._self._c;return t("AppContainer",{attrs:{id:"files","header-class":"text-secondary",collapsible:"",value:!e.filesCount},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faFileImage,"fixed-width":""}}),t("span",{staticClass:"me-2"},[e._v("Anexos")]),e.filesCount?t("small",{staticClass:"badge rounded-pill bg-light text-dark"},[e._v(e._s(e.filesCount))]):e._e()]},proxy:!0},{key:"body",fn:function(){return[e.filesCount?t("div",[t("OrderFilesItems",{attrs:{order:e.order,"files-map":e.FILES_MAP}})],1):t("div",[t("div",{staticClass:"text-center text-secondary py-3"},[e._v(" Nenhum anexo registrado ")])])]},proxy:!0}])})},ot=[],nt=a(st,at,ot,!1,null,null,null,null);const it=nt.exports,lt={props:{status:{type:Object,required:!0}},computed:{getIcon(){return this.status.pivot.is_confirmed?k:Z}},methods:{formatDatetime:i}};var dt=function(){var e=this,t=e._self._c;return t("li",{staticClass:"list-group-item d-flex justify-content-between"},[t("div",{class:{"text-success":e.status.pivot.is_confirmed,"text-secondary":!e.status.pivot.is_confirmed}},[t("div",{class:{"fw-bold":e.status.pivot.is_confirmed}},[t("FontAwesomeIcon",{attrs:{icon:e.getIcon,"fixed-width":""}}),e._v(" "+e._s(e.status.text)+" ")],1),e.status.pivot.is_confirmed&&e.status.pivot.user?t("div",{staticClass:"small text-secondary"},[e._v(" "+e._s(e.status.pivot.user.name)+" ")]):e.status.pivot.is_confirmed&&!e.status.pivot.user?t("div",{staticClass:"small text-secondary"},[e._v(" [Concluído pelo sistema] ")]):e._e()]),e.status.pivot.confirmed_at?t("div",{staticClass:"text-secondary small position-relative",class:{"text-decoration-line-through":!e.status.pivot.is_confirmed}},[e.status.pivot.is_confirmed?e._e():t("span",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"position-absolute",staticStyle:{"z-index":"100",left:"0",top:"0",right:"0",bottom:"0"},attrs:{content:"Pedido possivelmente cancelado pelo sistema, devido a alterações nos status gerais, mas sua data de confirmação foi mantida."}}),e._v(" "+e._s(e.formatDatetime(e.status.pivot.confirmed_at,"dd/MM/yy HH:mm:ss"))+" ")]):e._e()])},ct=[],ut=a(lt,dt,ct,!1,null,null,null,null);const mt=ut.exports,pt={components:{OrderStatusProgressItem:mt},props:{order:{type:Object,required:!0}},data(){return{icons:{faTasks:ee}}},computed:{status(){return this.order.closed_at?JSON.parse(this.order.final_status):this.order.linked_status}}};var ft=function(){var e=this,t=e._self._c;return t("AppContainer",{attrs:{collapsible:""},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faTasks,"fixed-width":""}}),e._v(" Controle de Pedido ")]},proxy:!0},{key:"body",fn:function(){return[t("ul",{staticClass:"list-group list-group-flush"},[e.order.closed_at?e._l(e.status,function(r){return t("OrderStatusProgressItem",{key:r.id,attrs:{status:r}})}):e._l(e.status,function(r){return t("OrderStatusProgressItem",{key:r.id,attrs:{status:r}})})],2)]},proxy:!0}])})},_t=[],vt=a(pt,ft,_t,!1,null,null,null,null);const ht=vt.exports,yt={apollo:{ordersActivities:{query:I,variables(){return{id:this.order.id}},skip(){return!this.value},fetchPolicy:"network-only"}},components:{ActivityItem:ie},props:{order:{type:Object,required:!0}},data(){return{ordersActivities:[],value:!1,icons:{faListAlt:te}}},computed:{isQueryLoading(){return!!this.$apollo.queries.ordersActivities.loading}}};var gt=function(){var e=this,t=e._self._c;return t("AppContainer",{attrs:{collapsible:""},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faListAlt,"fixed-width":""}}),e._v(" Atividades ")]},proxy:!0},{key:"body",fn:function(){return[t("AppLoading",{directives:[{name:"show",rawName:"v-show",value:e.isQueryLoading,expression:"isQueryLoading"}]}),e.ordersActivities.length?t("div",[e._l(e.ordersActivities,function(r){return[t("ActivityItem",{key:r.id,attrs:{item:r}})]})],2):t("div",{staticClass:"text-center text-secondary small my-4"},[e._v(" Nenhuma atividade encontrada ")])]},proxy:!0}]),model:{value:e.value,callback:function(r){e.value=r},expression:"value"}})},bt=[],Ct=a(yt,gt,bt,!1,null,null,null,null);const xt=Ct.exports,Ot={props:{order:{type:Object,required:!0}},data:()=>({icons:{faFileAlt:re}}),methods:{formatDatetime:i}};var kt=function(){var e=this,t=e._self._c;return t("AppContainer",{scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faFileAlt,"fixed-width":""}}),e._v(" Detalhes do Pedido ")]},proxy:!0},{key:"body",fn:function(){return[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-sm mb-3 mb-sm-0"},[t("div",{staticClass:"fw-bold small text-secondary"},[e._v(" Nome ")]),t("b",{staticClass:"text-subtitle"},[e._v(" "+e._s(e.$helpers.fallback(e.order.name))+" ")])]),t("div",{staticClass:"col text-right text-sm-center"},[t("div",{staticClass:"fw-bold small text-secondary"},[e._v(" Código ")]),t("b",{staticClass:"text-subtitle"},[e._v(" "+e._s(e.$helpers.fallback(e.order.code))+" ")])]),t("div",{staticClass:"col text-start text-sm-end"},[t("div",{staticClass:"fw-bold small text-secondary"},[e._v(" Registrado em ")]),t("b",{staticClass:"text-subtitle"},[e._v(" "+e._s(e.formatDatetime(e.order.created_at))+" ")])])]),t("div",{staticClass:"d-flex justify-content-between mt-3"},[t("div",[t("b",{staticClass:"small text-secondary"},[e._v("Status")]),t("h6",{staticClass:"fw-bold",class:e.order.status.is_available?"text-success":"text-warning"},[e._v(" "+e._s(e.order.status.text)+" ")])]),t("div",[t("b",{staticClass:"small text-secondary"},[e._v("Quantidade")]),t("h5",{staticClass:"fw-bold text-center"},[e._v(" "+e._s(e.$helpers.fallback(e.order.quantity))+" ")])])]),t("div",{staticClass:"mt-3 d-flex flex-column flex-sm-row justify-content-between"},[e.order.print_date?t("div",[t("b",{staticClass:"small text-secondary"},[e._v("Data de estampa")]),t("div",[e._v(" "+e._s(e.$helpers.fallback(e.formatDatetime(e.order.print_date)))+" ")])]):e._e(),e.order.seam_date?t("div",[t("b",{staticClass:"small text-secondary"},[e._v("Data de costura")]),t("div",[e._v(" "+e._s(e.$helpers.fallback(e.formatDatetime(e.order.seam_date)))+" ")])]):e._e(),t("div",[t("b",{staticClass:"small text-secondary"},[e._v("Data de entrega")]),t("div",[e._v(" "+e._s(e.$helpers.fallback(e.formatDatetime(e.order.delivery_date)))+" ")])])])]},proxy:!0}])})},$t=[],Nt=a(Ot,kt,$t,!1,null,null,null,null);const St=Nt.exports;const P=[{abbr:"un",name:"Unidade"},{abbr:"pc",name:"Peça"},{abbr:"pct",name:"Pacote"},{abbr:"cx",name:"Caixa"},{abbr:"m",name:"Metro"}],Pt={components:{},props:{order:{type:Object,required:!0},isDirectCost:{type:Boolean,default:!1}},data:()=>({UNITIES:P,icons:{faBoxOpen:v,faHandHoldingUsd:E},headers:[{text:"Descrição",value:"description"},{text:"Qtd.",value:"quantity",align:"center"},{text:"Unid.",value:"unity"},{text:"Valor",value:"value",format:"currencyBRL"},{text:"Total",value:"total"}]}),computed:{totalValues(){return this.order.products.filter(({value:s})=>this.isDirectCost?s<0:s>0).reduce((s,e)=>Math.abs(s)+Math.abs((e.value*e.quantity).toFixed()),0)}},methods:{getUnityName(s){return P.filter(e=>e.abbr===s)[0].name}}};var wt=function(){var e=this,t=e._self._c;return t("AppContainer",{staticClass:"mt-3",scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.isDirectCost?e.icons.faHandHoldingUsd:e.icons.faBoxOpen,"fixed-width":""}}),e._v(" "+e._s(e.isDirectCost?"Custo direto":"Produtos")+" ")]},proxy:!0},{key:"body",fn:function(){return[t("AppTable",{attrs:{"table-class":"table-sm",headers:e.headers,items:e.order.products.filter(({value:r})=>e.isDirectCost?r<0:r>0)},scopedSlots:e._u([{key:"items.value",fn:function({item:r}){return[e._v(" "+e._s(Math.abs(r.value))+" ")]}},{key:"items.description",fn:function({item:r}){return[t("div",{staticClass:"text-wrap"},[e._v(" "+e._s(r.description)+" ")])]}},{key:"items.unity",fn:function({item:r}){return[t("span",{directives:[{name:"tippy",rawName:"v-tippy"}],attrs:{content:e.getUnityName(r.unity)}},[e._v(e._s(r.unity.toUpperCase()))])]}},{key:"items.total",fn:function({item:r}){return[e._v(" "+e._s(e.$helpers.toBRL(Math.abs((r.value*r.quantity).toFixed(2))))+" ")]}},{key:"bodyAppend",fn:function(){return[t("tr",{class:e.isDirectCost?"table-danger":"table-primary"},[t("td",{staticClass:"text-end fw-bold",attrs:{colspan:"4"}},[e._v(" TOTAL ")]),t("td",{staticClass:"fw-bold"},[e._v(" "+e._s(e.$helpers.toBRL(e.totalValues))+" ")])])]},proxy:!0}],null,!0)})]},proxy:!0}])})},At=[],Dt=a(Pt,wt,At,!1,null,"1a1dd286",null,null);const Rt=Dt.exports,Et={props:{color:{type:String,default:"primary"},label:{type:String,default:""},text:{type:String,default:""},subitems:{type:Array,default:()=>[]}},computed:{computedSubitems(){return this.subitems.filter(s=>s.is_shown!==!1)}}};var Tt=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("b",{staticClass:"small text-secondary"},[e._v(e._s(e.label))])]),t("h5",{staticClass:"mb-0",class:`text-${e.color}`,domProps:{innerHTML:e._s(e.text)}}),e._l(e.computedSubitems,function(r){return t("div",{key:r.label,staticClass:"small",class:r.class??"text-secondary"},[e._v(" "+e._s(r.label)+": "),t("b",[e._v(e._s(r.text))])])})],2)},Ft=[],Lt=a(Et,Tt,Ft,!1,null,null,null,null);const Bt=Lt.exports,It={components:{OrderBodyTotalValueItem:Bt},props:{order:{type:Object,required:!0}},data:()=>({icons:{faDollarSign:O}}),computed:{totalValue(){return this.$helpers.toBRL(this.order.price,!0)},totalProducts(){return this.order.original_price-(this.order.shipping_value||0)},showTotalClothes(){return this.order.discount||this.order.shipping_value},totalValueSubItems(){const s=this.totalProducts,e=this.order.shipping_value,t=this.order.discount;return[{label:"TOTAL PRODUTOS: ",text:this.$helpers.toBRL(s),is_shown:!!this.showTotalClothes,class:"text-primary"},{label:"FRETE: ",text:this.$helpers.toBRL(e,!1,!0),is_shown:!!e},{label:"DESCONTO: ",text:this.$helpers.toBRL(-t),is_shown:!!t}]},totalPaidSubItems(){return[{label:"PATROCÍNIO",text:this.$helpers.toBRL(this.order.total_paid_sponsor),is_shown:this.order.has_sponsor},{label:"CLIENTE",text:this.$helpers.toBRL(this.order.total_paid_non_sponsor),is_shown:this.order.has_sponsor}]}}};var Mt=function(){var e=this,t=e._self._c;return e.order.price!==null?t("AppContainer",{staticClass:"mt-3",scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faDollarSign,"fixed-width":""}}),e._v(" Valor total ")]},proxy:!0},{key:"body",fn:function(){return[t("div",{staticClass:"my-3 d-flex flex-column flex-sm-row justify-content-around"},[t("OrderBodyTotalValueItem",{attrs:{label:"Valor total",text:e.totalValue,subitems:e.totalValueSubItems}}),t("OrderBodyTotalValueItem",{attrs:{label:"Total pago",text:e.$helpers.toBRL(e.order.total_paid,!0),color:"success",subitems:e.totalPaidSubItems}}),t("OrderBodyTotalValueItem",{attrs:{label:"Falta pagar",text:e.$helpers.toBRL(e.order.total_owing,!0),color:e.order.total_owing<=0?"success":"danger"}})],1)]},proxy:!0}],null,!1,2464419279)}):e._e()},Vt=[],jt=a(It,Mt,Vt,!1,null,null,null,null);const qt=jt.exports,Ht={components:{OrderNotes:Le,OrderPayments:Xe,OrderFiles:it,OrderReminder:ae,OrderStatusProgress:ht,OrderActivities:xt,OrderBodyDetails:St,OrderBodyProducts:Rt,OrderBodyTotalValue:qt},props:{order:{type:Object,required:!0},isOrderPreRegistered:{type:Boolean,required:!0}},data(){return{roles:p}},computed:{showReminder(){return this.isOrderPreRegistered&&this.order.reminder}},methods:{formatDatetime:i}};var Ut=function(){var e=this,t=e._self._c;return t("div",[e.showReminder?t("OrderReminder",[e._v(" "+e._s(e.order.reminder)+" ")]):e._e(),t("OrderBodyDetails",{attrs:{order:e.order}}),t("OrderBodyProducts",{attrs:{order:e.order}}),t("OrderBodyProducts",{attrs:{order:e.order,"is-direct-cost":""}}),t("OrderBodyTotalValue",{attrs:{order:e.order}}),e.order.has_order_control?t("OrderStatusProgress",{staticClass:"mt-3",attrs:{order:e.order}}):e._e(),t("OrderNotes",{staticClass:"mt-3",attrs:{"order-id":e.order.id,notes:e.order.notes}}),t("OrderPayments",{staticClass:"mt-3",attrs:{payments:e.order.payments},on:{"open-modal":function(r){return e.$emit("open-modal",r)}}}),t("OrderFiles",{staticClass:"mt-3",attrs:{order:e.order}}),e.$helpers.canView(e.roles.GERENCIA)?t("OrderActivities",{staticClass:"mt-3",attrs:{order:e.order}}):e._e()],1)},Gt=[],Qt=a(Ht,Ut,Gt,!1,null,null,null,null);const zt=Qt.exports,Kt={props:{order:{type:Object,default:()=>({})},isOrderClosed:{type:Boolean,required:!0}},data(){return{icons:{faBoxOpen:v}}},methods:{formatDatetime:i}};var Jt=function(){var e=this,t=e._self._c;return e.order?t("div",{staticClass:"d-flex flex-column flex-sm-row justify-content-between fw-bold align-items-sm-center mb-0"},[t("div",[t("FontAwesomeIcon",{staticClass:"me-1",attrs:{icon:e.icons.faBoxOpen}}),e._v(" Pedido - "+e._s(e.$helpers.fallback(e.order.name,null,"[SEM NOME]"))+" ")],1),e.isOrderClosed?t("div",[e._v(" FECHADO "),t("span",{staticClass:"d-inline d-sm-none"},[e._v("-")]),t("span",{staticClass:"small d-inline d-sm-block"},[e._v(" Em "+e._s(e.formatDatetime(e.order.closed_at))+" ")])]):e._e()]):e._e()},Wt=[],Xt=a(Kt,Jt,Wt,!1,null,null,null,null);const Yt=Xt.exports,Zt={data(){return{icons:{faBoxOpen:v}}}};var er=function(){var e=this,t=e._self._c;return t("AppCard",{scopedSlots:e._u([{key:"header",fn:function(){return[t("h6",{staticClass:"fw-bold mb-0"},[t("FontAwesomeIcon",{staticClass:"me-1",attrs:{icon:e.icons.faBoxOpen}}),e._v("Pedido - ")],1)]},proxy:!0},{key:"body",fn:function(){return[t("div",{staticClass:"py-5"},[t("AppLoading")],1)]},proxy:!0}])})},tr=[],rr=a(Zt,er,tr,!1,null,null,null,null);const sr=rr.exports,ar={components:{TheOrderCardBody:zt,TheOrderCardHeader:Yt,TheOrderCardPlaceholder:sr},props:{isLoading:{type:Boolean,default:!1},order:{type:Object,default:null},isOrderClosed:{type:Boolean,default:!1},isOrderPreRegistered:{type:Boolean,default:!1}},computed:{cardColor(){return this.order.states.includes("CLOSED")?"secondary":this.order.states.includes("PRE-REGISTERED")?"warning":"primary"}},methods:{onOpenModalRequest(s){this.$emit("on-open-modal",s)}}};var or=function(){var e=this,t=e._self._c;return e.isLoading?t("TheOrderCardPlaceholder"):t("AppCard",{attrs:{color:e.cardColor},scopedSlots:e._u([{key:"header",fn:function(){return[t("TheOrderCardHeader",e._b({},"TheOrderCardHeader",{order:e.order,isOrderClosed:e.isOrderClosed},!1))]},proxy:!0},{key:"body",fn:function(){return[t("TheOrderCardBody",e._b({on:{"open-modal":e.onOpenModalRequest}},"TheOrderCardBody",{order:e.order,isOrderPreRegistered:e.isOrderPreRegistered},!1))]},proxy:!0}],null,!1,2889264065)})},nr=[],ir=a(ar,or,nr,!1,null,null,null,null);const lr=ir.exports,dr={props:{status:{type:Object,required:!0}}};var cr=function(){var e=this,t=e._self._c;return t("div",{staticClass:"text-center mb-3"},[t("div",{staticClass:"text-secondary small"},[e._v(" STATUS ATUAL ")]),t("h5",{staticClass:"fw-bold",class:e.status.avaliable?"text-success":"text-warning"},[e._v(" "+e._s(e.status.text)+" ")])])},ur=[],mr=a(dr,cr,ur,!1,null,null,null,null);const pr=mr.exports,fr={props:{value:{type:[Number,String],required:!0},status:{type:Array,required:!0}},methods:{onInputChange(s){this.$emit("input",s)},labelClass(s){return s.pivot.is_confirmed?"text-success fw-bold":""}}};var _r=function(){var e=this,t=e._self._c;return t("div",[t("AppRadio",{attrs:{align:"vertical",value:e.value,name:"order-status",options:e.status,"label-prop":(r,o)=>`${o+1}. ${r.text}`,"value-prop":"id","label-class":e.labelClass},on:{input:e.onInputChange}})],1)},vr=[],hr=a(fr,_r,vr,!1,null,null,null,null);const yr=hr.exports,gr={components:{ModalOrderStatusHeader:pr,ModalOrderStatusOptions:yr,ModalOrderStatusOverrideDates:le},props:{order:{type:Object,default:()=>({})},value:{type:Boolean,default:!1}},data(){return{icons:{faExchangeAlt:w},isLoading:!1,selectedStatus:this.order.status.id,overrideOption:null,overrideStatus:[]}},computed:{status(){return this.order.linked_status},hasOverrideDates(){return!!this.overrideStatus.length}},methods:{onOptionChange(){const s=this.status.find(t=>t.id===this.selectedStatus),e=this.order.status;if(s.order>e.order){const t=this.$helpers.getStatusBetween(e,s,this.status);if(t.some(r=>r.pivot.confirmed_at)){this.overrideStatus=t,this.overrideOption="UPDATE";return}}this.overrideStatus=[]},async updateStatus(){this.isLoading=!0;try{await this.$apollo.mutate({mutation:M,variables:{id:this.order.id,status_id:this.selectedStatus,override_option:this.overrideOption},refetchQueries:[x],awaitRefetchQueries:!0}),g(this,{message:"Status alterado!"})}catch(s){b(this,s)}this.isLoading=!1}}};var br=function(){var e=this,t=e._self._c;return t("AppModal",e._g({attrs:{id:"orderStatusModal",color:"success",centered:"",value:e.value},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faExchangeAlt,"fixed-width":""}}),e._v(" Alterar status do pedido ")]},proxy:!0},{key:"body",fn:function(){return[t("div",{staticClass:"mb-4"},[t("ModalOrderStatusHeader",{attrs:{status:e.order.status}}),t("ModalOrderStatusOptions",{attrs:{status:e.order.linked_status},on:{input:e.onOptionChange},model:{value:e.selectedStatus,callback:function(r){e.selectedStatus=r},expression:"selectedStatus"}})],1),e.hasOverrideDates?t("div",[t("ModalOrderStatusOverrideDates",{attrs:{status:e.overrideStatus},model:{value:e.overrideOption,callback:function(r){e.overrideOption=r},expression:"overrideOption"}})],1):e._e(),t("div",{staticClass:"row mt-3"},[t("div",{staticClass:"col"},[t("AppButton",{staticClass:"fw-bold",attrs:{loading:e.isLoading,color:"success",block:""},on:{click:function(r){return r.preventDefault(),e.updateStatus.apply(null,arguments)}}},[e._v(" Salvar ")])],1),t("div",{staticClass:"col"},[t("AppButton",{attrs:{type:"button",block:"",color:"light","data-bs-dismiss":"modal"}},[e._v(" Fechar ")])],1)])]},proxy:!0}])},e.$listeners))},Cr=[],xr=a(gr,br,Cr,!1,null,null,null,null);const Or=xr.exports,kr={props:{value:{type:Boolean,default:!1},order:{type:Object,default:()=>{}}},data(){return{orderCode:"",icons:{faTrashAlt:_},isLoading:!1}},computed:{isPreConfirmed(){return this.order.code?this.orderCode===this.order.code:!0},clientKey(){return this.$route.params.clientKey},orderKey(){return this.$route.params.orderKey}},methods:{async delete(){await this.$apollo.mutate({mutation:V,variables:{id:this.order.id}}),this.$helpers.clearCacheFrom({id:this.order.id,__typename:"Order"}),this.$emit("success")},deleteOrder(){if(this.isLoading=!0,!this.isPreConfirmed){this.isLoading=!1,this.$toast.error("Confirme o código do pedido primeiramente.");return}this.delete()}}};var $r=function(){var e=this,t=e._self._c;return t("AppModal",e._g({attrs:{id:"orderDeleteModal",color:"danger",centered:"",value:e.value},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Deletar pedido - "+e._s(e.order.code)+" ")]},proxy:!0},{key:"body",fn:function(){return[t("div",[t("div",{staticClass:"text-center"},[t("FontAwesomeIcon",{staticClass:"text-danger",attrs:{icon:e.icons.faTrashAlt,size:"4x"}}),t("h5",{staticClass:"fw-bold mt-3"},[e._v(" Você tem certeza? ")]),t("div",[e._v("Isso deleterá todos os pagamentos, anexos e anotações do pedido.")])],1),e.order.code?t("div",{staticClass:"mt-3"},[t("AppInput",{attrs:{id:"code",name:"code",placeholder:"Digite o código do pedido..."},model:{value:e.orderCode,callback:function(r){e.orderCode=r},expression:"orderCode"}},[e._v(" Confirme o código do pedido ("+e._s(e.order.code)+"): ")])],1):e._e(),t("div",{staticClass:"row mt-5"},[t("div",{staticClass:"col"},[t("AppButton",{staticClass:"fw-bold",attrs:{color:"success",disabled:!e.isPreConfirmed,loading:e.isLoading,block:""},on:{click:e.deleteOrder}},[e._v(" CONFIRMAR ")])],1),t("div",{staticClass:"col"},[t("AppButton",{attrs:{"data-bs-dismiss":"modal",color:"light",block:""}},[e._v(" Cancelar ")])],1)])])]},proxy:!0}])},e.$listeners))},Nr=[],Sr=a(kr,$r,Nr,!1,null,null,null,null);const Pr=Sr.exports,wr={metaInfo(){if(l(this.order))return{title:"Carregando..."};if(this.isOrderPreRegistered)return{title:"PRE-REGISTRO"};if(this.order)return{title:this.order.code}},components:{ClientCard:se,TheOrderCard:lr,TheOrderHeader:ye,ModalPaymentForm:T,ModalOrderStatus:Or,ModalOrderDelete:Pr},mixins:[q],apollo:{order:{query:x,fetchPolicy:"no-cache",variables(){const{clientKey:s,orderKey:e}=this.$route.params;return{id:e,client_id:s}},result({data:{order:s}}){s||this.$store.commit("SET_ERROR",404)}}},data(){return{order:{},modalOrderPayment:{payment:null,value:!1,isEdit:!1},modalOrderStatus:{value:!1},modalOrderDelete:{value:!1},modalOrderReport:{value:!1,src:"",loading:!1}}},computed:{isLoading(){return l(this.order)}},methods:{refreshOrder(){this.$apollo.queries.order.refetch()},openModal(s){this[s].value=!0},closeModal(s){this[s].value=!1},onModalPaymentHidden(){this.modalOrderPayment.payment=null},async openModalReport(){this.modalOrderReport.loading=!0;const{data:s}=await this.$apollo.query({query:j,variables:{id:this.order.id},fetchPolicy:"network-only"});this.modalOrderReport.loading=!1,this.modalOrderReport.src=s.orderReport,this.openModal("modalOrderReport")},onCloseModalReport(){this.modalOrderReport.src=""},openModalOrderPayment({payment:s,isEdit:e}){this.modalOrderPayment.isEdit=e,this.modalOrderPayment.payment=s||null,this.modalOrderPayment.value=!0},onPaymentCreated(){this.closeModal("modalOrderPayment"),this.refreshOrder()},onStatusUpdated(){this.closeModal("modalOrderStatus")},onOrderDeleted(){this.closeModal("modalOrderDelete"),this.$nextTick(()=>{if(!this.order.client){this.$helpers.redirectTo(y.index);return}this.$helpers.redirectTo(y.show,{client:this.order.client})})},onOpenModal({modal:s,payload:e}){s==="payment"&&this.openModalOrderPayment(e),s==="delete-order"&&this.openModal("modalOrderDelete"),s==="change-status"&&this.openModal("modalOrderStatus"),s==="report"&&this.openModalReport()}}};var Ar=function(){var e=this,t=e._self._c;return t("div",{staticClass:"py-5 mx-auto"},[e.isLoading?e._e():t("ModalPaymentForm",e._b({on:{success:e.onPaymentCreated,hidden:e.onModalPaymentHidden},model:{value:e.modalOrderPayment.value,callback:function(r){e.$set(e.modalOrderPayment,"value",r)},expression:"modalOrderPayment.value"}},"ModalPaymentForm",{...e.modalOrderPayment,order:e.order},!1)),e.isLoading?e._e():t("ModalOrderStatus",{attrs:{order:e.order},on:{success:e.onStatusUpdated},model:{value:e.modalOrderStatus.value,callback:function(r){e.$set(e.modalOrderStatus,"value",r)},expression:"modalOrderStatus.value"}}),e.isLoading?e._e():t("ModalOrderDelete",{attrs:{order:e.order},on:{success:e.onOrderDeleted},model:{value:e.modalOrderDelete.value,callback:function(r){e.$set(e.modalOrderDelete,"value",r)},expression:"modalOrderDelete.value"}}),e.isLoading?e._e():t("AppFileModal",{attrs:{id:"orderReport",src:e.modalOrderReport.src,title:"Relatório do pedido"},on:{hidden:e.onCloseModalReport},model:{value:e.modalOrderReport.value,callback:function(r){e.$set(e.modalOrderReport,"value",r)},expression:"modalOrderReport.value"}}),t("div",[t("TheOrderHeader",e._b({staticClass:"mb-2",on:{"open-modal":e.onOpenModal,"toggle-success":e.refreshOrder}},"TheOrderHeader",{order:e.order,isLoading:e.isLoading,isOrderClosed:e.isOrderClosed,isOrderPaid:e.isOrderPaid,isOrderPreRegistered:e.isOrderPreRegistered,isReportLoading:e.modalOrderReport.loading},!1))],1),t("div",{staticClass:"d-flex row flex-column flex-sm-row"},[t("div",{staticClass:"col col-sm-3 mb-2 mb-sm-0"},[t("ClientCard",{attrs:{"is-loading":e.isLoading,client:e.order.client}})],1),t("div",{staticClass:"col col-sm-9"},[t("TheOrderCard",e._b({on:{"on-open-modal":e.onOpenModal}},"TheOrderCard",{isLoading:e.isLoading,isOrderClosed:e.isOrderClosed,isOrderPreRegistered:e.isOrderPreRegistered,order:e.order},!1))],1)])],1)},Dr=[],Rr=a(wr,Ar,Dr,!1,null,null,null,null);const Wr=Rr.exports;export{Wr as default};
