import{E as U,u as y,a as k,G as x}from"./User-8fb57da5.js";import{n as a,bo as v,p as h,F as u,s as m,u as f,aR as C,i as A,N as $,W as S,Z as w}from"./index-4e05606f.js";var p={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"roles"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"roles"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:45}};p.loc.source={body:`query roles {
  roles {
    id
    name
  }
}`,name:"GraphQL request",locationOffset:{line:1,column:1}};function c(r,e){if(r.kind==="FragmentSpread")e.add(r.name.value);else if(r.kind==="VariableDefinition"){var s=r.type;s.kind==="NamedType"&&e.add(s.name.value)}r.selectionSet&&r.selectionSet.selections.forEach(function(t){c(t,e)}),r.variableDefinitions&&r.variableDefinitions.forEach(function(t){c(t,e)}),r.definitions&&r.definitions.forEach(function(t){c(t,e)})}var d={};(function(){p.definitions.forEach(function(e){if(e.name){var s=new Set;c(e,s),d[e.name.value]=s}})})();function _(r,e){for(var s=0;s<r.definitions.length;s++){var t=r.definitions[s];if(t.name&&t.name.value==e)return t}}function M(r,e){var s={kind:r.kind,definitions:[_(r,e)]};r.hasOwnProperty("loc")&&(s.loc=r.loc);var t=d[e]||new Set,o=new Set,i=new Set;for(t.forEach(function(n){i.add(n)});i.size>0;){var g=i;i=new Set,g.forEach(function(n){if(!o.has(n)){o.add(n);var l=d[n]||new Set;l.forEach(function(b){i.add(b)})}})}return o.forEach(function(n){var l=_(r,n);l&&s.definitions.push(l)}),s}const D=M(p,"roles"),E={props:{items:{type:Array,default:()=>[]}},data(){return{icons:{faUserEdit:v,faTrashAlt:h}}},computed:{authUser(){return this.$store.getters["auth/authUser"]},headers(){return[{text:"Nome",value:"name"},{text:"E-mail",value:"email"},{text:"Nível de usuário",value:"role.name"},{text:"Editar",value:"change_role",align:"center"},{text:"Deletar",value:"delete",align:"center"}]},cantEditOwnAccountMessage(){return"Use o menu Minha conta para alterar os próprios dados"},cantDeleteOwnAccountMessage(){return"Use o menu Minha conta para deletar a própria conta"}},methods:{onEditUserClick(r){this.$emit("action-button-clicked",{user:r,action:"edit_user"})},onDeleteUserClick(r){this.$emit("action-button-clicked",{user:r,action:"delete_user"})},isAuthUser(r){return r.id===this.authUser.id}}};var F=function(){var e=this,s=e._self._c;return s("AppTable",{attrs:{headers:e.headers,items:e.items},scopedSlots:e._u([{key:"items.change_role",fn:function({item:t}){return[s("AppButton",{attrs:{"disabled-message":e.isAuthUser(t)&&e.cantEditOwnAccountMessage,"btn-class":"btn-sm",icon:e.icons.faUserEdit,outlined:""},on:{click:function(o){return o.preventDefault(),e.onEditUserClick(t)}}})]}},{key:"items.delete",fn:function({item:t}){return[s("AppButton",{attrs:{"disabled-message":e.isAuthUser(t)&&e.cantDeleteOwnAccountMessage,"btn-class":"btn-sm",color:"danger",icon:e.icons.faTrashAlt,outlined:""},on:{click:function(o){return o.preventDefault(),e.onDeleteUserClick(t)}}})]}}],null,!0)})},N=[],L=a(E,F,N,!1,null,null,null,null);const R=L.exports,B={props:{user:{type:Object,required:!0},roles:{type:Array,required:!0}},data(){return{changePassword:!1,isLoading:!1,form:new u({role:"",password:""})}},mounted(){this.form.role=this.user.role.id},methods:{async submit(){const r=this.form.data();this.isLoading=!0;try{await this.$apollo.mutate({mutation:U,variables:{id:this.user.id,input:r}}),m(this,{message:"Usuário atualizado!"})}catch(e){f(this,e)}this.isLoading=!1}}};var I=function(){var e=this,s=e._self._c;return s("AppForm",{attrs:{"on-submit":e.submit,form:e.form}},[s("label",{staticClass:"form-label fw-bold"},[e._v("Selecione o privilégio: ")]),s("div",{staticClass:"ms-2"},[s("AppRadio",{attrs:{options:e.roles,name:"role","label-prop":"name","value-prop":"id",align:"vertical"},model:{value:e.form.role,callback:function(t){e.$set(e.form,"role",t)},expression:"form.role"}})],1),s("AppCheckbox",{attrs:{id:"changePassword"},model:{value:e.changePassword,callback:function(t){e.changePassword=t},expression:"changePassword"}},[e._v(" Alterar senha ")]),s("AppInput",{directives:[{name:"show",rawName:"v-show",value:e.changePassword,expression:"changePassword"}],attrs:{id:"password",name:"password",type:"password",placeholder:"Digite uma nova senha..."},scopedSlots:e._u([{key:"hint",fn:function(){return[e._v(" Deixe em branco caso não queira alterar. ")]},proxy:!0}]),model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}},[e._v(" Nova senha: ")]),s("div",{staticClass:"row mt-4"},[s("div",{staticClass:"col"},[s("AppButton",{attrs:{type:"submit","btn-class":"fw-bold",color:"success",block:"",loading:e.isLoading}},[e._v(" Atualizar ")])],1),s("div",{staticClass:"col"},[s("AppButton",{attrs:{type:"button",color:"light","data-bs-dismiss":"modal",block:"",disabled:e.isLoading}},[e._v(" Cancelar ")])],1)])],1)},P=[],T=a(B,I,P,!1,null,null,null,null);const O=T.exports,q={components:{EditUserForm:O},props:{value:{type:Boolean,default:!1},user:{type:Object,default:()=>({})},roles:{type:Array,default:()=>[]}},data(){return{icons:{faUserEdit:v,faUserCircle:C}}},methods:{onSuccess(){this.$emit("success")}}};var z=function(){var e=this,s=e._self._c;return s("AppModal",e._g({attrs:{id:"changeUserRoleModal",value:e.value,centered:""},scopedSlots:e._u([{key:"title",fn:function(){return[s("FontAwesomeIcon",{attrs:{icon:e.icons.faUserEdit,"fixed-width":""}}),e._v(" Editar dados do usuário ")]},proxy:!0},{key:"body",fn:function(){return[s("div",{staticClass:"text-center text-primary mb-3"},[s("FontAwesomeIcon",{attrs:{icon:e.icons.faUserCircle,size:"4x"}})],1),s("h5",{staticClass:"text-center fw-bold mb-2"},[e._v(" "+e._s(e.user.name)+" ")]),s("div",{staticClass:"text-center"},[s("small",[e._v(e._s(e.user.email))])]),s("hr"),e.value?s("EditUserForm",{attrs:{roles:e.roles,user:e.user},on:{success:e.onSuccess}}):e._e()]},proxy:!0}])},e.$listeners))},G=[],H=a(q,z,G,!1,null,null,null,null);const j=H.exports,Q={props:{value:{type:Boolean,default:!1},user:{type:Object,default:()=>({})}},data(){return{form:new u({auth_password:""}),icons:{faTrashAlt:h},isLoading:!1}},methods:{isEmpty:A,formatDatetime:$,async onDeleteClick(){this.isLoading=!0;try{await this.$apollo.mutate({mutation:y,variables:{id:this.user.id,auth_password:this.form.auth_password}}),this.$helpers.clearCacheFrom({fieldName:"users"}),m(this,{message:"Usuário deletado!",resetForm:!0})}catch(r){f(this,r)}this.isLoading=!1}}};var V=function(){var e=this,s=e._self._c;return s("AppModal",e._g({attrs:{id:"deleteUserModal",value:e.value,color:"danger",centered:""},scopedSlots:e._u([{key:"title",fn:function(){return[s("FontAwesomeIcon",{attrs:{icon:e.icons.faTrashAlt,"fixed-width":""}}),e._v(" Deletar usuário ")]},proxy:!0},e.isEmpty(e.user)?null:{key:"body",fn:function(){return[s("div",{staticClass:"text-center"},[s("FontAwesomeIcon",{staticClass:"text-danger",attrs:{icon:e.icons.faTrashAlt,size:"4x"}})],1),s("div",{staticClass:"text-danger text-center mt-3 fw-bold"},[e._v(" Você está deletando o seguinte usuário: ")]),s("h5",{staticClass:"text-center fw-bold mt-3"},[e._v(" "+e._s(e.user.name)+" ")]),s("ul",{staticClass:"list-group list-group-flush"},[s("li",{staticClass:"list-group-item"},[s("b",[e._v("Email:")]),e._v(" "+e._s(e.user.email)+" ")]),s("li",{staticClass:"list-group-item"},[s("b",[e._v("Privilégio:")]),e._v(" "+e._s(e.user.role.name)+" ")]),s("li",{staticClass:"list-group-item"},[s("b",[e._v("Cadastrado em:")]),e._v(" "+e._s(e.formatDatetime(e.user.created_at))+" ")])]),s("div",{staticClass:"text-secondary small mt-3"},[e._v(" A exclusão deste usuário não afeta nenhum dado no sistema. ")]),s("div",{staticClass:"mt-3"},[s("AppForm",{attrs:{form:e.form,"on-submit":e.onDeleteClick}},[s("input",{attrs:{type:"text",hidden:"",name:"email",autocomplete:"new-email"}}),s("AppInput",{attrs:{type:"password",name:"auth_password",autocomplete:"new-password",error:e.form.errors.get("auth_password")},model:{value:e.form.auth_password,callback:function(t){e.$set(e.form,"auth_password",t)},expression:"form.auth_password"}},[e._v(" Digite sua senha para confirmar: ")])],1)],1),s("div",{staticClass:"mt-4"},[s("AppButton",{attrs:{"btn-class":"fw-bold",color:"success",block:"",loading:e.isLoading},on:{click:function(t){return t.preventDefault(),e.onDeleteClick.apply(null,arguments)}}},[e._v(" Confirmar ")])],1)]},proxy:!0}],null,!0)},e.$listeners))},W=[],Z=a(Q,V,W,!1,null,null,null,null);const J=Z.exports,K={components:{TheUsersCardTable:R,EditUserModal:j,DeleteUserModal:J},props:{isLoading:{type:Boolean,default:!1},users:{type:Array,default:()=>[]},roles:{type:Array,default:()=>[]}},data(){return{editUserModal:{modal:!1,user:{}},deleteUser:{modal:!1,user:{}},icons:{faUsers:S}}},methods:{onDeleteUserSuccess(){this.deleteUser.modal=!1,this.deleteUser.user={}},onDeleteUserModalHidden(){this.deleteUser.user={}},onEditSuccess(){this.editUserModal.modal=!1,this.editUserModal.user={}},onEditModalHidden(){this.editUserModal.user={}},onActionButtonClicked({user:r,action:e}){if(e==="edit_user"){this.editUserModal.user=r,this.editUserModal.modal=!0;return}if(e==="delete_user"){this.deleteUser.user=r,this.deleteUser.modal=!0;return}throw new Error("Nenhuma action foi identificada no evento")}}};var X=function(){var e=this,s=e._self._c;return s("AppCard",{attrs:{color:"camaleao"},scopedSlots:e._u([{key:"header",fn:function(){return[s("h6",{staticClass:"fw-bold mb-0"},[s("FontAwesomeIcon",{attrs:{icon:e.icons.faUsers,"fixed-width":""}}),e._v(" Gerenciamento de usuários do sistema ")],1)]},proxy:!0},{key:"body",fn:function(){return[s("EditUserModal",{attrs:{user:e.editUserModal.user,roles:e.roles},on:{hidden:e.onEditModalHidden,success:e.onEditSuccess},model:{value:e.editUserModal.modal,callback:function(t){e.$set(e.editUserModal,"modal",t)},expression:"editUserModal.modal"}}),s("DeleteUserModal",{attrs:{user:e.deleteUser.user},on:{hidden:e.onDeleteUserModalHidden,success:e.onDeleteUserSuccess},model:{value:e.deleteUser.modal,callback:function(t){e.$set(e.deleteUser,"modal",t)},expression:"deleteUser.modal"}}),s("AppLoading",{directives:[{name:"show",rawName:"v-show",value:e.isLoading,expression:"isLoading"}]}),s("TheUsersCardTable",{attrs:{items:e.users},on:{"action-button-clicked":e.onActionButtonClicked}})]},proxy:!0}])})},Y=[],ee=a(K,X,Y,!1,null,null,null,null);const se=ee.exports,te={props:{roles:{type:Array,default:()=>[]}},data(){return{isLoading:!1,form:new u({name:"",email:"",password:"",password_confirmation:"",role_id:""})}},methods:{async onSubmit(){const r=this.form.data();this.isLoading=!0;try{await this.$apollo.mutate({mutation:k,variables:{input:r}}),this.$helpers.clearCacheFrom({fieldName:"users"}),m(this,{message:"Usuário cadastrado!",resetForm:!0})}catch(e){f(this,e)}this.isLoading=!1}}};var re=function(){var e=this,s=e._self._c;return s("AppForm",{attrs:{form:e.form,"on-submit":e.onSubmit}},[s("AppInput",{attrs:{id:"name",name:"name",placeholder:"Digite o nome...",autocomplete:"off",error:e.form.errors.get("name")},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}},[e._v(" Nome ")]),s("AppInput",{attrs:{id:"email",name:"email",autocomplete:"off",placeholder:"Digite o email...",error:e.form.errors.get("email")},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}},[e._v(" Email ")]),s("div",{staticClass:"row"},[s("div",{staticClass:"col-12 col-sm"},[s("AppInput",{attrs:{id:"password",name:"password",type:"password",placeholder:"Digite uma senha...",autocomplete:"new-password",error:e.form.errors.get("password")},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}},[e._v(" Senha ")])],1),s("div",{staticClass:"col-12 col-sm"},[s("AppInput",{attrs:{id:"password_confirmation",name:"password_confirmation",type:"password",placeholder:"Repita a senha...",autocomplete:"new-password",error:e.form.errors.get("password_confirmation")},model:{value:e.form.password_confirmation,callback:function(t){e.$set(e.form,"password_confirmation",t)},expression:"form.password_confirmation"}},[e._v(" Confirme a senha ")])],1)]),s("AppSimpleSelect",{attrs:{id:"role_id",name:"role_id","label-prop":"name",options:e.roles,placeholder:"Selecione o privilégio",error:e.form.errors.get("role_id")},model:{value:e.form.role_id,callback:function(t){e.$set(e.form,"role_id",t)},expression:"form.role_id"}},[e._v(" Privilégio de usuário ")]),s("div",{staticClass:"row mt-4"},[s("div",{staticClass:"col"},[s("AppButton",{attrs:{"btn-class":"fw-bold",color:"success",block:"",loading:e.isLoading},on:{click:function(t){return t.preventDefault(),e.onSubmit.apply(null,arguments)}}},[e._v(" Cadastrar ")])],1),s("div",{staticClass:"col"},[s("AppButton",{attrs:{type:"button","data-bs-dismiss":"modal",block:"",color:"light"}},[e._v(" Cancelar ")])],1)])],1)},ae=[],oe=a(te,re,ae,!1,null,null,null,null);const ne=oe.exports,ie={components:{NewUserForm:ne},props:{value:{type:Boolean,default:!1},roles:{type:Array,default:()=>[]}},data(){return{icons:{faUserPlus:w}}},methods:{onSuccess(){this.$emit("success")}}};var le=function(){var e=this,s=e._self._c;return s("AppModal",e._g({attrs:{id:"newUserModal",color:"success",value:e.value,centered:""},scopedSlots:e._u([{key:"title",fn:function(){return[s("FontAwesomeIcon",{attrs:{icon:e.icons.faUserPlus,"fixed-width":""}}),e._v(" Novo usuário ")]},proxy:!0},{key:"body",fn:function(){return[s("NewUserForm",{attrs:{roles:e.roles},on:{success:e.onSuccess}})]},proxy:!0}])},e.$listeners))},ce=[],de=a(ie,le,ce,!1,null,null,null,null);const ue=de.exports,me={metaInfo:{title(){return"Usuários"}},components:{TheUsersCard:se,NewUserModal:ue},apollo:{users:{query:x},roles:{query:D}},data(){return{users:[],roles:[],icons:{faUserPlus:w},newUserModal:!1}},computed:{isLoading(){return!!this.$apollo.queries.users.loading}},methods:{onNewUserSuccess(){this.newUserModal=!1},onNewUserClick(){this.newUserModal=!0}}};var fe=function(){var e=this,s=e._self._c;return s("div",{staticClass:"py-5"},[s("div",{staticClass:"mb-2"},[s("AppButton",{attrs:{icon:e.icons.faUserPlus,color:"success","btn-class":"fw-bold"},on:{click:function(t){return t.preventDefault(),e.onNewUserClick.apply(null,arguments)}}},[e._v(" Novo usuário ")])],1),s("NewUserModal",{attrs:{roles:e.roles},on:{success:e.onNewUserSuccess},model:{value:e.newUserModal,callback:function(t){e.newUserModal=t},expression:"newUserModal"}}),s("TheUsersCard",{attrs:{users:e.users,roles:e.roles,"is-loading":e.isLoading}})],1)},pe=[],_e=a(me,fe,pe,!1,null,null,null,null);const we=_e.exports;export{we as default};
