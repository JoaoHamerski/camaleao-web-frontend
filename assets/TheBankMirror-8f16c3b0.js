import{n as s,T as c,z as u,A as d,B as p,r as m,C as i,u as l,E as f,o as v}from"./index-4e05606f.js";import{C as _,T as k,a as h,G as y,b as M}from"./SelectEntriesFind-d5313c57.js";import{D as b}from"./DailyPaymentForm-8c42f9fc.js";import{E as x}from"./ExpensesForm-277188ad.js";import"./_PaginatorFragment-c01a3fe7.js";import"./Via-eb0eedf9.js";import"./Payment-7f758fb7.js";import"./DailyCash-da8f8b01.js";import"./PaymentExpense-9583d97d.js";import"./masks-168ccaff.js";import"./SelectClientsFind-5d32440f.js";import"./Resources-b591129f.js";import"./omit-49c12860.js";import"./filesMixin-04d56c50.js";import"./filter-bdbeaf8b.js";import"./pasteFilesMixin-1129ca11.js";import"./Expense-8b8780bc.js";import"./User-8fb57da5.js";import"./ViewerItemsCardFile-0d33846c.js";import"./vue-load-image-d69823bb.js";import"./has-81565ca3.js";import"./truncate-000a7a5d.js";const g={components:{Tippy:c},props:{entries:{type:Array,required:!0}},data(){return{confirmPromptId:"",loadingItemId:"",icons:{faPlus:u,faCheck:d}}},computed:{headers(){return[{value:"add-option",text:"Vincular",align:"center"},{value:"value",text:"Valor",format:"currencyBRL"},{value:"date",text:"Data",format:"datetime"},{value:"description",text:"Descrição",wrap:!0},{value:"confirm-option",text:"Confirmar",align:"center"}]}},methods:{get:p,formatCurrencyBRL:m,getEntryColor(n){return n.value>0?"success":"danger"},linkEntry(n){if(n.value>0){this.$emit("link-payment",n);return}this.$emit("link-expense",n)},setConfirmEntry({id:n}){this.confirmPromptId=n},async confirmEntry(){const n=this.confirmPromptId;this.loadingItemId=n;try{await this.$apollo.mutate({mutation:_,variables:{id:n}}),this.$helpers.clearCacheFrom([{fieldName:"cashFlowEntries"},{fieldName:"expenses"},{fieldName:"dailyCash"},{fieldName:"dailyCashBalance"}]),this.$toast.success("Entrada confirmada!")}catch{this.$toast.error("Ops! Algo deu errado.")}this.loadingItemId="",this.closeConfirmPrompt()},closeConfirmPrompt(){this.confirmPromptId=""},rowClass(n){return n.value>0?"table-success":"table-danger"}}};var B=function(){var e=this,r=e._self._c;return r("AppTable",{attrs:{"row-class":e.rowClass,headers:e.headers,items:e.entries},scopedSlots:e._u([{key:"items.value",fn:function({item:a}){return[r("span",{staticClass:"fw-bold",class:`text-${e.getEntryColor(a)}`},[e._v(e._s(e.formatCurrencyBRL(a.value)))])]}},{key:"items.add-option",fn:function({item:a}){return[r("AppButton",{attrs:{"btn-class":"btn-sm",icon:e.icons.faPlus,disabled:a.is_tied,color:a.is_tied?"secondary":e.getEntryColor(a)},on:{click:function(t){return t.preventDefault(),e.linkEntry(a)}}})]}},{key:"items.confirm-option",fn:function({item:a}){return[r("Tippy",{attrs:{trigger:"click",placement:"left","on-shown":()=>e.setConfirmEntry(a),"on-hidden":()=>e.closeConfirmPrompt(),interactive:""},scopedSlots:e._u([{key:"trigger",fn:function(){return[r("AppButton",{attrs:{"btn-class":"btn-sm",color:a.is_confirmed?"secondary":"success",icon:e.icons.faCheck,disabled:a.is_confirmed||a.id===e.loadingItemId,loading:a.isLoading}})]},proxy:!0}],null,!0)},[a.is_confirmed?r("span",[e._v("Já confirmado")]):r("span",[r("AppButton",{staticClass:"me-1",attrs:{"btn-class":"btn-sm fw-bold",color:"success",loading:e.loadingItemId===a.id,disabled:a.is_confirmed},on:{click:function(t){return t.preventDefault(),e.confirmEntry.apply(null,arguments)}}},[e._v(" Confirmar ")])],1)])]}}],null,!0)})},E=[],$=s(g,B,E,!1,null,null,null,null);const C=$.exports,w={components:{DailyPaymentForm:b},props:{value:{type:Boolean,default:!1},payment:{type:Object,required:!0}},data(){return{icons:{faLink:i},isLoading:!1}},methods:{async onSubmit(n,e){const r=e(n.data());this.isLoading=!0;try{await this.$apollo.mutate({mutation:k,variables:{input:r}}),this.$helpers.clearCacheFrom([{fieldName:"dailyCash"},{fieldName:"cashFlowEntries"}]),this.$toast.success("Vinculado com sucesso!"),this.$emit("success")}catch(a){l(this.$refs.dailyPaymentForm,a)}this.isLoading=!1}}};var P=function(){var e=this,r=e._self._c;return r("AppModal",e._g({attrs:{id:"bankMirrorPaymentModal",value:e.value},scopedSlots:e._u([{key:"title",fn:function(){return[r("FontAwesomeIcon",{attrs:{icon:e.icons.faLink,"fixed-width":""}}),e._v(" Vincular pagamento ")]},proxy:!0},{key:"body",fn:function(){return[e.value?r("DailyPaymentForm",{ref:"dailyPaymentForm",attrs:{payment:e.payment},scopedSlots:e._u([{key:"footer",fn:function({form:a,getFormattedForm:t}){return[r("div",{staticClass:"row"},[r("div",{staticClass:"col"},[r("AppButton",{staticClass:"fw-bold",attrs:{color:"success",block:"",loading:e.isLoading,icon:e.icons.faLink},on:{click:function(o){return o.preventDefault(),e.onSubmit(a,t)}}},[e._v(" Vincular ")])],1),r("div",{staticClass:"col"},[r("AppButton",{attrs:{color:"light","data-bs-dismiss":"modal",type:"button",block:"",disabled:e.isLoading}},[e._v(" Cancelar ")])],1)])]}}],null,!1,1571659860)}):e._e()]},proxy:!0}])},e.$listeners))},L=[],N=s(w,P,L,!1,null,null,null,null);const A=N.exports,F={components:{ExpensesForm:x},props:{value:{type:Boolean,default:!1},expense:{type:Object,required:!0}},data(){return{isLoading:!1,icons:{faLink:i}}},methods:{async onSubmit(n,e){const r=e(n);this.isLoading=!0;try{await this.$apollo.mutate({mutation:h,variables:{input:r}}),this.$helpers.clearCacheFrom([{fieldName:"expenses"},{fieldName:"cashFlowEntries"}]),this.$toast.success("Vinculado com sucesso!"),this.$emit("success")}catch(a){l(this.$refs.expensesForm,a)}this.isLoading=!1}}};var I=function(){var e=this,r=e._self._c;return r("AppModal",e._g({attrs:{id:"bankMirrorExpenseModal",value:e.value},scopedSlots:e._u([{key:"title",fn:function(){return[r("FontAwesomeIcon",{attrs:{icon:e.icons.faLink,"fixed-width":""}}),e._v(" Vincular despesa ")]},proxy:!0},{key:"body",fn:function(){return[e.value?r("ExpensesForm",{ref:"expensesForm",attrs:{expense:e.expense,"hide-bank-entries":""},scopedSlots:e._u([{key:"footer",fn:function({form:a,getFormattedForm:t}){return[r("div",{staticClass:"row"},[r("div",{staticClass:"col"},[r("AppButton",{attrs:{color:"success",block:"","btn-class":"fw-bold",loading:e.isLoading,icon:e.icons.faLink},on:{click:function(o){return o.preventDefault(),e.onSubmit(a,t)}}},[e._v(" Vincular ")])],1),r("div",{staticClass:"col"},[r("AppButton",{attrs:{block:"","data-bs-dismiss":"modal",color:"light",disabled:e.isLoading}},[e._v(" Cancelar ")])],1)])]}}],null,!1,3649320577)}):e._e()]},proxy:!0}])},e.$listeners))},S=[],V=s(F,I,S,!1,null,null,null,null);const D=V.exports,T={components:{BankMirrorTable:C,BankMirrorPaymentModal:A,BankMirrorExpenseModal:D},props:{entries:{type:Array,default:()=>[]}},data(){return{bankMirrorExpenseModal:{value:!1,expense:{}},bankMirrorPaymentModal:{value:!1,payment:{}}}},methods:{openModalPayment(n){this.bankMirrorPaymentModal.payment={value:n.value,date:n.date,bank_uid:n.bank_uid,via_id:n.via_id,note:n.description},this.bankMirrorPaymentModal.value=!0},onBankPaymentModalSuccess(){this.bankMirrorPaymentModal.value=!1,this.bankMirrorPaymentModal.payment={}},openModalExpense(n){this.bankMirrorExpenseModal.expense={bank_uid:n.bank_uid,description:n.description,expense_via_id:n.via_id,date:n.date,value:Math.abs(n.value)},this.bankMirrorExpenseModal.value=!0},onBankExpenseModalSuccess(){this.bankMirrorExpenseModal.value=!1,this.bankMirrorExpenseModal.expense={}}}};var R=function(){var e=this,r=e._self._c;return r("div",{staticClass:"my-2"},[r("BankMirrorPaymentModal",{attrs:{payment:e.bankMirrorPaymentModal.payment},on:{success:e.onBankPaymentModalSuccess},model:{value:e.bankMirrorPaymentModal.value,callback:function(a){e.$set(e.bankMirrorPaymentModal,"value",a)},expression:"bankMirrorPaymentModal.value"}}),r("BankMirrorExpenseModal",{attrs:{expense:e.bankMirrorExpenseModal.expense},on:{success:e.onBankExpenseModalSuccess},model:{value:e.bankMirrorExpenseModal.value,callback:function(a){e.$set(e.bankMirrorExpenseModal,"value",a)},expression:"bankMirrorExpenseModal.value"}}),e.entries.length?r("div",[r("BankMirrorTable",{attrs:{entries:e.entries},on:{"link-payment":e.openModalPayment,"link-expense":e.openModalExpense}})],1):r("div",{staticClass:"my-5 text-center text-secondary"},[e._v(" Nenhuma entrada encontrada ")])],1)},q=[],Q=s(T,R,q,!1,null,null,null,null);const j=Q.exports,G={components:{BankMirrorEntries:j},apollo:{entriesBankMirror:{query:y,deep:!0,variables(){return{...this.entriesBankMirrorVars}},skip(){return this.skipEntriesBankMirror}},entriesBankMirrorNavs:{query:M,update({entriesBankMirrorNavs:n}){return n.map(({via:{id:e,name:r},count:a})=>({id:e,value:e,text:r,count:a}))},result(){this.isViaLoaded=!0,this.skipEntriesBankMirror=!1}}},data(){return{entriesBankMirrorNavs:[],isViaLoaded:!1,skipEntriesBankMirror:!0,entriesBankMirror:{data:[],paginatorInfo:{}},entriesBankMirrorVars:{first:10,page:1,where:{column:"VIA_ID",operator:"EQ",value:""}}}},computed:{isEntriesQueryLoading(){return!!this.$apollo.queries.entriesBankMirror.loading},isNavsQueryLoading(){return!!this.$apollo.queries.entriesBankMirrorNavs.loading}},watch:{isViaLoaded(n){n&&this.onNavSelected(this.entriesBankMirrorNavs[0].id)}},methods:{refreshEntries(){this.$apollo.queries.entriesBankMirror.refetch()},onNavSelected(n){this.entriesBankMirrorVars.where.value=n}}};var O=function(){var e=this,r=e._self._c;return r("div",[r("AppLoading",{directives:[{name:"show",rawName:"v-show",value:e.isNavsQueryLoading,expression:"isNavsQueryLoading"}]}),r("AppNavPills",{attrs:{items:e.entriesBankMirrorNavs},on:{"nav-selected":e.onNavSelected},scopedSlots:e._u([e._l(e.entriesBankMirrorNavs,function(a){return{key:`${a.id}`,fn:function(){return[r("div",{key:a.id,staticClass:"position-relative"},[r("AppLoading",{directives:[{name:"show",rawName:"v-show",value:e.isEntriesQueryLoading,expression:"isEntriesQueryLoading"}]}),r("BankMirrorEntries",{attrs:{entries:e.entriesBankMirror.data}})],1)]},proxy:!0}})],null,!0)}),r("AppPaginator",{attrs:{pagination:e.entriesBankMirror.paginatorInfo,"is-loading":e.isEntriesQueryLoading},model:{value:e.entriesBankMirrorVars.page,callback:function(a){e.$set(e.entriesBankMirrorVars,"page",a)},expression:"entriesBankMirrorVars.page"}})],1)},z=[],J=s(G,O,z,!1,null,null,null,null);const H=J.exports,K={components:{BankMirrorNavs:H},data(){return{icons:{faFileInvoiceDollar:f,faSyncAlt:v}}},methods:{onRefreshClick(){this.$refs.bankMirrorNavs.refreshEntries()}}};var U=function(){var e=this,r=e._self._c;return r("AppCard",{scopedSlots:e._u([{key:"header",fn:function(){return[r("div",{staticClass:"d-flex align-items-center justify-content-between"},[r("h6",{staticClass:"fw-bold mb-0"},[r("FontAwesomeIcon",{attrs:{icon:e.icons.faFileInvoiceDollar,"fixed-width":""}}),e._v(" Espelho bancário ")],1),r("AppButton",{staticClass:"text-primary",attrs:{icon:e.icons.faSyncAlt,color:"light"},on:{click:function(a){return a.preventDefault(),e.onRefreshClick.apply(null,arguments)}}})],1)]},proxy:!0},{key:"body",fn:function(){return[r("BankMirrorNavs",{ref:"bankMirrorNavs"})]},proxy:!0}])})},W=[],X=s(K,U,W,!1,null,null,null,null);const Y=X.exports,Z={metaInfo:{title:"Espelho bancário"},components:{TheBankMirrorBody:Y}};var ee=function(){var e=this,r=e._self._c;return r("div",{staticClass:"my-2"},[r("TheBankMirrorBody")],1)},re=[],ne=s(Z,ee,re,!1,null,null,null,null);const Ee=ne.exports;export{Ee as default};
