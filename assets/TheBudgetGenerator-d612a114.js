import{n as o,L as A,F as C,B as w,u as S,h as N,z as v,p as B,M as b,x as f,N as T,O as I,s as k,G as D,P as E,Q as L}from"./index-4e05606f.js";import{d as P}from"./_PaginatorFragment-c01a3fe7.js";import{a as M,b as O,m as R}from"./masks-168ccaff.js";import{o as p}from"./omit-49c12860.js";var s={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"BudgetParts"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Budget"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"client"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"product"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"product_items"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"date"},arguments:[],directives:[]}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetBudgets"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"page"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"budgets"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"page"},value:{kind:"Variable",name:{kind:"Name",value:"page"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paginatorInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PaginatorSimpleParts"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"data"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"BudgetParts"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetBudgetUrl"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"budgetUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadBudgetGeneratorSettings"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"BudgetSettingsInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"budgetGeneratorSettingsUpload"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"json"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CreateBudget"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"BudgetInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"budgetCreate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UpdateBudget"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"BudgetInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"budgetUpdate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"BudgetParts"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteBudget"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"budgetDelete"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:801}};s.loc.source={body:`#import "./_PaginatorFragment.gql"

fragment BudgetParts on Budget {
  id
  client
  product
  product_items
  date
}

query GetBudgets($first: Int!, $page: Int) {
  budgets(first: $first, page: $page) {
    paginatorInfo {
      ...PaginatorSimpleParts
    }

    data {
      ...BudgetParts
    }
  }
}

query GetBudgetUrl($id: ID!) {
  budgetUrl(id: $id)
}

mutation UploadBudgetGeneratorSettings($input: BudgetSettingsInput!) {
  budgetGeneratorSettingsUpload(input: $input) {
    id
    name
    json
  }
}

mutation CreateBudget($input: BudgetInput!) {
  budgetCreate(input: $input) {
    id
  }
}

mutation UpdateBudget($id: ID!, $input: BudgetInput!) {
  budgetUpdate(id: $id, input: $input) {
    ...BudgetParts
  }
}

mutation DeleteBudget($id: ID!) {
  budgetDelete(id: $id) {
    id
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var h={};function U(n){return n.filter(function(e){if(e.kind!=="FragmentDefinition")return!0;var t=e.name.value;return h[t]?!1:(h[t]=!0,!0)})}s.definitions=s.definitions.concat(U(P.definitions));function m(n,e){if(n.kind==="FragmentSpread")e.add(n.name.value);else if(n.kind==="VariableDefinition"){var t=n.type;t.kind==="NamedType"&&e.add(t.name.value)}n.selectionSet&&n.selectionSet.selections.forEach(function(a){m(a,e)}),n.variableDefinitions&&n.variableDefinitions.forEach(function(a){m(a,e)}),n.definitions&&n.definitions.forEach(function(a){m(a,e)})}var g={};(function(){s.definitions.forEach(function(e){if(e.name){var t=new Set;m(e,t),g[e.name.value]=t}})})();function y(n,e){for(var t=0;t<n.definitions.length;t++){var a=n.definitions[t];if(a.name&&a.name.value==e)return a}}function u(n,e){var t={kind:n.kind,definitions:[y(n,e)]};n.hasOwnProperty("loc")&&(t.loc=n.loc);var a=g[e]||new Set,i=new Set,d=new Set;for(a.forEach(function(r){d.add(r)});d.size>0;){var l=d;d=new Set,l.forEach(function(r){if(!i.has(r)){i.add(r);var c=g[r]||new Set;c.forEach(function(F){d.add(F)})}})}return i.forEach(function(r){var c=y(n,r);c&&t.definitions.push(c)}),t}u(s,"BudgetParts");const _=u(s,"GetBudgets"),V=u(s,"GetBudgetUrl"),G=u(s,"UploadBudgetGeneratorSettings"),q=u(s,"CreateBudget"),Q=u(s,"UpdateBudget"),z=u(s,"DeleteBudget"),j={apollo:{generatorSettings:{query:A,variables:{name:"app",key:"budget_generator_settings",encoded:!1},update(n){const e=JSON.parse(n.configGet),t="https://api.flashcomunicacao.com";return e&&(e.logo&&(e.logo=`${t}/storage/budget_settings/${e.logo}`),e.signature_image&&(e.signature_image=`${t}/storage/budget_settings/${e.signature_image}`),e)},result(){this.populateForm()}}},data(){return{generatorSettings:{},isLoading:!1,form:new C({logo:"",header:"",content:"",date:"",signature_image:""})}},computed:{isQueryLoading(){return!!this.$apollo.queries.generatorSettings.loading},navItems(){return[{value:"logo",text:"Logo",fields:["logo"]},{value:"header",text:"Cabeçalho",fields:["header"]},{value:"content",text:"Conteúdo",fields:["content"]},{value:"date",text:"Data",fields:["date"]},{value:"signature_image",text:"Assinatura",fields:["signature_image"]}]}},methods:{populateForm(){Object.assign(this.form,this.generatorSettings||{})},configHasImage(n){return w(this.generatorSettings,n)},async onFileUpload(n,e){const t=await this.$helpers.inputFileToBase64(n[0]);this.form[e]=t,this.form.errors.clear(e)},async onSubmit(){const n=this.form.data();this.isLoading=!0;try{await this.$apollo.mutate({mutation:G,variables:{input:n}}),this.$toast.success("Configurações atualizadas!")}catch(e){S(this,e)}this.isLoading=!1}}};var H=function(){var e=this,t=e._self._c;return t("form",{on:{submit:function(a){return a.preventDefault(),e.onSubmit.apply(null,arguments)}}},[t("AppLoading",{directives:[{name:"show",rawName:"v-show",value:e.isQueryLoading,expression:"isQueryLoading"}]}),t("AppNavPills",{attrs:{items:e.navItems,errors:Object.keys(e.form.errors.errors)},scopedSlots:e._u([{key:"logo",fn:function(){return[t("AppInputFile",{attrs:{id:"logo",accept:"image/*",centered:""},on:{input:a=>e.onFileUpload(a,"logo")}}),e.form.logo?[t("div",{staticClass:"form-label fw-bold"},[e._v(" "+e._s(e.configHasImage("logo")?"Logo armazenada:":"Pré-visualização:")+" ")]),t("div",{staticClass:"col-4"},[t("img",{staticClass:"img-fluid img-thumbnail",attrs:{src:e.form.logo,alt:"Logo"}})])]:e._e()]},proxy:!0},{key:"header",fn:function(){return[t("AppEditor",{attrs:{error:e.form.errors.get("header"),placeholder:"Digite o cabeçalho..."},on:{focus:function(a){return e.form.errors.clear("header")}},model:{value:e.form.header,callback:function(a){e.$set(e.form,"header",a)},expression:"form.header"}})]},proxy:!0},{key:"content",fn:function(){return[t("div",{staticClass:"text-secondary small"},[e._v(" Informe os seguintes caracteres para serem substituídos por dados: "),t("ul",[t("li",[t("b",[e._v("%cliente%")]),e._v(" - Nome do cliente (Ex.: José da Penha)")]),t("li",[t("b",[e._v("%produto%")]),e._v(" - Produto do recibo (Ex.: Camisa personalizada)")])])]),t("AppEditor",{attrs:{error:e.form.errors.get("content"),placeholder:"Digite o conteúdo..."},on:{focus:function(a){return e.form.errors.clear("content")}},model:{value:e.form.content,callback:function(a){e.$set(e.form,"content",a)},expression:"form.content"}})]},proxy:!0},{key:"date",fn:function(){return[t("div",{staticClass:"text-secondary small"},[e._v(" Informe os seguintes caracteres para serem substituídos por dados: "),t("ul",[t("li",[t("b",[e._v("%data%")]),e._v(" - Data por extenso (Ex.: 01 de Janeiro de 2020)")])])]),t("AppEditor",{attrs:{error:e.form.errors.get("date"),placeholder:"Digite a data..."},on:{focus:function(a){return e.form.errors.clear("date")}},model:{value:e.form.date,callback:function(a){e.$set(e.form,"date",a)},expression:"form.date"}})]},proxy:!0},{key:"signature_image",fn:function(){return[t("AppInputFile",{attrs:{id:"signature_image",accept:"image/*",centered:""},on:{input:a=>e.onFileUpload(a,"signature_image")}}),e.form.signature_image?[t("div",{staticClass:"form-label fw-bold"},[e._v(" "+e._s(e.configHasImage("signature_imageg")?"Assinature armazenada:":"Pré-visualização:")+" ")]),t("div",{staticClass:"col-4"},[t("img",{staticClass:"img-fluid img-thumbnail",attrs:{src:e.form.signature_image,alt:"Assinature"}})])]:e._e()]},proxy:!0}])}),t("div",{staticClass:"row mt-3"},[t("div",{staticClass:"col"},[t("AppButton",{attrs:{loading:e.isLoading,block:"","btn-class":"fw-bold",color:"success",type:"submit"}},[e._v(" Salvar ")])],1),t("div",{staticClass:"col"},[t("AppButton",{attrs:{type:"button",disabled:e.isLoading,block:"",color:"light","data-bs-dismiss":"modal"}},[e._v(" Fechar ")])],1)])],1)},J=[],K=o(j,H,J,!1,null,null,null,null);const W=K.exports,X={components:{BudgetSettingsForm:W},props:{value:{type:Boolean,default:!1}},data(){return{icons:{faCog:N}}}};var Y=function(){var e=this,t=e._self._c;return t("AppModal",e._g(e._b({attrs:{id:"budgetSettingsModal",value:e.value,"modal-dialog-class":"modal-lg"},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faCog,"fixed-width":""}}),e._v(" Configurações do orçamento ")]},proxy:!0},{key:"body",fn:function(){return[e.value?t("BudgetSettingsForm"):e._e()]},proxy:!0}])},"AppModal",e.$attrs,!1),e.$listeners))},Z=[],ee=o(X,Y,Z,!1,null,null,null,null);const te=ee.exports,ne={};var ae=function(){var e=this;return e._self._c,e._m(0)},ie=[function(){var n=this,e=n._self._c;return e("div",[e("div",{staticClass:"row text-center text-subtitle fw-bold"},[e("div",{staticClass:"col-1"},[n._v(" ITEM ")]),e("div",{staticClass:"col-3"},[n._v(" DESCRIÇÃO ")]),e("div",{staticClass:"col-2"},[n._v(" UNID. ")]),e("div",{staticClass:"col-1"},[n._v(" QTD. ")]),e("div",{staticClass:"col-2"},[n._v(" VALOR UNIT. ")]),e("div",{staticClass:"col-2"},[n._v(" TOTAL ")])])])}],re=o(ne,ae,ie,!1,null,null,null,null);const se=re.exports,oe=[{abbr:"un",name:"Unidade"},{abbr:"pc",name:"Peça"},{abbr:"pct",name:"Pacote"},{abbr:"cx",name:"Caixa"},{abbr:"m",name:"Metro"}],de={components:{BudgetFormProductsHeader:se},props:{form:{type:Object,required:!0}},data(){return{UNITIES:oe,maskCurrencyBRL:M(),maskInteger:O({delimiter:"",numeralDecimalScale:0}),icons:{faPlus:v,faTrashAlt:B}}},computed:{isDeleteProductDisabled(){return this.form.product_items.length===1},getTotal(){const n=this.form.product_items.reduce((e,t)=>{const a=this.$helpers.unformatCurrencyBRL(t.value);return!t.quantity||!a?e:e+ +b(t.quantity*a,2)},0);return this.$helpers.toBRL(n)}},methods:{getTotalRow({quantity:n,value:e}){const t=this.$helpers.unformatCurrencyBRL(e);if(!n||!t)return"R$ ";const a=b(n*t,2);return this.$helpers.toBRL(a)},onNewItemClick(){this.$emit("new-item")},onDeleteItemClick(n){this.$emit("delete-item",n)},unityLabelProp(n){return`${n.abbr.toUpperCase()} - ${n.name}`},getProductItem(n,e=null){const t=this.form.product_items.findIndex(a=>n===a.id);return e?this.form.product_items[t][e]:this.form.product_items[t]},setFormById(n,e,t){const a=this.form.product_items.findIndex(i=>n===i.id);this.form.set({[`product_items.${a}.${e}`]:t})},hasError(n,e){return n.errors.includes(e)}}};var le=function(){var e=this,t=e._self._c;return t("AppContainer",{scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Produtos ")]},proxy:!0},{key:"body",fn:function(){return[t("BudgetFormProductsHeader"),e._l(e.form.product_items,function(a){return[t("div",{key:a.id,staticClass:"row"},[t("div",{staticClass:"col-1"},[t("AppInput",{attrs:{id:`product_items.${a.id}.item`,name:`product_items.${a.id}.item`,disabled:"",value:e.getProductItem(a.id,"item")}})],1),t("div",{staticClass:"col-3"},[t("AppInput",{attrs:{id:`product_items.${a.id}.description`,name:`product_items.${a.id}.description`,value:e.getProductItem(a.id,"description"),error:e.hasError(a,"description")},on:{input:function(i){return e.setFormById(a.id,"description",i)}}})],1),t("div",{staticClass:"col-2"},[t("AppSimpleSelect",{attrs:{id:`product_items.${a.id}.unity`,name:`product_items.${a.id}.unity`,value:e.getProductItem(a.id,"unity"),options:e.UNITIES,"label-prop":e.unityLabelProp,"value-prop":"abbr","hide-default-option":""},on:{input:function(i){return e.setFormById(a.id,"unity",i)}}})],1),t("div",{staticClass:"col-1"},[t("AppInput",{attrs:{id:`product_items.${a.id}.quantity`,name:`product_items.${a.id}.quantity`,value:e.getProductItem(a.id,"quantity"),error:e.hasError(a,"quantity"),mask:e.maskInteger},on:{input:function(i){return e.setFormById(a.id,"quantity",i)}}})],1),t("div",{staticClass:"col-2"},[t("AppInput",{attrs:{id:`product_items.${a.id}.value`,name:`product_items.${a.id}.value`,value:e.getProductItem(a.id,"value"),error:e.hasError(a,"value"),mask:e.maskCurrencyBRL},on:{input:function(i){return e.setFormById(a.id,"value",i)}}})],1),t("div",{staticClass:"col-2"},[t("AppInput",{attrs:{id:`product_items.${a.id}.total`,name:`product_items.${a.id}.total`,value:e.getTotalRow(e.getProductItem(a.id)),disabled:""}})],1),t("div",{staticClass:"col-1"},[t("AppButton",{attrs:{outlined:"",color:"danger",icon:e.icons.faTrashAlt,disabled:e.isDeleteProductDisabled},on:{click:function(i){return i.preventDefault(),e.onDeleteItemClick(a)}}})],1)])]}),t("div",{staticClass:"row"},[t("div",{staticClass:"col-9"},[t("AppInput",{attrs:{id:"total-label",value:"TOTAL",name:"total-label","input-class":"fw-bold text-end",disabled:""}})],1),t("div",{staticClass:"col-2"},[t("AppInput",{attrs:{id:"total",name:"total",disabled:"",value:e.getTotal}})],1)]),t("div",{staticClass:"text-center"},[t("AppButton",{attrs:{outlined:"",color:"success",icon:e.icons.faPlus},on:{click:function(a){return a.preventDefault(),e.onNewItemClick.apply(null,arguments)}}})],1)]},proxy:!0}])})},ue=[],ce=o(de,le,ue,!1,null,null,null,null);const me=ce.exports,$={id:f("new_"),item:1,description:"",quantity:"",unity:"un",value:"R$ ",errors:[]},pe={components:{BudgetFormProducts:me},props:{isEdit:{type:Boolean,default:!1},budget:{type:Object,default:()=>({})}},data(){return{maskDate:R,isLoading:!1,form:new C({product:"",client:"",date:"",product_items:[{...$}]})}},mounted(){this.isEdit&&this.populateForm()},methods:{populateForm(){const e=JSON.parse(this.budget.product_items).map(t=>({...t,id:f("stored_"),value:this.$helpers.toBRL(t.value),errors:[]}));this.form.set({...p(this.budget,["product_items","date"]),product_items:e,date:T(this.budget.date)})},onNewItem(){this.form.product_items.push({...$,id:f("_new"),item:this.form.product_items.length+1})},onDeleteItem(n){if(this.form.product_items.length===1)return;const e=this.form.product_items.findIndex(({item:t})=>t===n.item);this.form.product_items.splice(e,1),this.form.product_items.forEach((t,a)=>{t.item=a+1})},getFormattedForm(){const n=I(this.form.data());return n.product_items=n.product_items.map(e=>({...p(e,["id","errors"])})),n},async submitForm(n){if(this.isEdit){await this.update(n);return}await this.create(n)},async onSubmit(){const n=this.getFormattedForm();this.isLoading=!0;try{await this.submitForm(n)}catch(e){S(this,e),this.handleProductItemsError(e)}this.isLoading=!1},async create(n){await this.$apollo.mutate({mutation:q,variables:{input:n},refetchQueries:[_],awaitRefetchQueries:!0}),k(this,{resetForm:!0,message:"Orçamento cadastrado!"})},async update(n){await this.$apollo.mutate({mutation:Q,variables:{id:this.budget.id,input:n}}),k(this,{message:"Orçamento atualizado!"})},handleProductItemsError(n){const e=p(n.graphQLErrors[0].extensions.validation,["client","product","date"]);this.form.product_items.forEach((t,a)=>{const l=Object.keys(e).filter(r=>r.includes(`.${a}.`)).map(r=>r.split(`.${a}.`)[1]);t.errors=l})},clearProductItemsError(n){const[e,t,a]=n.target.name.split(".");if(e!=="product_items")return;const i=this.form.product_items.findIndex(l=>t===l.id),d=this.form.product_items[i];d.errors=d.errors.filter(l=>l!==a)}}};var fe=function(){var e=this,t=e._self._c;return t("AppForm",{attrs:{form:e.form,"on-submit":e.onSubmit},nativeOn:{"!focus":function(a){return e.clearProductItemsError.apply(null,arguments)}}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col"},[t("AppInput",{attrs:{id:"client",name:"client",placeholder:"Digite o cliente...",error:e.form.errors.get("client")},model:{value:e.form.client,callback:function(a){e.$set(e.form,"client",a)},expression:"form.client"}},[e._v(" Cliente ")])],1),t("div",{staticClass:"col"},[t("AppInput",{attrs:{id:"product",name:"product",placeholder:"Digite o produto...",error:e.form.errors.get("product")},model:{value:e.form.product,callback:function(a){e.$set(e.form,"product",a)},expression:"form.product"}},[e._v(" Nome do produto ")])],1)]),t("BudgetFormProducts",{staticClass:"my-3",attrs:{form:e.form},on:{"new-item":e.onNewItem,"delete-item":e.onDeleteItem}}),t("AppInput",{attrs:{id:"date",name:"date",type:"date",placeholder:"dd/mm/aaaa",error:e.form.errors.get("date"),mask:e.maskDate},model:{value:e.form.date,callback:function(a){e.$set(e.form,"date",a)},expression:"form.date"}},[e._v(" Data ")]),t("div",{staticClass:"row mt-2"},[t("div",{staticClass:"col"},[t("AppButton",{attrs:{block:"",color:"success","btn-class":"fw-bold",loading:e.isLoading}},[e._v(" "+e._s(e.isEdit?"Atualizar":"Cadastrar")+" ")])],1),t("div",{staticClass:"col"},[t("AppButton",{attrs:{block:"",color:"light",disabled:e.isLoading,type:"button","data-bs-dismiss":"modal"}},[e._v(" Cancelar ")])],1)])],1)},ge=[],ve=o(pe,fe,ge,!1,null,null,null,null);const x=ve.exports,_e={components:{BudgetForm:x},props:{value:{type:Boolean,default:!1}},data(){return{icons:{faPlus:v}}},methods:{onSuccess(){this.$emit("success")}}};var be=function(){var e=this,t=e._self._c;return t("AppModal",e._g(e._b({attrs:{id:"budgetCreateModal",value:e.value,"modal-dialog-class":"modal-xl"},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faPlus,"fixed-width":""}}),e._v(" Gerar novo orçamento ")]},proxy:!0},{key:"body",fn:function(){return[t("KeepAlive",[e.value?t("BudgetForm",{on:{success:e.onSuccess}}):e._e()],1)]},proxy:!0}])},"AppModal",e.$attrs,!1),e.$listeners))},ke=[],he=o(_e,be,ke,!1,null,null,null,null);const ye=he.exports,$e={components:{BudgetCreateModal:ye,BudgetSettingsModal:te},data(){return{budgetSettingsModal:!1,budgetCreateModal:!1,icons:{faPlus:v,faCog:N}}},methods:{onNewBudgetClick(){this.budgetCreateModal=!0},onSettingsClick(){this.budgetSettingsModal=!0},onNewBudgetCreated(){this.budgetCreateModal=!1},onEditBudget(){this.budgetE}}};var Ce=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"d-flex justify-content-between mt-3"},[t("AppButton",{attrs:{"btn-class":"fw-bold",color:"success",icon:e.icons.faPlus},on:{click:function(a){return a.preventDefault(),e.onNewBudgetClick.apply(null,arguments)}}},[e._v(" Novo orçamento ")]),t("AppButton",{attrs:{"btn-class":"fw-bold",icon:e.icons.faCog},on:{click:e.onSettingsClick}},[e._v(" Configurações ")])],1),t("BudgetCreateModal",{on:{success:e.onNewBudgetCreated},model:{value:e.budgetCreateModal,callback:function(a){e.budgetCreateModal=a},expression:"budgetCreateModal"}}),t("BudgetSettingsModal",{model:{value:e.budgetSettingsModal,callback:function(a){e.budgetSettingsModal=a},expression:"budgetSettingsModal"}})],1)},Se=[],Ne=o($e,Ce,Se,!1,null,null,null,null);const Be=Ne.exports,De={props:{budgets:{type:Array,default:()=>[]}},data(){return{budgetToOpen:{id:"",isLoading:!1},budgetToDelete:{id:"",isLoading:!1},icons:{faEdit:D,faTrashAlt:B,faExternalLinkAlt:E}}},computed:{headers(){return[{value:"client",text:"Cliente"},{value:"product",text:"Produto"},{value:"date",text:"Data",format:"datetime"},{value:"options",text:"",align:"right"}]}},methods:{onEditClick(n){this.$emit("edit",n)},onDeleteClick(n){this.budgetToDelete.id=n.id},onCancelDeleteClick(){this.budgetToDelete.id=""},async onConfirmDeleteClick({id:n}){this.budgetToDelete.isLoading=!0;try{await this.$apollo.mutate({mutation:z,variables:{id:n},refetchQueries:[_],awaitRefetchQueries:!0}),this.$toast.success("Orçamento deletado!")}catch{this.$toast.error("Ops! Algo deu errado.")}this.budgetToDelete.isLoading=!1},async onOpenBudgetClick(n){this.budgetToOpen.id=n.id,this.budgetToOpen.isLoading=!0;try{const{data:{budgetUrl:e}}=await this.$apollo.query({query:V,variables:{id:n.id},fetchPolicy:"no-cache"});this.$helpers.openInNewTab(e)}catch{this.$toast.error("Ops! Algo deu errado.")}this.budgetToOpen.isLoading=!1}}};var xe=function(){var e=this,t=e._self._c;return t("AppTable",{attrs:{items:e.budgets,headers:e.headers},scopedSlots:e._u([{key:"items.options",fn:function({item:a}){return[a.id===e.budgetToDelete.id?t("div",[t("div",{staticClass:"text-end text-subtitle fw-bold"},[e._v(" DELETAR ")]),t("div",{staticClass:"text-end"},[t("AppButton",{staticClass:"me-2",attrs:{color:"success","btn-class":"btn-sm fw-bold",loading:e.budgetToDelete.isLoading},on:{click:function(i){return i.preventDefault(),e.onConfirmDeleteClick(a)}}},[e._v(" Confirmar ")]),t("AppButton",{attrs:{color:"light","btn-class":"btn-sm",disable:e.budgetToDelete.isLoading},on:{click:function(i){return i.preventDefault(),e.onCancelDeleteClick.apply(null,arguments)}}},[e._v(" Cancelar ")])],1)]):t("div",{staticClass:"text-end"},[t("AppButton",{attrs:{"btn-class":"btn-sm",outlined:"",icon:e.icons.faExternalLinkAlt,loading:e.budgetToOpen.id===a.id&&e.budgetToOpen.isLoading},on:{click:function(i){return i.preventDefault(),e.onOpenBudgetClick(a)}}}),t("AppButton",{staticClass:"mx-2",attrs:{"btn-class":"btn-sm",outlined:"",icon:e.icons.faEdit},on:{click:function(i){return i.preventDefault(),e.onEditClick(a)}}}),t("AppButton",{attrs:{color:"danger","btn-class":"btn-sm",outlined:"",icon:e.icons.faTrashAlt},on:{click:function(i){return i.preventDefault(),e.onDeleteClick(a)}}})],1)]}}],null,!0)})},Fe=[],Ae=o(De,xe,Fe,!1,null,null,null,null);const we=Ae.exports,Te={components:{BudgetForm:x},props:{budget:{type:Object,default:()=>({})},value:{type:Boolean,default:!1}},data(){return{icons:{faEdit:D}}},methods:{onSuccess(){this.$emit("success")}}};var Ie=function(){var e=this,t=e._self._c;return t("AppModal",e._g(e._b({attrs:{id:"budgetEditModal",value:e.value,"modal-dialog-class":"modal-xl"},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faEdit,"fixed-width":""}}),e._v(" Alterar orçamento ")]},proxy:!0},{key:"body",fn:function(){return[e.value?t("BudgetForm",{attrs:{"is-edit":"",budget:e.budget},on:{success:e.onSuccess}}):e._e()]},proxy:!0}])},"AppModal",e.$attrs,!1),e.$listeners))},Ee=[],Le=o(Te,Ie,Ee,!1,null,null,null,null);const Pe=Le.exports,Me={components:{BudgetTable:we,BudgetEditModal:Pe},apollo:{budgets:{query:_,variables(){return{first:10,page:this.page}}}},data(){return{page:1,budgetEditModal:{value:!1,budget:{}},budgets:{paginatorInfo:{},data:[]},icons:{faThList:L}}},computed:{isQueryLoading(){return!!this.$apollo.queries.budgets.loading}},methods:{onEdit(n){this.budgetEditModal.budget=n,this.budgetEditModal.value=!0},onEditSuccess(){this.budgetEditModal.value=!1,this.budgetEditModal.budget={}}}};var Oe=function(){var e=this,t=e._self._c;return t("div",[t("BudgetEditModal",{attrs:{budget:e.budgetEditModal.budget},on:{success:e.onEditSuccess},model:{value:e.budgetEditModal.value,callback:function(a){e.$set(e.budgetEditModal,"value",a)},expression:"budgetEditModal.value"}}),t("AppCard",{staticClass:"mt-2",scopedSlots:e._u([{key:"header",fn:function(){return[t("h6",{staticClass:"mb-0 fw-bold"},[t("FontAwesomeIcon",{attrs:{icon:e.icons.faThList,"fixed-width":""}}),e._v(" Orçamentos gerados ")],1)]},proxy:!0},{key:"body",fn:function(){return[t("AppLoading",{directives:[{name:"show",rawName:"v-show",value:e.isQueryLoading,expression:"isQueryLoading"}]}),t("BudgetTable",{attrs:{budgets:e.budgets.data},on:{edit:e.onEdit}})]},proxy:!0}])}),t("AppPaginator",{staticClass:"mt-2",attrs:{pagination:e.budgets.paginatorInfo},model:{value:e.page,callback:function(a){e.page=a},expression:"page"}})],1)},Re=[],Ue=o(Me,Oe,Re,!1,null,null,null,null);const Ve=Ue.exports,Ge={metaInfo:{title:"Gerador de Orçamento"},components:{TheBudgetGeneratorHeader:Be,TheBudgetGeneratorBody:Ve}};var qe=function(){var e=this,t=e._self._c;return t("div",[t("TheBudgetGeneratorHeader"),t("TheBudgetGeneratorBody")],1)},Qe=[],ze=o(Ge,qe,Qe,!1,null,null,null,null);const We=ze.exports;export{We as default};
