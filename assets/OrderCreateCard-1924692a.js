import{n,F as l,aU as c,H as m,N as u,u as p}from"./index-4e05606f.js";import{b as i,R as f,G as o}from"./WeeklyCalendar-dccba4d1.js";import{G as h}from"./Status-e5c68e0d.js";const b={props:{isOrderable:{type:Boolean,default:!1},index:{type:Number,default:0},order:{type:Object,default:()=>({})},orders:{type:Array,default:()=>[]}},apollo:{status:{query:h}},data(){return{status:[],isLoading:!1,form:new l({reminder:"",status_id:"",production_date:""}),icons:{faBoxOpen:c,faQuestionCircle:m}}},methods:{getFormattedForm(){const{reminder:a,status_id:e}=this.form.data(),{date:t}=this.order;return{reminder:a,status_id:e,[this.order.date_field]:u(t),art_paths:[this.order.image.base64]}},async onSubmitAndReorder(a){const{data:{orderCreatePreRegistered:{id:e}}}=await this.$apollo.mutate({mutation:i,variables:{input:a}}),t=this.orders.map(({id:s},d)=>({id:s,order:d})),r=t.findIndex(s=>s.id.match(/^pre-created/));t.splice(r,1,{id:e,order:r}),await this.$apollo.mutate({mutation:f,variables:{input:t},awaitRefetchQueries:!0,refetchQueries:[o]})},isImageError(a){const{graphQLErrors:{0:{extensions:{validation:e}}}}=a;return"art_paths.0"in e},async onSubmit(a){await this.$apollo.mutate({mutation:i,variables:{input:a},awaitRefetchQueries:!0,refetchQueries:[o]})},async submit(){const a=this.getFormattedForm();this.isLoading=!0;try{this.isOrderable?await this.onSubmitAndReorder(a):await this.onSubmit(a),this.$helpers.clearCacheFrom({fieldName:"orders"}),this.$toast.success("Pedido registrado!")}catch(e){this.isImageError(e)?this.$toast.error("Imagem muito grande, por favor, escolha outra."):p(this,e)}this.isLoading=!1},onCancel(){this.$emit("cancel-create",this.order)}}};var v=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"card mb-2"},[t("div",{staticClass:"card-header bg-camaleao fw-bold text-white py-2"},[t("FontAwesomeIcon",{attrs:{icon:e.icons.faBoxOpen,"fixed-width":""}}),e._v(" NOVO PEDIDO ")],1),t("div",{staticClass:"card-body p-0"},[t("AppViewer",[t("img",{staticClass:"img-fluid img-thumbnail clickable",attrs:{src:e.order.image.base64,alt:"Imagem do pedido a ser criado"}})]),t("AppForm",{staticClass:"mx-2 mt-2",attrs:{form:e.form,"on-submit":e.submit}},[t("AppTextarea",{attrs:{id:"reminder",name:"reminder",placeholder:"Algo que lembre o pedido...",optional:""},scopedSlots:e._u([{key:"hint",fn:function(){return[e._v(" É altamente recomendado informar algum lembrete. "),t("FontAwesomeIcon",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"text-primary",attrs:{icon:e.icons.faQuestionCircle,content:"O pedido será cadastrado inicialmente sem cliente, apenas com imagem, pode ser difícil reconhecê-lo sem um lembrete. O lembrete será descartado assim que o cadastro completo do pedido for concluído"}})]},proxy:!0}]),model:{value:e.form.reminder,callback:function(r){e.$set(e.form,"reminder",r)},expression:"form.reminder"}},[e._v(" Lembrete: ")]),t("AppSimpleSelect",{attrs:{id:"status_id",name:"status_id",options:e.status,placeholder:"Selecione o status",optional:"","value-prop":"id","label-prop":"text","select-class":"form-select-sm"},model:{value:e.form.status_id,callback:function(r){e.$set(e.form,"status_id",r)},expression:"form.status_id"}},[e._v(" Status: ")])],1)],1),t("div",{staticClass:"card-footer d-flex p-0"},[t("AppButton",{staticClass:"flex-fill",attrs:{"btn-class":"fw-bold radius-0",color:"success",loading:e.isLoading},on:{click:function(r){return r.preventDefault(),e.submit.apply(null,arguments)}}},[e._v(" Cadastrar ")]),t("AppButton",{staticClass:"flex-fill",attrs:{"btn-class":"radius-0",color:"light",disabled:e.isLoading},on:{click:function(r){return r.preventDefault(),e.onCancel.apply(null,arguments)}}},[e._v(" Cancelar ")])],1),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isOrderable,expression:"isOrderable"}],staticClass:"orderable-overflow"},[t("div",[e._v(e._s(e.index+1))])])])])},_=[],g=n(b,v,_,!1,null,null,null,null);const w=g.exports;export{w as default};
