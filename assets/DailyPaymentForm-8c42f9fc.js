import{G as p}from"./Via-eb0eedf9.js";import{C as f}from"./Payment-7f758fb7.js";import{a as v,b as _}from"./DailyCash-da8f8b01.js";import{n,H as c,i as s,r as i,F as l,N as h,O as y,ay as d,s as b,u as g}from"./index-4e05606f.js";import{a as m,m as C}from"./masks-168ccaff.js";import{S as u}from"./SelectClientsFind-5d32440f.js";import{a as w}from"./Resources-b591129f.js";import{o as a}from"./omit-49c12860.js";const k={components:{SelectClientsFind:u},props:{form:{type:Object,required:!0}},data(){return{clients:{isLoading:!1,items:[]}}},methods:{onClientSelect(o){this.removeCurrentOrder(),this.form.set({"client.id":o})},removeCurrentOrder(){this.form.set({"order.id":""})},toggleClientState(){this.form.client.isNew||this.form.set({"client.id":"","order.id":""}),this.form.set({"client.isNew":!this.form.client.isNew}),this.form.set({"order.isNew":this.form.client.isNew})}}};var x=function(){var e=this,r=e._self._c;return e.form.client.isNew?r("div",{staticClass:"mb-4"},[r("div",{staticClass:"d-flex justify-content-between align-items-center mb-2"},[r("label",{staticClass:"fw-bold form-label",attrs:{for:"client"}},[e._v("Nome do cliente")]),r("AppButton",{staticClass:"fw-bold",attrs:{color:"primary","btn-class":"btn-sm"},on:{click:function(t){return t.preventDefault(),e.toggleClientState.apply(null,arguments)}}},[e._v(" Procurar cliente ")])],1),r("AppInput",{attrs:{id:"client",value:e.form.client.name,error:e.form.errors.get("client.name"),name:"client.name",placeholder:"Nome do cliente"},on:{input:function(t){return e.form.set({"client.name":t})}}})],1):r("div",{staticClass:"mb-4"},[r("div",{staticClass:"d-flex justify-content-between align-items-center mb-2"},[r("label",{staticClass:"fw-bold form-label text-primary",attrs:{for:"client"}},[e._v("Cliente")]),r("AppButton",{staticClass:"fw-bold",attrs:{color:"success","btn-class":"btn-sm"},on:{click:function(t){return t.preventDefault(),e.toggleClientState.apply(null,arguments)}}},[e._v(" Cadastrar novo ")])],1),r("SelectClientsFind",{attrs:{id:"client",value:e.form.client.id,error:e.form.errors.get("client.id")},on:{input:e.onClientSelect},scopedSlots:e._u([{key:"noOptions",fn:function(){return[e._v(" Faça uma busca para exibir resultados ")]},proxy:!0},{key:"noResult",fn:function(){return[e._v(" Nenhum cliente encontrado, "),r("a",{staticClass:"fw-bold text-decoration-none",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.toggleClientState.apply(null,arguments)}}},[e._v("cadastrar novo")])]},proxy:!0}],null,!1,1258252843)})],1)},F=[],A=n(k,x,F,!1,null,null,null,null);const N=A.exports,O=(o,e)=>{const t=[{column:"CLIENT_ID",operator:"EQ",value:(e==null?void 0:e.id)||e},{column:"PRICE",operator:"IS_NOT_NULL"}];return s(o)||t.push({column:"CODE",operator:"LIKE",value:`%${o}%`}),{AND:t}},L={props:{form:{type:Object,required:!0}},data(){return{maskCurrencyBRL:m(),hasReminder:!1,icons:{faQuestionCircle:c},orders:{isLoading:!1,items:[]}}},computed:{clientExists(){return typeof this.form.client.id=="object"&&!s(this.form.client.id)}},watch:{"form.client.id":{async handler(){await this.asyncFillOrders()}}},methods:{formatCurrencyBRL:i,toggleOrderState(){this.form.order.isNew||this.form.set({"order.id":""}),this.form.set({"order.isNew":!this.form.order.isNew})},customLabelOrders({code:o,name:e,price:r}){return e?`${o} - ${e} - ${i(r)}`:`${o} - ${i(r)}`},getOrdersQuery(o){return this.$apollo.query({query:w,variables:{where:O(o,this.form.client.id),orderBy:[{column:"CREATED_AT",order:"DESC"}]}})},async asyncFillOrders(){this.orders.isLoading=!0;const{data:{orders:{data:e}}}=await this.getOrdersQuery(null);this.orders.isLoading=!1,this.orders.items=e.filter(r=>r.total_owing>0)},async asyncFindOrders(o){if(s(o)){await this.asyncFillOrders();return}this.orders.isLoading=!0;const{data:{orders:{data:e}}}=await this.getOrdersQuery(o);this.orders.isLoading=!1,this.orders.items=e.filter(r=>r.total_owing>0)}}};var $=function(){var e=this,r=e._self._c;return e.form.order.isNew?r("div",[r("div",{staticClass:"d-flex justify-content-between align-items-center mb-2"},[r("label",{staticClass:"fw-bold form-label mb-2",attrs:{for:"order"}},[e._v("Código do pedido")]),e.clientExists&&!e.form.isNewClient?r("AppButton",{staticClass:"fw-bold",attrs:{color:"primary","btn-class":"btn-sm"},on:{click:function(t){return t.preventDefault(),e.toggleOrderState.apply(null,arguments)}}},[e._v(" Procurar pedido ")]):e._e()],1),r("AppInput",{attrs:{id:"order",value:e.form.order.code,error:e.form.errors.get("order.code"),name:"order.code",placeholder:"Digite o cód. do pedido..."},on:{input:function(t){return e.form.set({"order.code":t})}}}),r("AppInput",{attrs:{id:"price",value:e.form.order.price,error:e.form.errors.get("order.price"),name:"order.price",mask:e.maskCurrencyBRL,numeric:""},on:{input:function(t){return e.form.set({"order.price":t})}}},[e._v(" Valor ")]),r("AppCheckbox",{attrs:{id:"reminderCheckbox"},model:{value:e.hasReminder,callback:function(t){e.hasReminder=t},expression:"hasReminder"}},[e._v(" Adicionar lembrete "),r("FontAwesomeIcon",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"ms-1 text-secondary",attrs:{content:"Adicione uma anotação para lembrar do pedido na página de pedidos",icon:e.icons.faQuestionCircle}})],1),e.hasReminder?[r("AppInput",{attrs:{id:"reminder",value:e.form.order.reminder,name:"reminder",placeholder:"Algo que lembre o pedido...",optional:""},on:{input:function(t){return e.form.set({"order.reminder":t})}}},[e._v(" Lembrete ")])]:e._e()],2):r("div",[r("div",{staticClass:"d-flex justify-content-between align-items-center mb-2"},[r("label",{staticClass:"fw-bold text-primary form-label mb-2",attrs:{for:"order"}},[e._v("Pedido")]),r("AppButton",{attrs:{disabled:!e.clientExists,color:"success","btn-class":"btn-sm fw-bold",tooltip:!e.clientExists&&"Informe o cliente primeiro"},on:{click:function(t){return t.preventDefault(),e.toggleOrderState.apply(null,arguments)}}},[e._v(" Cadastrar novo ")])],1),r("AppSelect",{staticClass:"mb-2",attrs:{value:e.form.order.id,name:"order",placeholder:"Procure pelo código",error:e.form.errors.get("order.id"),"default-margin":!1,"custom-label":e.customLabelOrders,searchable:!0,"internal-search":!1,options:e.orders.items,loading:e.orders.isLoading,disabled:!e.clientExists,tooltip:!e.clientExists&&"Informe o cliente primeiro."},on:{input:function(t){return e.form.set({"order.id":t})},open:function(t){return e.form.errors.clear("order.id")},"search-change":e.asyncFindOrders},scopedSlots:e._u([{key:"noOptions",fn:function(){return[e._v(" Faça uma busca para exibir resultados ")]},proxy:!0},{key:"noResult",fn:function(){return[e._v(" Nenhum pedido encontrado, "),r("a",{staticClass:"fw-bold text-decoration-none",attrs:{href:"#"},on:{click:function(t){return t.preventDefault(),e.toggleOrderState.apply(null,arguments)}}},[e._v("cadastrar novo")])]},proxy:!0}],null,!1,3342047923)}),e.form.order.id?r("div",{staticClass:"small text-secondary"},[r("b",[e._v("Faltar pagar: ")]),e._v(" "+e._s(e.formatCurrencyBRL(e.form.order.id.total_owing))+" ")]):e._e()],1)},D=[],S=n(L,$,D,!1,null,null,null,null);const E=S.exports,R=1,I={apollo:{vias:{query:p,result(){this.loadingQueries--}}},components:{DailyPaymentFormClient:N,DailyPaymentFormOrder:E,SelectClientsFind:u},props:{payment:{type:Object,default:()=>({})}},data(){return{maskDate:C,maskCurrencyBRL:m(),isLoading:!1,loadingQueries:R,vias:[],icons:{faQuestionCircle:c},form:new l({client:{id:"",name:"",isNew:!1},order:{id:"",code:"",price:"R$ ",reminder:"",isNew:!1},date:"",value:"R$ ",bank_uid:"",note:"",via_id:"",untied:!1,is_sponsor:!1,is_shipping:!1,sponsorship_client_id:"",filename_entry_from:""})}},computed:{isQueriesLoading(){return this.loadingQueries>0},isFromBankEntry(){return!s(this.payment.bank_uid)||!s(this.form.bank_uid)},hasOrder(){return!s(this.form.order.id)&&!this.form.order.isNew}},watch:{loadingQueries(o){!o&&(this.isEdit||!s(this.payment))&&this.$nextTick(()=>{this.populateForm()})}},methods:{isEmpty:s,formatCurrencyBRL:i,populateForm(){this.form=new l({...this.form.data(),...a(this.payment,["id","value","date"]),date:h(this.payment.date),value:i(this.payment.value)})},customLabelVias({name:o}){return o},onRestValueClick(){this.form.value=i(this.form.order.id.total_owing)},getFormattedForm(){var e;const o=y(this.form.data());return d(o.client.id)&&(o.client.id=o.client.id.id),d(o.order.id)&&(o.order.id=o.order.id.id),o.client=a(o.client,"isNew"),o.order=a(o.order,"isNew"),o.sponsorship_client_id=((e=o.sponsorship_client_id)==null?void 0:e.id)||"",o},async onSubmit(){const o=this.getFormattedForm();this.isLoading=!0;try{await this.$apollo.mutate({mutation:f,variables:{input:o},refetchQueries:[v,_]}),this.$helpers.clearCacheFrom([{fieldName:"orders"},{fieldName:"clients"},{fieldName:"dailyCash"}]),b(this,{message:"Entrada registrada!",resetForm:!0})}catch(e){g(this,e)}this.isLoading=!1}}};var B=function(){var e=this,r=e._self._c;return r("AppForm",{attrs:{form:e.form,"on-submit":e.onSubmit}},[r("AppLoading",{directives:[{name:"show",rawName:"v-show",value:e.isQueriesLoading,expression:"isQueriesLoading"}]}),r("AppContainer",{staticClass:"mb-3",scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" CLIENTE & PEDIDO ")]},proxy:!0},{key:"body",fn:function(){return[r("div",{directives:[{name:"show",rawName:"v-show",value:!e.form.untied,expression:"!form.untied"}]},[r("DailyPaymentFormClient",{attrs:{form:e.form}}),r("DailyPaymentFormOrder",{attrs:{form:e.form}})],1),e.isEmpty(e.payment)?r("AppCheckbox",{attrs:{id:"untied",name:"untied","default-margin":!1},model:{value:e.form.untied,callback:function(t){e.$set(e.form,"untied",t)},expression:"form.untied"}},[e._v(" Vincular depois "),r("FontAwesomeIcon",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"ms-1 text-secondary",attrs:{icon:e.icons.faQuestionCircle,content:"Registre o pagamento sem um cliente ou pedido, poderá ser vinculado a um pedido mais tarde."}})],1):e._e()]},proxy:!0}])}),r("AppContainer",{staticClass:"mb-3",scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" PAGAMENTO ")]},proxy:!0},{key:"body",fn:function(){return[e.form.errors.get("bank_uid")?r("AppAlert",{attrs:{color:"danger",small:""},on:{dismiss:function(t){return e.form.errors.clear("bank_uid")}}},[e._v(" "+e._s(e.form.errors.get("bank_uid"))+" ")]):e._e(),r("div",{staticClass:"row justify-content-between mb-2"},[r("div",{staticClass:"col-7"},[r("AppInput",{attrs:{id:"value",name:"value",value:"R$ ",numeric:"",error:e.form.errors.get("value"),mask:e.maskCurrencyBRL,disabled:e.isFromBankEntry},scopedSlots:e._u([{key:"append",fn:function(){return[e.hasOrder?r("AppButton",{attrs:{tooltip:e.formatCurrencyBRL(e.form.order.id.total_owing),outlined:"",disabled:e.isFromBankEntry},on:{click:function(t){return t.preventDefault(),e.onRestValueClick.apply(null,arguments)}}},[e._v(" Restante ")]):e._e()]},proxy:!0}]),model:{value:e.form.value,callback:function(t){e.$set(e.form,"value",t)},expression:"form.value"}},[e._v(" Valor ")])],1),r("div",{staticClass:"col-5"},[r("AppSimpleSelect",{attrs:{id:"via_id",error:e.form.errors.get("via_id"),name:"via_id",placeholder:"Selecione uma via","value-prop":"id","label-prop":"name",options:e.vias},model:{value:e.form.via_id,callback:function(t){e.$set(e.form,"via_id",t)},expression:"form.via_id"}},[e._v(" Via ")])],1)]),r("div",{staticClass:"d-flex align-items-center mb-3"},[r("AppCheckbox",{attrs:{id:"is_sponsor",name:"is_sponsor","default-margin":!1},model:{value:e.form.is_sponsor,callback:function(t){e.$set(e.form,"is_sponsor",t)},expression:"form.is_sponsor"}},[e._v(" Patrocínio ")]),r("FontAwesomeIcon",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"ms-1 text-secondary",attrs:{icon:e.icons.faQuestionCircle,"fixed-width":"",content:"Caso o pagamento seja efetuado por outro cliente que não seja o dono do pedido"}})],1),r("div",{staticClass:"d-flex align-items-center mb-3"},[r("AppCheckbox",{attrs:{id:"is_shipping",name:"is_shipping","default-margin":!1},model:{value:e.form.is_shipping,callback:function(t){e.$set(e.form,"is_shipping",t)},expression:"form.is_shipping"}},[e._v(" Adicionar como frete ")]),r("FontAwesomeIcon",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"text-secondary ms-2",attrs:{icon:e.icons.faQuestionCircle,content:"O valor será somado ao preço final do pedido"}})],1),r("div",{directives:[{name:"show",rawName:"v-show",value:e.form.is_sponsor,expression:"form.is_sponsor"}]},[r("SelectClientsFind",{attrs:{id:"sponsorship_client_id",error:e.form.errors.get("sponsorship_client_id")},model:{value:e.form.sponsorship_client_id,callback:function(t){e.$set(e.form,"sponsorship_client_id",t)},expression:"form.sponsorship_client_id"}},[e._v(" Patrocinador ")])],1),r("div",[r("AppInput",{attrs:{id:"date",name:"date",error:e.form.errors.get("date"),placeholder:"Data do pagamento",mask:e.maskDate,"today-button":"",type:"date",numeric:"","disabled-message":e.form.is_sponsor?"Não é necessário informar a data em patrocínios":!1,disabled:e.isFromBankEntry},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}},[e._v(" Data ")]),r("AppInput",{attrs:{id:"note",name:"note",error:e.form.errors.get("note"),optional:"",placeholder:"Anotação para o pagamento..."},model:{value:e.form.note,callback:function(t){e.$set(e.form,"note",t)},expression:"form.note"}},[e._v(" Nota ")])],1)]},proxy:!0}])}),e.$scopedSlots.footer?e._t("footer",null,{form:e.form,getFormattedForm:e.getFormattedForm}):r("div",{staticClass:"row"},[r("div",{staticClass:"col"},[r("AppButton",{staticClass:"fw-bold",attrs:{color:"success",loading:e.isLoading,block:""},on:{click:function(t){return t.preventDefault(),e.onSubmit.apply(null,arguments)}}},[e._v(" Registrar ")])],1),r("div",{staticClass:"col"},[r("AppButton",{attrs:{color:"light","data-bs-dismiss":"modal",type:"button",block:"",disabled:e.isLoading}},[e._v(" Cancelar ")])],1)])],2)},Q=[],P=n(I,B,Q,!1,null,null,null,null);const H=P.exports;export{H as D};
