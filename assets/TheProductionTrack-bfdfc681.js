import{n as a,bh as v,a5 as l,aZ as h,o as g,aq as u,m as n,i as S,w as y,K as C,D as o,N as f,A as p,a3 as b,aQ as x,B as d}from"./index-4e05606f.js";import{P as k}from"./ProductionPanelBody-487d806e.js";import{a as m,S as w,b as _}from"./OrderControl-1f6a4d8d.js";import{T as $}from"./Order-ebd7beca.js";import{V as P}from"./vue-load-image-d69823bb.js";import{o as I}from"./orderStatesMixin-3d8dcb0c.js";import{M as L}from"./ModalOrderStatusOverrideDates-c2f80977.js";import"./_PaginatorFragment-c01a3fe7.js";import"./ActivityFragments-a3df58d3.js";const O={components:{ProductionPanelBody:k},props:{value:{type:Boolean,default:!1}},data(){return{icons:{faColumns:v}}}};var A=function(){var t=this,e=t._self._c;return e("AppModal",t._g(t._b({attrs:{id:"ProductionPanelModal",value:t.value,"modal-dialog-class":"modal-xl"},scopedSlots:t._u([{key:"title",fn:function(){return[e("FontAwesomeIcon",{attrs:{icon:t.icons.faColumns,"fixed-width":""}}),t._v(" Painel de Produtividade ")]},proxy:!0},{key:"body",fn:function(){return[t.value?e("ProductionPanelBody"):t._e()]},proxy:!0}])},"AppModal",t.$attrs,!1),t.$listeners))},T=[],D=a(O,A,T,!1,null,null,null,null);const B=D.exports,R={components:{ProductionPanelModal:B},data(){return{ProductionPanelModal:!1,roles:l,icons:{faTasks:h,faSyncAlt:g,faTshirt:u}}},methods:{ProductionPanelClick(){this.ProductionPanelModal=!0},onRefreshClick(){this.$emit("refresh")}}};var E=function(){var t=this,e=t._self._c;return e("div",{staticClass:"card mb-2"},[e("div",{staticClass:"card-header d-flex flex-column flex-md-row justify-content-between bg-primary text-white fw-bold"},[e("div",{staticClass:"mb-2 mb-md-0"},[e("FontAwesomeIcon",{attrs:{icon:t.icons.faTasks,"fixed-width":""}}),t._v(" Esteira de Produção ")],1),e("div",{staticClass:"d-flex justify-content-between justify-content-md-start"},[t.$helpers.canView(t.roles.GERENCIA)?e("AppButton",{staticClass:"me-2",attrs:{icon:t.icons.faTshirt,color:"light","btn-class":"text-primary btn-sm fw-bold"},on:{click:t.ProductionPanelClick}},[t._v(" Painel de Produtividade ")]):t._e(),e("AppButton",{attrs:{icon:t.icons.faSyncAlt,color:"light","btn-class":"text-primary btn-sm"},on:{click:t.onRefreshClick}})],1)]),t.$helpers.canView(t.roles.GERENCIA)?[e("ProductionPanelModal",{model:{value:t.ProductionPanelModal,callback:function(r){t.ProductionPanelModal=r},expression:"ProductionPanelModal"}})]:t._e()],2)},F=[],M=a(R,E,F,!1,null,null,null,null);const N=M.exports,U={apollo:{authUserSectors:{query:m,result(){const s=this.authUserSectors[0].sector;this.$emit("sectors-loaded",n(this.authUserSectors,({sector:t,next_status:e})=>({...t,next_status:e}))),S(this.selectedSector)&&(this.selectedSector=s)}}},data(){return{roles:l,icons:{faHandHoldingUsd:y,faTshirt:u},authUserSectors:[],selectedSector:{}}},computed:{isLoading(){return!!this.$apollo.queries.authUserSectors.loading}},watch:{selectedSector(s){this.$emit("sector-change",s)}},methods:{isSectorActive(s){return s.id===this.selectedSector.id},onSectorClick(s){this.selectedSector=s}}};var j=function(){var t=this,e=t._self._c;return e("div",[e("AppLoading",{directives:[{name:"show",rawName:"v-show",value:t.isLoading,expression:"isLoading"}]}),e("div",[t.authUserSectors.length?e("ul",{staticClass:"nav nav-pills nav-fill flex-nowrap",class:{"table-responsive":t.$isMobile}},t._l(t.authUserSectors,function(r){return e("li",{key:r.sector.id,staticClass:"nav-item small"},[e("a",{staticClass:"nav-link",class:{"active fw-bold":t.isSectorActive(r.sector),"bg-white":!t.isSectorActive(r.sector),"text-nowrap":t.$isMobile},attrs:{href:"#"},on:{click:function(i){return i.preventDefault(),t.onSectorClick(r.sector)}}},[t._v(" "+t._s(r.sector.name)+" "),e("span",{staticClass:"badge",class:{"bg-light text-dark":t.isSectorActive(r.sector),"bg-primary":!t.isSectorActive(r.sector)}},[t._v(t._s(r.orders_count))])]),t.$helpers.canView(t.roles.GERENCIA)?e("div",{staticClass:"d-flex flex-column bg-white justify-content-between"},[e("span",{staticClass:"fw-bold text-primary text-nowrap mt-2"},[e("FontAwesomeIcon",{attrs:{icon:t.icons.faTshirt}}),t._v(" "+t._s(r.quantity_count)+" ")],1),e("span",{staticClass:"fw-bold text-success text-nowrap mb-2"},[e("FontAwesomeIcon",{attrs:{icon:t.icons.faHandHoldingUsd}}),t._v(" "+t._s(t.$helpers.toBRL(r.pendency_total))+" ")],1)]):t._e()])}),0):t._e()])],1)},q=[],H=a(U,j,q,!1,null,null,null,null);const V=H.exports,G={components:{VueLoadImage:P},props:{orderId:{type:[String,Number],required:!0},image:void 0},computed:{orderImage(){return this.image?this.image[0]:null}}};var Q=function(){var t=this,e=t._self._c;return e("div",{staticClass:"d-flex h-100 justify-content-center align-items-center"},[t.orderImage?e("AppViewer",{ref:`viewer_${t.orderId}`,attrs:{"extra-toolbar":["print"]}},[e("VueLoadImage",[e("img",{key:t.orderImage,ref:"image",staticClass:"img-fluid img-thumbnail clickable",attrs:{slot:"image",src:t.orderImage,alt:"Imagem da arte"},slot:"image"}),e("div",{staticClass:"position-relative py-5",attrs:{slot:"preloader"},slot:"preloader"},[e("AppLoading")],1)])],1):e("div",{staticClass:"img-thumbnail d-flex justify-content-center align-items-center text-secondary h-100 w-100 fw-bold"},[e("span",[t._v("[SEM IMAGEM]")])])],1)},z=[],W=a(G,Q,z,!1,null,null,null,null);const K=W.exports,Y={mixins:[I],props:{order:{type:Object,default:()=>{}}},data(){return{icons:{faTruck:C}}},computed:{isExpiredDeliveryDate(){const s=o.fromISO(o.now().toISODate());return o.fromISO(this.order.delivery_date)<s},isNearDeliveryDate(){const s=o.fromISO(o.now().toISODate()),t=s.plus({days:2}),e=o.fromISO(this.order.delivery_date);return t>=e||e===s},titleBackgroundClass(){return this.isExpiredDeliveryDate?"bg-link-danger":this.isNearDeliveryDate?"bg-link-camaleao":this.isOrderPreRegistered?"bg-link-warning":"bg-link-primary"},orderUrl(){return this.isOrderPreRegistered&&!this.order.client?this.$helpers.getUrl("orders.show.pre-registered",{order:this.order.id}):this.$helpers.getUrl("orders.show",{client:this.order.client.id,order:this.order.id})}},methods:{formatDatetime:f}};var Z=function(){var t=this,e=t._self._c;return e("div",{staticClass:"d-flex justify-content-between flex-column flex-sm-row align-items-baseline mt-2 fw-bold"},[e("h5",[e("a",{staticClass:"text-decoration-none text-white badge clickable",class:t.titleBackgroundClass,attrs:{href:t.orderUrl,target:"_blank"}},[!t.order.code&&!t.order.client?[t._v(" [PRE-REGISTRO] ")]:[e("span",{staticClass:"fw-bold"},[t._v(" "+t._s(t.order.code)+" ")]),e("span",{staticClass:"mx-2"},[t._v("•")]),e("span",[t._v(t._s(t.order.client.name))])],t.order.delivery_date?[e("span",{staticClass:"mx-2"},[t._v("•")]),e("span",[e("FontAwesomeIcon",{attrs:{icon:t.icons.faTruck}}),t._v(" "+t._s(t.formatDatetime(t.order.delivery_date,"dd/MM"))+" ")],1)]:t._e()],2)]),e("div",[t.isExpiredDeliveryDate?e("span",{staticClass:"badge small bg-danger me-2"},[e("FontAwesomeIcon",{attrs:{icon:t.icons.faTruck,"fixed-width":""}}),t._v(" Entrega atrasada ")],1):t._e(),e("span",{staticClass:"badge small bg-warning"},[t._v(" "+t._s(t.order.status.text)+" ")])])])},J=[],X=a(Y,Z,J,!1,null,null,null,null);const tt=X.exports,et={props:{status:{type:Object,required:!0},confirmedStatus:{type:Array,required:!0},preConfirmedStatus:{type:Object,default:()=>({})}},data(){return{icons:{faCheck:p,faClock:b,faUser:x}}},computed:{isStepPreConfirmed(){return this.preConfirmedStatus?this.status.order<=this.preConfirmedStatus.order:!1},isStepConfirmable(){return!n(this.confirmedStatus,"id").includes(this.status.id)},isStepConfirmed(){return this.confirmedStatus.some(s=>s.id===this.status.id)},itemClass(){return this.isStepConfirmed?"step-confirmed":this.isStepPreConfirmed?"step-pre-confirmed":this.isStepConfirmable?"step-confirmable":""}},methods:{get:d,formatDatetime:f,onStepClick(s){this.isStepConfirmed||this.$emit("step-click",s)},getConcludedStatus(s=null){const t=this.confirmedStatus.find(e=>e.id===this.status.id);return s?d(t,s):t}}};var st=function(){var t=this,e=t._self._c;return e("li",{staticClass:"step w-100",class:t.itemClass},[e("div",{staticClass:"step-number",on:{click:function(r){return r.preventDefault(),t.onStepClick(t.status)}}},[e("FontAwesomeIcon",{attrs:{icon:t.icons.faCheck}})],1),e("div",{staticClass:"step-label"},[t._v(" "+t._s(t.status.text)+" ")]),t.isStepConfirmed?[t.getConcludedStatus("pivot.confirmed_at")?e("div",{staticClass:"step-info"},[e("FontAwesomeIcon",{attrs:{icon:t.icons.faClock,"fixed-width":""}}),t._v(" "+t._s(t.formatDatetime(t.getConcludedStatus("pivot.confirmed_at"),"dd/LL 'às' HH:mm"))+" ")],1):t._e(),t.getConcludedStatus("pivot.user.name")?e("div",{staticClass:"small text-secondary"},[e("FontAwesomeIcon",{attrs:{icon:t.icons.faUser,"fixed-width":""}}),t._v(" "+t._s(t.getConcludedStatus("pivot.user.name"))+" ")],1):t._e()]:t._e()],2)},rt=[],at=a(et,st,rt,!1,null,null,null,null);const it=at.exports;const ot={components:{ProductionTrackNavItems:it,ModalOrderStatusOverrideDates:L},props:{order:{type:Object,required:!0},linkedStatus:{type:Array,required:!0},sectorStatus:{type:Object,required:!0}},data:()=>({overridingStatus:[],preConfirmedStatus:null,overridingStatusOption:"UPDATE"}),computed:{confirmedStatus(){return this.linkedStatus.filter(s=>s.pivot.is_confirmed)},getProgressBarWidth(){const s=!!this.sectorStatus.next_status,t=n(this.confirmedStatus,"id"),e=n(this.sectorStatus.items,"id");return 100*t.filter(i=>e.includes(i)).length/(e.length+(s?1:0))}},methods:{getStatusOverriding(s,t){return this.$helpers.getStatusBetween(s,t,this.linkedStatus).filter(r=>r.pivot.confirmed_at)},async stepToStatus(s,t=!1){const e=this.order,r=this.linkedStatus.find(c=>c.id===s.id),i=this.getStatusOverriding(e.status,r);if(i.length&&!t){this.preConfirmedStatus=s,this.overridingStatus=i;return}this.$emit("loading",{id:this.order.id,value:!0});try{await this.$apollo.mutate({mutation:w,variables:{orderId:e.id,statusId:r.id,overrideOption:this.overridingStatusOption},refetchQueries:[_,m],awaitRefetchQueries:!0}),this.$emit("loading",{id:this.order.id,value:!1}),this.overridingStatus=[],this.preConfirmedStatus=null,this.$toast.success("Status atualizado!")}catch{this.$toast.error("Ops! Algo deu errado")}}}};var nt=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"step-container position-relative mt-3"},[e("div",{staticClass:"step-progress-bar",style:{width:`${t.getProgressBarWidth}%`}}),e("div",{staticClass:"step-progress-bar-placeholder"}),e("ul",{staticClass:"step-progress w-100 table-responsive"},[t._l(t.sectorStatus.items,function(r){return e("ProductionTrackNavItems",{key:r.id,attrs:{status:r,"confirmed-status":t.confirmedStatus,"pre-confirmed-status":t.preConfirmedStatus},on:{"step-click":t.stepToStatus}})}),t.sectorStatus.next_status?e("ProductionTrackNavItems",{attrs:{"pre-confirmed-status":t.preConfirmedStatus,status:t.sectorStatus.next_status,"confirmed-status":t.confirmedStatus},on:{"step-click":t.stepToStatus}}):t._e()],2),t.overridingStatus.length?e("AppContainer",{staticClass:"mt-3 mb-2",scopedSlots:t._u([{key:"title",fn:function(){return[t._v(" Conflito de data de confirmação ")]},proxy:!0},{key:"body",fn:function(){return[e("div",{staticClass:"small"},[e("ModalOrderStatusOverrideDates",{attrs:{status:t.overridingStatus},model:{value:t.overridingStatusOption,callback:function(r){t.overridingStatusOption=r},expression:"overridingStatusOption"}})],1),e("div",[e("AppButton",{attrs:{"btn-class":"btn-sm fw-bold"},on:{click:function(r){return r.preventDefault(),t.stepToStatus(t.preConfirmedStatus,!0)}}},[t._v(" Continuar ")])],1)]},proxy:!0}],null,!1,1280441977)}):t._e()],1)])},ct=[],dt=a(ot,nt,ct,!1,null,"44b54442",null,null);const lt=dt.exports;const ut={components:{SectorOrdersListImage:K,SectorOrdersListInfo:tt,SectorOrdersListStatus:lt},props:{canCloseOrders:{type:Boolean,default:!1},sectorStatus:{type:Object,default:()=>({})},orders:{type:Array,default:()=>[]}},data(){return{isStatusLoading:{id:"",value:!1},isLoading:{id:"",value:!1},icons:{faCheck:p}}},methods:{orderHasPendencies(s){return s.total_owing>0},async onCloseOrderClick({id:s}){this.isLoading={id:s,value:!0};try{await this.$apollo.mutate({mutation:$,variables:{id:s}}),this.$toast.success("Pedido fechado!")}catch(t){const e=t.graphQLErrors[0].extensions.reason;this.$toast.error(e)}this.isLoading={id:"",value:!1}},onStatusLoading({id:s,value:t}){this.isStatusLoading.id=s,this.isStatusLoading.value=t}}};var ft=function(){var t=this,e=t._self._c;return e("div",t._l(t.orders,function(r){return e("div",{key:r.id,staticClass:"card mb-1"},[e("AppLoading",{directives:[{name:"show",rawName:"v-show",value:t.isStatusLoading.id===r.id&&t.isStatusLoading.value,expression:"isStatusLoading.id === order.id && isStatusLoading.value"}]}),e("div",{staticClass:"card-body position-relative card-sector-body p-1 row flex-column flex-sm-row gx-2"},[e("div",{staticClass:"col col-sm-3"},[e("SectorOrdersListImage",{key:`image_${r.id}`,attrs:{"order-id":r.id,image:r.art_paths}})],1),e("div",{staticClass:"col"},[e("SectorOrdersListInfo",{attrs:{order:r}}),e("SectorOrdersListStatus",{attrs:{order:r,"sector-status":t.sectorStatus,"linked-status":r.linked_status},on:{loading:t.onStatusLoading}})],1),t.canCloseOrders?e("div",{staticClass:"text-end"},[e("AppButton",{directives:[{name:"tippy",rawName:"v-tippy"}],attrs:{rounded:"",loading:t.isLoading.id===r.id&&t.isLoading.value,color:t.orderHasPendencies(r)?"secondary":"success",outlined:"","btn-class":"btn-sm",content:t.orderHasPendencies(r)?"Não é possível fechar pedido com pendência financeira":"Fechar pedido",icon:t.icons.faCheck,disabled:t.orderHasPendencies(r)},on:{click:function(i){return i.preventDefault(),t.onCloseOrderClick(r)}}})],1):t._e()])],1)}),0)},pt=[],mt=a(ut,ft,pt,!1,null,"196f1893",null,null);const _t=mt.exports;const vt={apollo:{ordersBySector:{query:_,variables(){return{first:10,page:this.page,sectorId:this.sector.id,order_by:[{column:"DELIVERY_DATE",order:"ASC"}]}},result(){this.isLoading2=!1},fetchPolicy:"no-cache",skip(){return this.skip}}},components:{TheProductionTrackNavs:V,SectorOrdersList:_t},data(){return{ordersBySector:{data:[],paginatorInfo:{},nothing:!0},page:1,sectors:[],sector:{},skip:!0,isLoading2:!1}},computed:{sectorStatus(){const s=this.sectors.filter(t=>t.id===this.sector.id)[0];return{items:s.status,next_status:s.next_status}},isLoading(){return this.page!==this.ordersBySector.paginatorInfo.currentPage||this.ordersBySector.nothing===!0||this.isLoading2}},watch:{page(){this.$refs.scrollableDiv.scrollTop=0},sector(s){this.isLoading2=!0}},methods:{refresh(){this.$apollo.queries.ordersBySector.refetch()},onSectorChange(s){this.sector=s,this.skip=!1,this.page=1},onSectorsLoaded(s){this.sectors=s}}};var ht=function(){var t=this,e=t._self._c;return e("div",{staticClass:"card mt-2"},[e("div",{staticClass:"card-header p-0"},[e("TheProductionTrackNavs",{on:{"sector-change":t.onSectorChange,"sectors-loaded":t.onSectorsLoaded}})],1),e("div",{ref:"scrollableDiv",staticClass:"card-body position-relative card-sector-body custom-scrollbar smooth-scroll"},[e("AppLoading",{directives:[{name:"show",rawName:"v-show",value:t.isLoading,expression:"isLoading"}]}),t.ordersBySector.data.length?e("SectorOrdersList",{attrs:{"can-close-orders":t.sector.can_close_sector_orders,"sector-status":t.sectorStatus,orders:t.ordersBySector.data}}):e("div",{staticClass:"text-center text-secondary my-3"},[t._v(" Nenhum pedido encontrado ")]),e("AppPaginator",{staticClass:"position-fixed bottom-0",style:{zIndex:100},attrs:{pagination:t.ordersBySector.paginatorInfo,"is-loading":t.isLoading},model:{value:t.page,callback:function(r){t.page=r},expression:"page"}})],1)])},gt=[],St=a(vt,ht,gt,!1,null,"20ad5a6c",null,null);const yt=St.exports,Ct={metaInfo(){return{title:"Esteira de Produção"}},components:{TheProductionTrackHeader:N,TheProductionTrackBody:yt},methods:{refresh(){this.$refs.productionTrackBody.refresh()}}};var bt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"py-2"},[e("TheProductionTrackHeader",{on:{refresh:t.refresh}}),e("TheProductionTrackBody",{ref:"productionTrackBody"})],1)},xt=[],kt=a(Ct,bt,xt,!1,null,null,null,null);const Bt=kt.exports;export{Bt as default};
