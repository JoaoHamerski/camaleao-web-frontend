import{n as s,L as A,F as C,B as w,u as S,h as B,z as v,p as N,M as b,x as f,N as E,O as I,s as k,G as D,P as T,Q as P}from"./index-fae63e1f.js";import{d as L}from"./_PaginatorFragment-c01a3fe7.js";import{a as M,b as O,m as R}from"./masks-168ccaff.js";import{B as U}from"./BudgetFormProductsHeader-9ac68bc3.js";import{o as p}from"./omit-574aa98c.js";import"./_flatRest-a6acb8a9.js";var o={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"BudgetParts"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Budget"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"client"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"product"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"product_items"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"date"},arguments:[],directives:[]}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetBudgets"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"page"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"budgets"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"page"},value:{kind:"Variable",name:{kind:"Name",value:"page"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paginatorInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PaginatorSimpleParts"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"data"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"BudgetParts"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetBudgetUrl"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"budgetUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadBudgetGeneratorSettings"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"BudgetSettingsInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"budgetGeneratorSettingsUpload"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"json"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CreateBudget"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"BudgetInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"budgetCreate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UpdateBudget"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"BudgetInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"budgetUpdate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"BudgetParts"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteBudget"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"budgetDelete"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:801}};o.loc.source={body:`#import "./_PaginatorFragment.gql"

fragment BudgetParts on Budget {
  id
  client
  product
  product_items
  date
}

query GetBudgets($first: Int!, $page: Int) {
  budgets(first: $first, page: $page) {
    paginatorInfo {
      ...PaginatorSimpleParts
    }

    data {
      ...BudgetParts
    }
  }
}

query GetBudgetUrl($id: ID!) {
  budgetUrl(id: $id)
}

mutation UploadBudgetGeneratorSettings($input: BudgetSettingsInput!) {
  budgetGeneratorSettingsUpload(input: $input) {
    id
    name
    json
  }
}

mutation CreateBudget($input: BudgetInput!) {
  budgetCreate(input: $input) {
    id
  }
}

mutation UpdateBudget($id: ID!, $input: BudgetInput!) {
  budgetUpdate(id: $id, input: $input) {
    ...BudgetParts
  }
}

mutation DeleteBudget($id: ID!) {
  budgetDelete(id: $id) {
    id
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var h={};function G(i){return i.filter(function(e){if(e.kind!=="FragmentDefinition")return!0;var t=e.name.value;return h[t]?!1:(h[t]=!0,!0)})}o.definitions=o.definitions.concat(G(L.definitions));function m(i,e){if(i.kind==="FragmentSpread")e.add(i.name.value);else if(i.kind==="VariableDefinition"){var t=i.type;t.kind==="NamedType"&&e.add(t.name.value)}i.selectionSet&&i.selectionSet.selections.forEach(function(n){m(n,e)}),i.variableDefinitions&&i.variableDefinitions.forEach(function(n){m(n,e)}),i.definitions&&i.definitions.forEach(function(n){m(n,e)})}var g={};(function(){o.definitions.forEach(function(e){if(e.name){var t=new Set;m(e,t),g[e.name.value]=t}})})();function y(i,e){for(var t=0;t<i.definitions.length;t++){var n=i.definitions[t];if(n.name&&n.name.value==e)return n}}function u(i,e){var t={kind:i.kind,definitions:[y(i,e)]};i.hasOwnProperty("loc")&&(t.loc=i.loc);var n=g[e]||new Set,a=new Set,d=new Set;for(n.forEach(function(r){d.add(r)});d.size>0;){var l=d;d=new Set,l.forEach(function(r){if(!a.has(r)){a.add(r);var c=g[r]||new Set;c.forEach(function(F){d.add(F)})}})}return a.forEach(function(r){var c=y(i,r);c&&t.definitions.push(c)}),t}u(o,"BudgetParts");const _=u(o,"GetBudgets"),V=u(o,"GetBudgetUrl"),q=u(o,"UploadBudgetGeneratorSettings"),Q=u(o,"CreateBudget"),z=u(o,"UpdateBudget"),j=u(o,"DeleteBudget"),H={apollo:{generatorSettings:{query:A,variables:{name:"app",key:"budget_generator_settings",encoded:!1},update(i){const e=JSON.parse(i.configGet),t="https://api.flashcomunicacao.com";return e&&(e.logo&&(e.logo=`${t}/storage/budget_settings/${e.logo}`),e.signature_image&&(e.signature_image=`${t}/storage/budget_settings/${e.signature_image}`),e)},result(){this.populateForm()}}},data(){return{generatorSettings:{},isLoading:!1,form:new C({logo:"",header:"",content:"",date:"",signature_image:""})}},computed:{isQueryLoading(){return!!this.$apollo.queries.generatorSettings.loading},navItems(){return[{value:"logo",text:"Logo",fields:["logo"]},{value:"header",text:"Cabeçalho",fields:["header"]},{value:"content",text:"Conteúdo",fields:["content"]},{value:"date",text:"Data",fields:["date"]},{value:"signature_image",text:"Assinatura",fields:["signature_image"]}]}},methods:{populateForm(){Object.assign(this.form,this.generatorSettings||{})},configHasImage(i){return w(this.generatorSettings,i)},async onFileUpload(i,e){const t=await this.$helpers.inputFileToBase64(i[0]);this.form[e]=t,this.form.errors.clear(e)},async onSubmit(){const i=this.form.data();this.isLoading=!0;try{await this.$apollo.mutate({mutation:q,variables:{input:i}}),this.$toast.success("Configurações atualizadas!")}catch(e){S(this,e)}this.isLoading=!1}}};var J=function(){var e=this,t=e._self._c;return t("form",{on:{submit:function(n){return n.preventDefault(),e.onSubmit.apply(null,arguments)}}},[t("AppLoading",{directives:[{name:"show",rawName:"v-show",value:e.isQueryLoading,expression:"isQueryLoading"}]}),t("AppNavPills",{attrs:{items:e.navItems,errors:Object.keys(e.form.errors.errors)},scopedSlots:e._u([{key:"logo",fn:function(){return[t("AppInputFile",{attrs:{id:"logo",accept:"image/*",centered:""},on:{input:n=>e.onFileUpload(n,"logo")}}),e.form.logo?[t("div",{staticClass:"form-label fw-bold"},[e._v(" "+e._s(e.configHasImage("logo")?"Logo armazenada:":"Pré-visualização:")+" ")]),t("div",{staticClass:"col-4"},[t("img",{staticClass:"img-fluid img-thumbnail",attrs:{src:e.form.logo,alt:"Logo"}})])]:e._e()]},proxy:!0},{key:"header",fn:function(){return[t("AppEditor",{attrs:{error:e.form.errors.get("header"),placeholder:"Digite o cabeçalho..."},on:{focus:function(n){return e.form.errors.clear("header")}},model:{value:e.form.header,callback:function(n){e.$set(e.form,"header",n)},expression:"form.header"}})]},proxy:!0},{key:"content",fn:function(){return[t("div",{staticClass:"text-secondary small"},[e._v(" Informe os seguintes caracteres para serem substituídos por dados: "),t("ul",[t("li",[t("b",[e._v("%cliente%")]),e._v(" - Nome do cliente (Ex.: José da Penha)")]),t("li",[t("b",[e._v("%produto%")]),e._v(" - Produto do recibo (Ex.: Camisa personalizada)")])])]),t("AppEditor",{attrs:{error:e.form.errors.get("content"),placeholder:"Digite o conteúdo..."},on:{focus:function(n){return e.form.errors.clear("content")}},model:{value:e.form.content,callback:function(n){e.$set(e.form,"content",n)},expression:"form.content"}})]},proxy:!0},{key:"date",fn:function(){return[t("div",{staticClass:"text-secondary small"},[e._v(" Informe os seguintes caracteres para serem substituídos por dados: "),t("ul",[t("li",[t("b",[e._v("%data%")]),e._v(" - Data por extenso (Ex.: 01 de Janeiro de 2020)")])])]),t("AppEditor",{attrs:{error:e.form.errors.get("date"),placeholder:"Digite a data..."},on:{focus:function(n){return e.form.errors.clear("date")}},model:{value:e.form.date,callback:function(n){e.$set(e.form,"date",n)},expression:"form.date"}})]},proxy:!0},{key:"signature_image",fn:function(){return[t("AppInputFile",{attrs:{id:"signature_image",accept:"image/*",centered:""},on:{input:n=>e.onFileUpload(n,"signature_image")}}),e.form.signature_image?[t("div",{staticClass:"form-label fw-bold"},[e._v(" "+e._s(e.configHasImage("signature_imageg")?"Assinature armazenada:":"Pré-visualização:")+" ")]),t("div",{staticClass:"col-4"},[t("img",{staticClass:"img-fluid img-thumbnail",attrs:{src:e.form.signature_image,alt:"Assinature"}})])]:e._e()]},proxy:!0}])}),t("div",{staticClass:"row mt-3"},[t("div",{staticClass:"col"},[t("AppButton",{attrs:{loading:e.isLoading,block:"","btn-class":"fw-bold",color:"success",type:"submit"}},[e._v(" Salvar ")])],1),t("div",{staticClass:"col"},[t("AppButton",{attrs:{type:"button",disabled:e.isLoading,block:"",color:"light","data-bs-dismiss":"modal"}},[e._v(" Fechar ")])],1)])],1)},K=[],W=s(H,J,K,!1,null,null,null,null);const X=W.exports,Y={components:{BudgetSettingsForm:X},props:{value:{type:Boolean,default:!1}},data(){return{icons:{faCog:B}}}};var Z=function(){var e=this,t=e._self._c;return t("AppModal",e._g(e._b({attrs:{id:"budgetSettingsModal",value:e.value,"modal-dialog-class":"modal-lg"},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faCog,"fixed-width":""}}),e._v(" Configurações do orçamento ")]},proxy:!0},{key:"body",fn:function(){return[e.value?t("BudgetSettingsForm"):e._e()]},proxy:!0}])},"AppModal",e.$attrs,!1),e.$listeners))},ee=[],te=s(Y,Z,ee,!1,null,null,null,null);const ne=te.exports,ie=[{abbr:"un",name:"Unidade"},{abbr:"pc",name:"Peça"},{abbr:"pct",name:"Pacote"},{abbr:"cx",name:"Caixa"},{abbr:"m",name:"Metro"}],ae={components:{BudgetFormProductsHeader:U},props:{form:{type:Object,required:!0}},data(){return{UNITIES:ie,maskCurrencyBRL:M(),maskInteger:O({delimiter:"",numeralDecimalScale:0}),icons:{faPlus:v,faTrashAlt:N}}},computed:{isDeleteProductDisabled(){return this.form.product_items.length===1},getTotal(){const i=this.form.product_items.reduce((e,t)=>{const n=this.$helpers.unformatCurrencyBRL(t.value);return!t.quantity||!n?e:e+ +b(t.quantity*n,2)},0);return this.$helpers.toBRL(i)}},methods:{getTotalRow({quantity:i,value:e}){const t=this.$helpers.unformatCurrencyBRL(e);if(!i||!t)return"R$ ";const n=b(i*t,2);return this.$helpers.toBRL(n)},onNewItemClick(){this.$emit("new-item")},onDeleteItemClick(i){this.$emit("delete-item",i)},unityLabelProp(i){return`${i.abbr.toUpperCase()} - ${i.name}`},getProductItem(i,e=null){const t=this.form.product_items.findIndex(n=>i===n.id);return e?this.form.product_items[t][e]:this.form.product_items[t]},setFormById(i,e,t){const n=this.form.product_items.findIndex(a=>i===a.id);this.form.set({[`product_items.${n}.${e}`]:t})},hasError(i,e){return i.errors.includes(e)}}};var re=function(){var e=this,t=e._self._c;return t("AppContainer",{scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Produtos ")]},proxy:!0},{key:"body",fn:function(){return[t("BudgetFormProductsHeader"),e._l(e.form.product_items,function(n){return[t("div",{key:n.id,staticClass:"row"},[t("div",{staticClass:"col-1"},[t("AppInput",{attrs:{id:`product_items.${n.id}.item`,name:`product_items.${n.id}.item`,disabled:"",value:e.getProductItem(n.id,"item")}})],1),t("div",{staticClass:"col-3"},[t("AppInput",{attrs:{id:`product_items.${n.id}.description`,name:`product_items.${n.id}.description`,value:e.getProductItem(n.id,"description"),error:e.hasError(n,"description")},on:{input:function(a){return e.setFormById(n.id,"description",a)}}})],1),t("div",{staticClass:"col-2"},[t("AppSimpleSelect",{attrs:{id:`product_items.${n.id}.unity`,name:`product_items.${n.id}.unity`,value:e.getProductItem(n.id,"unity"),options:e.UNITIES,"label-prop":e.unityLabelProp,"value-prop":"abbr","hide-default-option":""},on:{input:function(a){return e.setFormById(n.id,"unity",a)}}})],1),t("div",{staticClass:"col-1"},[t("AppInput",{attrs:{id:`product_items.${n.id}.quantity`,name:`product_items.${n.id}.quantity`,value:e.getProductItem(n.id,"quantity"),error:e.hasError(n,"quantity"),mask:e.maskInteger},on:{input:function(a){return e.setFormById(n.id,"quantity",a)}}})],1),t("div",{staticClass:"col-2"},[t("AppInput",{attrs:{id:`product_items.${n.id}.value`,name:`product_items.${n.id}.value`,value:e.getProductItem(n.id,"value"),error:e.hasError(n,"value"),mask:e.maskCurrencyBRL},on:{input:function(a){return e.setFormById(n.id,"value",a)}}})],1),t("div",{staticClass:"col-2"},[t("AppInput",{attrs:{id:`product_items.${n.id}.total`,name:`product_items.${n.id}.total`,value:e.getTotalRow(e.getProductItem(n.id)),disabled:""}})],1),t("div",{staticClass:"col-1"},[t("AppButton",{attrs:{outlined:"",color:"danger",icon:e.icons.faTrashAlt,disabled:e.isDeleteProductDisabled},on:{click:function(a){return a.preventDefault(),e.onDeleteItemClick(n)}}})],1)])]}),t("div",{staticClass:"row"},[t("div",{staticClass:"col-9"},[t("AppInput",{attrs:{id:"total-label",value:"TOTAL",name:"total-label","input-class":"fw-bold text-end",disabled:""}})],1),t("div",{staticClass:"col-2"},[t("AppInput",{attrs:{id:"total",name:"total",disabled:"",value:e.getTotal}})],1)]),t("div",{staticClass:"text-center"},[t("AppButton",{attrs:{outlined:"",color:"success",icon:e.icons.faPlus},on:{click:function(n){return n.preventDefault(),e.onNewItemClick.apply(null,arguments)}}})],1)]},proxy:!0}])})},oe=[],se=s(ae,re,oe,!1,null,null,null,null);const de=se.exports,$={id:f("new_"),item:1,description:"",quantity:"",unity:"un",value:"R$ ",errors:[]},le={components:{BudgetFormProducts:de},props:{isEdit:{type:Boolean,default:!1},budget:{type:Object,default:()=>({})}},data(){return{maskDate:R,isLoading:!1,form:new C({product:"",client:"",date:"",product_items:[{...$}]})}},mounted(){this.isEdit&&this.populateForm()},methods:{populateForm(){const e=JSON.parse(this.budget.product_items).map(t=>({...t,id:f("stored_"),value:this.$helpers.toBRL(t.value),errors:[]}));this.form.set({...p(this.budget,["product_items","date"]),product_items:e,date:E(this.budget.date)})},onNewItem(){this.form.product_items.push({...$,id:f("_new"),item:this.form.product_items.length+1})},onDeleteItem(i){if(this.form.product_items.length===1)return;const e=this.form.product_items.findIndex(({item:t})=>t===i.item);this.form.product_items.splice(e,1),this.form.product_items.forEach((t,n)=>{t.item=n+1})},getFormattedForm(){const i=I(this.form.data());return i.product_items=i.product_items.map(e=>({...p(e,["id","errors"])})),i},async submitForm(i){if(this.isEdit){await this.update(i);return}await this.create(i)},async onSubmit(){const i=this.getFormattedForm();this.isLoading=!0;try{await this.submitForm(i)}catch(e){S(this,e),this.handleProductItemsError(e)}this.isLoading=!1},async create(i){await this.$apollo.mutate({mutation:Q,variables:{input:i},refetchQueries:[_],awaitRefetchQueries:!0}),k(this,{resetForm:!0,message:"Orçamento cadastrado!"})},async update(i){await this.$apollo.mutate({mutation:z,variables:{id:this.budget.id,input:i}}),k(this,{message:"Orçamento atualizado!"})},handleProductItemsError(i){const e=p(i.graphQLErrors[0].extensions.validation,["client","product","date"]);this.form.product_items.forEach((t,n)=>{const l=Object.keys(e).filter(r=>r.includes(`.${n}.`)).map(r=>r.split(`.${n}.`)[1]);t.errors=l})},clearProductItemsError(i){const[e,t,n]=i.target.name.split(".");if(e!=="product_items")return;const a=this.form.product_items.findIndex(l=>t===l.id),d=this.form.product_items[a];d.errors=d.errors.filter(l=>l!==n)}}};var ue=function(){var e=this,t=e._self._c;return t("AppForm",{attrs:{form:e.form,"on-submit":e.onSubmit},nativeOn:{"!focus":function(n){return e.clearProductItemsError.apply(null,arguments)}}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col"},[t("AppInput",{attrs:{id:"client",name:"client",placeholder:"Digite o cliente...",error:e.form.errors.get("client")},model:{value:e.form.client,callback:function(n){e.$set(e.form,"client",n)},expression:"form.client"}},[e._v(" Cliente ")])],1),t("div",{staticClass:"col"},[t("AppInput",{attrs:{id:"product",name:"product",placeholder:"Digite o produto...",error:e.form.errors.get("product")},model:{value:e.form.product,callback:function(n){e.$set(e.form,"product",n)},expression:"form.product"}},[e._v(" Nome do produto ")])],1)]),t("BudgetFormProducts",{staticClass:"my-3",attrs:{form:e.form},on:{"new-item":e.onNewItem,"delete-item":e.onDeleteItem}}),t("AppInput",{attrs:{id:"date",name:"date",type:"date",placeholder:"dd/mm/aaaa",error:e.form.errors.get("date"),mask:e.maskDate},model:{value:e.form.date,callback:function(n){e.$set(e.form,"date",n)},expression:"form.date"}},[e._v(" Data ")]),t("div",{staticClass:"row mt-2"},[t("div",{staticClass:"col"},[t("AppButton",{attrs:{block:"",color:"success","btn-class":"fw-bold",loading:e.isLoading}},[e._v(" "+e._s(e.isEdit?"Atualizar":"Cadastrar")+" ")])],1),t("div",{staticClass:"col"},[t("AppButton",{attrs:{block:"",color:"light",disabled:e.isLoading,type:"button","data-bs-dismiss":"modal"}},[e._v(" Cancelar ")])],1)])],1)},ce=[],me=s(le,ue,ce,!1,null,null,null,null);const x=me.exports,pe={components:{BudgetForm:x},props:{value:{type:Boolean,default:!1}},data(){return{icons:{faPlus:v}}},methods:{onSuccess(){this.$emit("success")}}};var fe=function(){var e=this,t=e._self._c;return t("AppModal",e._g(e._b({attrs:{id:"budgetCreateModal",value:e.value,"modal-dialog-class":"modal-xl"},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faPlus,"fixed-width":""}}),e._v(" Gerar novo orçamento ")]},proxy:!0},{key:"body",fn:function(){return[t("KeepAlive",[e.value?t("BudgetForm",{on:{success:e.onSuccess}}):e._e()],1)]},proxy:!0}])},"AppModal",e.$attrs,!1),e.$listeners))},ge=[],ve=s(pe,fe,ge,!1,null,null,null,null);const _e=ve.exports,be={components:{BudgetCreateModal:_e,BudgetSettingsModal:ne},data(){return{budgetSettingsModal:!1,budgetCreateModal:!1,icons:{faPlus:v,faCog:B}}},methods:{onNewBudgetClick(){this.budgetCreateModal=!0},onSettingsClick(){this.budgetSettingsModal=!0},onNewBudgetCreated(){this.budgetCreateModal=!1},onEditBudget(){this.budgetE}}};var ke=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"d-flex justify-content-between mt-3"},[t("AppButton",{attrs:{"btn-class":"fw-bold",color:"success",icon:e.icons.faPlus},on:{click:function(n){return n.preventDefault(),e.onNewBudgetClick.apply(null,arguments)}}},[e._v(" Novo orçamento ")]),t("AppButton",{attrs:{"btn-class":"fw-bold",icon:e.icons.faCog},on:{click:e.onSettingsClick}},[e._v(" Configurações ")])],1),t("BudgetCreateModal",{on:{success:e.onNewBudgetCreated},model:{value:e.budgetCreateModal,callback:function(n){e.budgetCreateModal=n},expression:"budgetCreateModal"}}),t("BudgetSettingsModal",{model:{value:e.budgetSettingsModal,callback:function(n){e.budgetSettingsModal=n},expression:"budgetSettingsModal"}})],1)},he=[],ye=s(be,ke,he,!1,null,null,null,null);const $e=ye.exports,Ce={props:{budgets:{type:Array,default:()=>[]}},data(){return{budgetToOpen:{id:"",isLoading:!1},budgetToDelete:{id:"",isLoading:!1},icons:{faEdit:D,faTrashAlt:N,faExternalLinkAlt:T}}},computed:{headers(){return[{value:"client",text:"Cliente"},{value:"product",text:"Produto"},{value:"date",text:"Data",format:"datetime"},{value:"options",text:"",align:"right"}]}},methods:{onEditClick(i){this.$emit("edit",i)},onDeleteClick(i){this.budgetToDelete.id=i.id},onCancelDeleteClick(){this.budgetToDelete.id=""},async onConfirmDeleteClick({id:i}){this.budgetToDelete.isLoading=!0;try{await this.$apollo.mutate({mutation:j,variables:{id:i},refetchQueries:[_],awaitRefetchQueries:!0}),this.$toast.success("Orçamento deletado!")}catch{this.$toast.error("Ops! Algo deu errado.")}this.budgetToDelete.isLoading=!1},async onOpenBudgetClick(i){this.budgetToOpen.id=i.id,this.budgetToOpen.isLoading=!0;try{const{data:{budgetUrl:e}}=await this.$apollo.query({query:V,variables:{id:i.id},fetchPolicy:"no-cache"});this.$helpers.openInNewTab(e)}catch{this.$toast.error("Ops! Algo deu errado.")}this.budgetToOpen.isLoading=!1}}};var Se=function(){var e=this,t=e._self._c;return t("AppTable",{attrs:{items:e.budgets,headers:e.headers},scopedSlots:e._u([{key:"items.options",fn:function({item:n}){return[n.id===e.budgetToDelete.id?t("div",[t("div",{staticClass:"text-end text-subtitle fw-bold"},[e._v(" DELETAR ")]),t("div",{staticClass:"text-end"},[t("AppButton",{staticClass:"me-2",attrs:{color:"success","btn-class":"btn-sm fw-bold",loading:e.budgetToDelete.isLoading},on:{click:function(a){return a.preventDefault(),e.onConfirmDeleteClick(n)}}},[e._v(" Confirmar ")]),t("AppButton",{attrs:{color:"light","btn-class":"btn-sm",disable:e.budgetToDelete.isLoading},on:{click:function(a){return a.preventDefault(),e.onCancelDeleteClick.apply(null,arguments)}}},[e._v(" Cancelar ")])],1)]):t("div",{staticClass:"text-end"},[t("AppButton",{attrs:{"btn-class":"btn-sm",outlined:"",icon:e.icons.faExternalLinkAlt,loading:e.budgetToOpen.id===n.id&&e.budgetToOpen.isLoading},on:{click:function(a){return a.preventDefault(),e.onOpenBudgetClick(n)}}}),t("AppButton",{staticClass:"mx-2",attrs:{"btn-class":"btn-sm",outlined:"",icon:e.icons.faEdit},on:{click:function(a){return a.preventDefault(),e.onEditClick(n)}}}),t("AppButton",{attrs:{color:"danger","btn-class":"btn-sm",outlined:"",icon:e.icons.faTrashAlt},on:{click:function(a){return a.preventDefault(),e.onDeleteClick(n)}}})],1)]}}],null,!0)})},Be=[],Ne=s(Ce,Se,Be,!1,null,null,null,null);const De=Ne.exports,xe={components:{BudgetForm:x},props:{budget:{type:Object,default:()=>({})},value:{type:Boolean,default:!1}},data(){return{icons:{faEdit:D}}},methods:{onSuccess(){this.$emit("success")}}};var Fe=function(){var e=this,t=e._self._c;return t("AppModal",e._g(e._b({attrs:{id:"budgetEditModal",value:e.value,"modal-dialog-class":"modal-xl"},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faEdit,"fixed-width":""}}),e._v(" Alterar orçamento ")]},proxy:!0},{key:"body",fn:function(){return[e.value?t("BudgetForm",{attrs:{"is-edit":"",budget:e.budget},on:{success:e.onSuccess}}):e._e()]},proxy:!0}])},"AppModal",e.$attrs,!1),e.$listeners))},Ae=[],we=s(xe,Fe,Ae,!1,null,null,null,null);const Ee=we.exports,Ie={components:{BudgetTable:De,BudgetEditModal:Ee},apollo:{budgets:{query:_,variables(){return{first:10,page:this.page}}}},data(){return{page:1,budgetEditModal:{value:!1,budget:{}},budgets:{paginatorInfo:{},data:[]},icons:{faThList:P}}},computed:{isQueryLoading(){return!!this.$apollo.queries.budgets.loading}},methods:{onEdit(i){this.budgetEditModal.budget=i,this.budgetEditModal.value=!0},onEditSuccess(){this.budgetEditModal.value=!1,this.budgetEditModal.budget={}}}};var Te=function(){var e=this,t=e._self._c;return t("div",[t("BudgetEditModal",{attrs:{budget:e.budgetEditModal.budget},on:{success:e.onEditSuccess},model:{value:e.budgetEditModal.value,callback:function(n){e.$set(e.budgetEditModal,"value",n)},expression:"budgetEditModal.value"}}),t("AppCard",{staticClass:"mt-2",scopedSlots:e._u([{key:"header",fn:function(){return[t("h6",{staticClass:"mb-0 fw-bold"},[t("FontAwesomeIcon",{attrs:{icon:e.icons.faThList,"fixed-width":""}}),e._v(" Orçamentos gerados ")],1)]},proxy:!0},{key:"body",fn:function(){return[t("AppLoading",{directives:[{name:"show",rawName:"v-show",value:e.isQueryLoading,expression:"isQueryLoading"}]}),t("BudgetTable",{attrs:{budgets:e.budgets.data},on:{edit:e.onEdit}})]},proxy:!0}])}),t("AppPaginator",{staticClass:"mt-2",attrs:{pagination:e.budgets.paginatorInfo},model:{value:e.page,callback:function(n){e.page=n},expression:"page"}})],1)},Pe=[],Le=s(Ie,Te,Pe,!1,null,null,null,null);const Me=Le.exports,Oe={metaInfo:{title:"Gerador de Orçamento"},components:{TheBudgetGeneratorHeader:$e,TheBudgetGeneratorBody:Me}};var Re=function(){var e=this,t=e._self._c;return t("div",[t("TheBudgetGeneratorHeader"),t("TheBudgetGeneratorBody")],1)},Ue=[],Ge=s(Oe,Re,Ue,!1,null,null,null,null);const Je=Ge.exports;export{Je as default};
