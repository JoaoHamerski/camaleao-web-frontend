import{n as s,aU as b,bP as y,aQ as O,b0 as E,aq as _,a$ as $,bU as R,am as k,r as u,w as D,bn as A,bQ as w,ap as I,N as l,B as c,bq as d,bV as p,A as S,a4 as h,D as B,a5 as i,aA as T}from"./index-4e05606f.js";import{f as P}from"./filesMixin-04d56c50.js";import{C as M,G as L,R as N}from"./WeeklyCalendar-dccba4d1.js";import{o as x}from"./orderStatesMixin-3d8dcb0c.js";import{V as F}from"./vue-load-image-d69823bb.js";import{h as G}from"./Order-ebd7beca.js";import{G as q}from"./Status-e5c68e0d.js";import{D as H}from"./vuedraggable.umd-b7fab7d9.js";import"./filter-bdbeaf8b.js";import"./_PaginatorFragment-c01a3fe7.js";import"./ActivityFragments-a3df58d3.js";const m={PRE_REGISTERED:"PRÉ-REGISTRO",PRE_CREATED:"FALTA CADASTRAR"},V={props:{order:{type:Object,default:null},isExpanded:{type:Boolean,default:!1}},data(){return{icons:{faBoxOpen:b}}},computed:{orderTitle(){return this.order.code?this.order.code:this.order.isPreCreated?m.PRE_CREATED:m.PRE_REGISTERED},orderUrl(){return this.order.isPreCreated?null:this.order.client?this.$helpers.getUrl("orders.show",{client:this.order.client.id,order:this.order.id}):this.$helpers.getUrl("orders.show.pre-registered",{order:this.order.id})}}};var U=function(){var e=this,r=e._self._c;return r("div",{staticClass:"card-header text-white fw-bold position-relative",class:!e.isExpanded&&"text-center"},[e.orderUrl?r("a",{staticClass:"stretched-link",attrs:{href:e.orderUrl,target:"_blank"}}):e._e(),r("FontAwesomeIcon",{directives:[{name:"show",rawName:"v-show",value:e.isExpanded,expression:"isExpanded"}],attrs:{icon:e.icons.faBoxOpen}}),e._v(" "+e._s(e.orderTitle)+" ")],1)},j=[],W=s(V,U,j,!1,null,null,null,null);const Q=W.exports,z={data(){return{icons:{faImage:y}}}};var J=function(){var e=this,r=e._self._c;return r("div",{staticClass:"text-center text-secondary"},[r("div",[r("FontAwesomeIcon",{attrs:{icon:e.icons.faImage,size:"5x"}})],1),r("div",{staticClass:"small"},[e._v(" SEM IMAGEM ")])])},K=[],X=s(z,J,K,!1,null,null,null,null);const Y=X.exports,Z={components:{VueLoadImage:F,OrderCardBodyImageEmpty:Y},props:{order:{type:Object,required:!0}},computed:{orderImage(){return this.order.art_paths?this.order.art_paths[0]:this.order.isPreCreated?this.order.image.base64:null}}};var ee=function(){var e=this,r=e._self._c;return r("div",{staticClass:"img-thumbnail border-0"},[e.orderImage?r("AppViewer",[r("VueLoadImage",[r("img",{staticClass:"img-fluid clickable",attrs:{slot:"image",src:e.orderImage,alt:"Imagem da arte"},slot:"image"}),r("div",{staticClass:"position-relative py-5",attrs:{slot:"preloader"},slot:"preloader"},[r("AppLoading")],1)])],1):r("OrderCardBodyImageEmpty")],1)},te=[],re=s(Z,ee,te,!1,null,null,null,null);const ae=re.exports,se=[{title:"Nome do cliente",prop:"client.name",icon:O,classes:"fw-bold",link:t=>t.order.client?E("clients.show",{client:t.order.client.id}):null},{title:"Quantidade",prop:"quantity",icon:_,classes:t=>t.isExpanded&&"fw-bold",computedProp:t=>$(R(t,"F","peça"))},{hideOnShrink:!0,title:"Valor do pedido",prop:"price",icon:k,classes:"fw-bold",computedProp:t=>u(t)},{hideOnShrink:!0,title:"Falta pagar",prop:"total_owing",icon:D,classes:t=>t.order.total_owing<=0?"text-success fw-bold":"text-danger fw-bold",computedProp:t=>t<=0?"Pedido pago":u(t)},{hideOnShrink:!0,title:"Status do pedido",prop:"status.text",icon:t=>t.order.status.is_available?A:w,classes:t=>t.order.status.is_available?"text-success fw-bold":"text-warning fw-bold",renderCheckButton:t=>t.order.can_be_concluded},{title:"Data de cadastro",prop:"created_at",icon:I,computedProp:t=>l(t)}];function ie(t,e){return t("a",{attrs:{href:e.item.link(e),target:"_blank"},class:"text-decoration-none"},[C(t,e)])}function C(t,e){const r=c(e.order,e.item.prop);return e.item.computedProp?e.item.computedProp(r):r}function de(t,e){if(e.shouldRenderCheckButton())return t("AppButton",{attrs:{"btn-class":"btn-sm",icon:S,color:"success",outlined:!0,loading:e.loadingButton,content:"Concluir status"},directives:[{name:"tippy",value:{placement:"top"}}],on:{click:r=>(r.preventDefault(),(()=>e.btnClicked(e.item.prop))())}})}function oe(t,e){if(c(e.order,e.item.prop))return t("li",{directives:[{name:"tippy",value:{placement:e.isExpanded&&!e.$isMobile?"right":"bottom",delay:[400,0]}}],attrs:{content:e.item.title},class:d(["list-group-item d-flex justify-content-between align-items-center",p(e.item.classes)?e.item.classes(e):e.item.classes])},[t("span",[t("FontAwesomeIcon",{attrs:{icon:p(e.item.icon)?e.item.icon(e):e.item.icon,"fixed-width":!0},class:"me-1"}),e.item.link?ie(t,e):C(t,e)]),de(t,e)])}const ne={props:{loadingButton:{type:Boolean,default:!1},isExpanded:{type:Boolean,default:!1},item:{type:Object,default:null},order:{type:Object,default:null}},data(){return{itemsWithButtons:["status.text"]}},methods:{shouldRenderCheckButton(){return this.itemsWithButtons.includes(this.item.prop)?!!this.item.renderCheckButton(this):!1},btnClicked(t){t==="status.text"&&this.$emit("btn-status-clicked")}},render(t){return oe(t,this)}},le=null,ce=null;var ue=s(ne,le,ce,!1,null,null,null,null);const pe=ue.exports,me={components:{OrderCardItem:pe},props:{loadingButton:{type:Boolean,default:!1},order:{type:Object,default:null},isExpanded:{type:Boolean,default:!1}},data(){return{orderCardItems:se}},methods:{get:c,onBtnStatusClicked(){this.$emit("conclude-status")}}};var fe=function(){var e=this,r=e._self._c;return r("ul",{staticClass:"list-group list-group-flush"},[e._l(e.orderCardItems,function(a){return[r("OrderCardItem",{key:a.title,class:[!a.hideOnShrink||e.isExpanded?"d-block":"d-none"],attrs:{order:e.order,item:a,"is-expanded":e.isExpanded,"loading-button":e.loadingButton},on:{"btn-status-clicked":e.onBtnStatusClicked}})]})],2)},_e=[],he=s(me,fe,_e,!1,null,null,null,null);const Ce=he.exports;const ve={components:{OrderCardHeader:Q,OrderCardBodyImage:ae,OrderCardItems:Ce},mixins:[x],props:{isOrderable:{type:Boolean,default:!1},index:{type:Number,default:0},isCompact:{type:Boolean,default:!1},isActive:{type:Boolean,default:!1},order:{type:Object,default:null},field:{type:String,required:!0}},data(){return{isLoading:!1}},computed:{isOrderExpanded(){return!this.order.isPreCreated&&this.isActive},cardColor(){return this.order.isPreCreated?"camaleao":this.isOrderPreRegistered?"warning":this.order.is_concluded?"secondary":"primary"},orderHeaderClass(){return this.order.isPreCreated?`bg-${this.cardColor}`:`clickable bg-link-${this.cardColor}`}},methods:{async onConcludeStatus(){this.isLoading=!0;try{const{data:{orderConcludeStatus:{status:t}}}=await this.$apollo.mutate({mutation:M,variables:{id:this.order.id,field:this.field},refetchQueries:[L],awaitRefetchQueries:!0});this.$helpers.clearCacheFrom({fieldName:"orders"}),this.$toast.success(`Status do pedido concluído para ${t.text}`)}catch{this.$toast.error("Ops! Algo deu errado!")}this.isLoading=!1}}};var ge=function(){var e=this,r=e._self._c;return r("div",{staticClass:"card position-relative",class:!e.isOrderExpanded&&"card-shrink"},[r("OrderCardHeader",{class:e.orderHeaderClass,attrs:{order:e.order,"is-expanded":e.isOrderExpanded}}),r("div",{staticClass:"card-body"},[r("OrderCardBodyImage",{attrs:{order:e.order}}),r("OrderCardItems",{attrs:{order:e.order,"is-expanded":e.isOrderExpanded,"loading-button":e.isLoading},on:{"conclude-status":e.onConcludeStatus}})],1),r("div",{directives:[{name:"show",rawName:"v-show",value:e.isOrderable,expression:"isOrderable"}],staticClass:"orderable-overflow"},[r("div",[e._v(e._s(e.index+1))])])],1)},be=[],ye=s(ve,ge,be,!1,null,"c6b41359",null,null);const Oe=ye.exports;const Ee={components:{OrderCard:Oe,OrderCreateCard:()=>h(()=>import("./OrderCreateCard-1924692a.js"),["assets/OrderCreateCard-1924692a.js","assets/index-4e05606f.js","assets/index-1259f392.css","assets/WeeklyCalendar-dccba4d1.js","assets/Status-e5c68e0d.js"])},props:{isOrderable:{type:Boolean,default:!1},index:{type:Number,default:0},isCompact:{type:Boolean,default:!1},isActive:{type:Boolean,default:!1},order:{type:Object,default:null},field:{type:String,required:!0},orders:{type:Array,default:()=>[]}}};var $e=function(){var e=this,r=e._self._c;return r("div",{staticClass:"card-production-wrapper mb-2",class:{active:e.isActive,"card-compact":e.isCompact}},[e.order.isPreCreated&&e.isActive?r("OrderCreateCard",e._g(e._b({key:"new-order"},"OrderCreateCard",e.$props,!1),e.$listeners)):r("OrderCard",e._g(e._b({key:`order__${e.order.id}`},"OrderCard",e.$props,!1),e.$listeners))],1)},Re=[],ke=s(Ee,$e,Re,!1,null,"1ea2daf2",null,null);const De=ke.exports,Ae={props:{active:{type:Boolean,required:!0},date:{type:Object,required:!0}},data(){return{icons:{faTshirt:_}}},computed:{isDateToday(){return this.date.date===B.now().toISODate()},cardHeaderClasses(){const e=!this.$isMobile?"-link-":"-";return[this.isDateToday?`bg${e}success`:`bg${e}primary`,!this.$isMobile&&"clickable"]}},methods:{formatDate(t){return this.active?l(t,"dd/MM - EEEE"):l(t,"dd/MM - EEE")},onCardHeaderClick(t){this.$isMobile&&t.preventDefault(),this.$emit("header-clicked",{date:this.date.date,active:!this.active})}}};var we=function(){var e=this,r=e._self._c;return r("div",{staticClass:"card-header text-white text-center py-1",class:e.cardHeaderClasses,on:{click:function(a){return a.preventDefault(),e.onCardHeaderClick.apply(null,arguments)}}},[r("div",{staticClass:"text-uppercase fw-bold"},[e._v(" "+e._s(e.formatDate(e.date.date))+" ")]),r("div",{staticClass:"small"},[r("FontAwesomeIcon",{attrs:{icon:e.icons.faTshirt,"fixed-width":""}}),e._v(" "+e._s(e.date.total_quantity?`${e.date.total_quantity} peças`:"Nenhuma peça")+" ")],1)])},Ie=[],Se=s(Ae,we,Ie,!1,null,null,null,null);const Be=Se.exports,Te={apollo:{status:{query:q}},props:{field:{type:String,required:!0},isCompact:{type:Boolean,default:!1},isOrderable:{type:Boolean,default:!1},date:{type:Object,required:!0}},data(){return{status:[],selectedStatus:"",roles:i,isReportLoading:!1,isLoading:!1,icons:{faFilePdf:T}}},computed:{renderReorderOption(){return this.$helpers.canView(i.GERENCIA,i.ATENDIMENTO,i.ESTAMPA)&&this.field==="PRINT_DATE"}},methods:{onCancelReorderClick(){this.onOrderableModeChange(!1),this.$emit("orderable-mode-canceled")},async onSaveReorderClick(){const t=this.date.orders.map(({id:e},r)=>({id:e,order:r}));this.isLoading=!0,await this.$apollo.mutate({mutation:N,variables:{input:t}}),this.isLoading=!1,this.$toast.success("Pedidos reordenados!"),this.onCancelReorderClick()},onOrderableModeChange(t){this.$emit("orderable-mode-changed",t)},onCompactModeChange(t){this.$emit("compact-mode-changed",t)},onImageInput(t){this.$emit("input-image",t)},async onWeeklyProductionReportClick(){const t=this.date.date;this.isReportLoading=!0;try{const e=await this.$apollo.query({query:G,variables:{input:{field:this.field,date:t,status_id:this.selectedStatus}},fetchPolicy:"network-only"}),{data:{ordersWeeklyCalendarReport:r}}=e;this.$helpers.openInNewTab(r)}catch{this.$toast.error("Ops! Algo deu errado, tente novamente!")}this.isReportLoading=!1}}};var Pe=function(){var e=this,r=e._self._c;return r("div",[r("div",{staticClass:"d-flex flex-column flex-sm-row mb-2"},[r("div",{staticClass:"d-flex flex-column flex-sm-row col"},[r("div",{staticClass:"col text-center text-sm-start col-sm-3"},[e.$helpers.canView(e.roles.GERENCIA,e.roles.ATENDIMENTO,e.roles.DESIGN)?r("AppInputFile",{staticClass:"mb-2 mb-sm-0",attrs:{id:"orderImage","default-margin":!1,"disable-input-area":!0,accept:"image/*"},on:{input:e.onImageInput}}):e._e()],1),r("div",{staticClass:"col col-sm-6"},[r("div",{staticClass:"app-input-group"},[e.$helpers.canView(e.roles.GERENCIA,e.roles.ATENDIMENTO,e.roles.DESIGN,e.roles.COSTURA,e.roles.ESTAMPA)?r("AppButton",{staticClass:"ms-0 ms-sm-2",attrs:{icon:e.icons.faFilePdf,"btn-class":"fw-bold",loading:e.isReportLoading},on:{click:function(a){return a.preventDefault(),e.onWeeklyProductionReportClick.apply(null,arguments)}}},[e._v(" Gerar relatório ")]):e._e(),r("AppSimpleSelect",{staticClass:"col flex-grow-1",attrs:{id:"status","remove-default-margin":"",name:"status","value-prop":"id","label-prop":"text",placeholder:"Todos",options:e.status},model:{value:e.selectedStatus,callback:function(a){e.selectedStatus=a},expression:"selectedStatus"}})],1)])]),r("div",{staticClass:"d-flex flex-column-reverse flex-sm-row"},[e.isOrderable?r("div",{staticClass:"me-2"},[r("AppButton",{staticClass:"me-2",attrs:{color:"success","btn-class":"btn-sm",outlined:"",loading:e.isLoading},on:{click:function(a){return a.preventDefault(),e.onSaveReorderClick.apply(null,arguments)}}},[e._v(" Salvar ")]),r("AppButton",{attrs:{color:"secondary","btn-class":"btn-sm",outlined:"",disabled:e.isLoading},on:{click:function(a){return a.preventDefault(),e.onCancelReorderClick.apply(null,arguments)}}},[e._v(" Cancelar ")])],1):e._e(),e.renderReorderOption?r("div",{staticClass:"mt-2 mt-sm-0"},[r("AppCheckboxSwitch",{staticClass:"me-2",attrs:{id:"orderable_mode",value:e.isOrderable},on:{input:e.onOrderableModeChange}},[e._v(" Reordenar ")])],1):e._e()]),e.$isMobile?e._e():r("div",[r("AppCheckboxSwitch",{attrs:{id:"compact_mode",value:e.isCompact},on:{input:e.onCompactModeChange}},[e._v(" Modo compacto ")])],1)])])},Me=[],Le=s(Te,Pe,Me,!1,null,null,null,null);const Ne=Le.exports,xe=()=>h(()=>import("./CardDateColumnDragged-d59d9c77.js"),["assets/CardDateColumnDragged-d59d9c77.js","assets/index-4e05606f.js","assets/index-1259f392.css","assets/filesMixin-04d56c50.js","assets/filter-bdbeaf8b.js","assets/WeeklyCalendar-dccba4d1.js","assets/orderStatesMixin-3d8dcb0c.js","assets/vue-load-image-d69823bb.js","assets/Order-ebd7beca.js","assets/_PaginatorFragment-c01a3fe7.js","assets/ActivityFragments-a3df58d3.js","assets/Status-e5c68e0d.js","assets/vuedraggable.umd-b7fab7d9.js"]),o={DRAG_LEAVE:0,DRAG_ENTER:1},Fe=(t,e)=>{const r={"header-clicked":e.onHeaderClicked};return t(Be,{attrs:{date:e.date,active:e.active},on:{...r}})},Ge=(t,e)=>{const r={"drag-state-changed":e.onDragStateChanged,"file-drop":e.onFileDrop};return t(xe,{on:{...r}})},qe=(t,e,r,a)=>{const n={"cancel-create":e.onCancelCreate,"order-created":e.onOrderCreated};return t(De,{key:`order__${r.id}`,attrs:{order:r,index:a,"is-active":e.active,"is-compact":e.isCompact,"is-orderable":e.isOrderable&&e.active,field:e.field,orders:e.date.orders},on:{...n}})},f=(t,e)=>e.date.orders.map((r,a)=>qe(t,e,r,a)),He=(t,e)=>{const r={start:()=>{e.drag=!0},end:()=>{e.drag=!1}},a={animation:200,group:"description",disabled:!1,ghostClass:"ghost"};return e.hasOrders&&e.isOrderable&&e.active?t(H,{attrs:{tag:"div",list:e.date.orders,...a},on:{...r}},[t("TransitionGroup",{class:d(e.active&&"row gx-2"),attrs:{tag:"div",type:"transition",name:e.drag?null:"flip-list"}},[f(t,e)])]):e.hasOrders?t("div",{class:d(e.active&&"row gx-2")},[f(t,e)]):t("span",{class:d(["d-block text-center text-secondary py-3",{"py-5 my-5 h6":e.active,small:!e.active}])},["SEM PEDIDOS"])},Ve=(t,e)=>{const r={"orderable-mode-changed":e.onOrderableModeChanged,"orderable-mode-canceled":e.onOrderableModeCanceled,"compact-mode-changed":e.onCompactModeChange,"input-image":e.onImageUploaded},{date:a,isCompact:n,isOrderable:v,field:g}=e;if(e.active)return t(Ne,{attrs:{date:a,isCompact:n,isOrderable:v,field:g},on:{...r}})},Ue=(t,e)=>e.dragState===o.DRAG_ENTER?Ge(t,e):t("div",{class:d(["card-body px-2"]),on:{dragenter:r=>(r.stopPropagation(),r.preventDefault(),e.onDragOverCard(r))}},[Ve(t,e),He(t,e)]),je={mixins:[P],props:{field:{type:String,required:!0},date:{type:Object,default:()=>({})},active:{type:Boolean,default:!1},orderToCreate:{type:Object,default:null},isCompact:{type:Boolean,default:!1},isOrderable:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},data(){return{DRAG_STATES:o,dragState:o.DRAG_LEAVE,drag:!1}},computed:{hasOrders(){return this.date.orders.length}},methods:{onOrderableModeCanceled(){this.$emit("orderable-mode-canceled")},onOrderableModeChanged(t){this.$emit("orderable-mode-changed",t)},onCompactModeChange(t){this.$emit("is-compact:update",t)},onHeaderClicked({date:t,active:e}){this.$emit("change-state",{date:t,active:e})},onDragStateChanged(t){this.dragState=t},async onImageUploaded(t){try{const e=await this.getBase64Files(t),r=this.getOnlyValidFiles(e,["image"]),a=r[0];if(!r.length)return;this.$emit("uploaded-file",{file:a,date:this.date.date})}catch{this.$toast.error("Ops! Algo deu errado, tente novamente.")}},onCancelCreate(t){this.$emit("cancel-create",t)},onOrderCreated(t){this.$emit("order-created",t)},onFileDrop(t){const{dataTransfer:{files:e}}=t;if(this.dragState=o.DRAG_LEAVE,!e.length){this.$toast.error("Não foram encontrados arquivos!");return}this.onImageUploaded(e)},onDragOverCard(){this.isOrderable||this.$helpers.canView(i.GERENCIA,i.ATENDIMENTO,i.DESIGN)&&(this.dragState=o.DRAG_ENTER)}},render(t){return t("div",{class:d(["col card-column",this.active&&"active"])},[t("div",{class:"card position-relative"},[t("AppLoading",{directives:[{name:"show",value:this.isLoading&&this.active}]}),Fe(t,this),Ue(t,this)])])}};const We=null,Qe=null;var ze=s(je,We,Qe,!1,null,"9691db6c",null,null);const dt=ze.exports;export{o as DRAG_STATES,dt as default};
