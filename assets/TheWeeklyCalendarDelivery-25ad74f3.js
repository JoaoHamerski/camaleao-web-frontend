import{G as c}from"./WeeklyCalendar-dccba4d1.js";import{n as s,o as u,aq as f,as as p,K as m,D as n,bp as l,bq as _,a4 as d,O as h,x as C}from"./index-4e05606f.js";import{p as v}from"./pasteFilesMixin-1129ca11.js";import{f as y}from"./filesMixin-04d56c50.js";const b={props:{field:{type:String,required:!0}},data(){return{FIELD_TYPES:i,week:"",icons:{faSyncAlt:u}}},computed:{getIconByFieldType(){return this.field==="PRINT_DATE"?f:this.field==="SEAM_DATE"?p:m},fieldTypeLabel(){return i[this.field]}},methods:{getInputDate(t){return t===null?n.now().toFormat("dd/MM/y"):t===""?null:t.split("-")[0]},onWeekSelected(t){const e=this.getInputDate(t);e&&this.$emit("week-selected",e)},onRefreshClick(){this.$emit("refresh")}}};var g=function(){var e=this,a=e._self._c;return a("div",{staticClass:"card"},[a("div",{staticClass:"card-header bg-primary text-white d-flex flex-column flex-sm-row justify-content-between align-items-sm-center"},[a("div",{staticClass:"mb-3 mb-sm-0"},[a("h5",{staticClass:"fw-bold mb-0"},[a("FontAwesomeIcon",{attrs:{icon:e.getIconByFieldType,"fixed-width":""}}),e._v(" Calendário de "+e._s(e.fieldTypeLabel)+" ")],1),a("div",{staticClass:"small"},[e._v(" Pedidos com "),a("span",{staticClass:"fw-bold"},[e._v(" data de "),a("span",{staticClass:"text-lowercase"},[e._v(e._s(e.FIELD_TYPES[e.field]))])]),e._v(" pela semana ")])]),a("div",{staticClass:"d-flex"},[a("AppInput",{staticClass:"flex-grow-1",attrs:{id:"week","input-class":"border-0",name:"week",type:"week",placeholder:"Selecione uma semana...","default-margin":!1},on:{input:e.onWeekSelected},model:{value:e.week,callback:function(r){e.week=r},expression:"week"}}),a("AppButton",{staticClass:"ms-2",attrs:{"btn-class":"border-0 text-primary",icon:e.icons.faSyncAlt,color:"light",tooltip:"Atualizar"},on:{click:function(r){return r.preventDefault(),e.onRefreshClick.apply(null,arguments)}}})],1)])])},w=[],k=s(b,g,w,!1,null,"b809783a",null,null);const D=k.exports,E=()=>d(()=>import("./CardDateColumnsMobile-0b5fb9fb.js"),["assets/CardDateColumnsMobile-0b5fb9fb.js","assets/index-4e05606f.js","assets/index-1259f392.css","assets/WeeklyCalendar-dccba4d1.js","assets/pasteFilesMixin-1129ca11.js","assets/filesMixin-04d56c50.js","assets/filter-bdbeaf8b.js"]),$=()=>d(()=>import("./CardDateColumn-1601374c.js"),["assets/CardDateColumn-1601374c.js","assets/index-4e05606f.js","assets/index-1259f392.css","assets/filesMixin-04d56c50.js","assets/filter-bdbeaf8b.js","assets/WeeklyCalendar-dccba4d1.js","assets/orderStatesMixin-3d8dcb0c.js","assets/vue-load-image-d69823bb.js","assets/Order-ebd7beca.js","assets/_PaginatorFragment-c01a3fe7.js","assets/ActivityFragments-a3df58d3.js","assets/Status-e5c68e0d.js","assets/vuedraggable.umd-b7fab7d9.js","assets/CardDateColumn-fdc1ed3a.css"]);function T(t,e){return t("div",{class:"col",key:`${e.date}__placeholder`})}const A=(t,e,a)=>{const r={"is-compact:update":e.onCompactModeChange,"change-state":e.onStateChanged,"uploaded-file":e.onFileUploaded,"cancel-create":e.onCancelCreate,"orderable-mode-canceled":e.onOrderableModeCanceled,"orderable-mode-changed":e.onOrderableModeChanged};return t($,{class:"mb-2",key:`${a.date}__date`,attrs:{date:a,active:e.isColumnActive(a),"is-compact":e.isCompact,"is-orderable":e.isOrderable,"is-loading":e.isLoading,field:e.field},on:{...r}})};function O(t,e){return t.activeDate===e.date}function M(t,e){return e.dates.map(a=>[A(t,e,a),O(e,a)&&T(t,a)])}const F={mixins:[y,v],props:{field:{type:String,required:!0},isLoading:{type:Boolean,default:!1},selectedDate:{type:String,default:""},dates:{type:Array,default:()=>[]},orderToCreate:{type:Object,default:()=>null}},data(){return{activeDate:"",isCompact:!1,isOrderable:!1,modalReport:{value:!1,src:""}}},mounted(){window.addEventListener("keydown",this.disableActiveCard),window.addEventListener("paste",this.onPasteEvent),this.isCompact=l.get("production-card-compact-mode")==="true"},beforeDestroy(){window.removeEventListener("keydown",this.disableActiveCard),window.removeEventListener("paste",this.onPasteEvent)},methods:{onOrderableModeChanged(t){this.isOrderable=t},onOrderableModeCanceled(){this.isOrderable=!1,this.$emit("orderable-mode-canceled")},isColumnActive(t){return this.activeDate===t.date||this.$isMobile},afterPaste(t){const e=this.getOnlyValidFiles(t,["image"]);if(!e.length){this.$toast.error("Nenhum arquivo válido foi detectado");return}if(this.activeDate===""){this.$toast.warning("Abra um dia da semana para colar uma imagem");return}e.length&&this.onFileUploaded({file:e[0],date:this.activeDate})},onStateChanged({date:t,active:e}){if(e){this.activeDate=t;return}this.activeDate="",this.isOrderable&&this.onOrderableModeCanceled()},disableActiveCard({key:t}){t==="Escape"&&(this.activeDate="")},onFileUploaded({file:t,date:e}){this.activeDate===""&&(this.activeDate=e),this.$emit("uploaded-file",{file:t,date:e})},onCancelCreate(t){this.$emit("cancel-create",t)},onCompactModeChange(t){l.set("production-card-compact-mode",t),this.isCompact=t},onReportModalHidden(){this.modalReport.src=""}},render(t){return t("div",{class:_(["position-relative h-100 row gx-1",{"py-5":!this.dates.length}])},[t("AppLoading",{directives:[{name:"show",value:this.isLoading&&this.activeDate===""}]}),this.$isMobile?t(E,{attrs:{context:this}}):M(t,this)])}},L=null,S=null;var R=s(F,L,S,!1,null,null,null,null);const I=R.exports,i={PRINT_DATE:"Estampa",SEAM_DATE:"Costura",DELIVERY_DATE:"Entrega"},P={components:{WeeklyCalendarHeader:D,WeeklyCalendarBody:I},apollo:{weeklyCalendar:{query:c,variables(){return{date:this.date,field:this.field}},result({data:{weeklyCalendar:t},loading:e}){e||(this.weeklyCalendar=h(t))}}},props:{field:{type:String,required:!0}},data(){return{weeklyCalendar:[],date:n.now().toFormat("dd/MM/y")}},computed:{lowerCaseField(){return this.field.toLowerCase()},isLoading(){return!!this.$apollo.queries.weeklyCalendar.loading}},methods:{refresh(){this.$apollo.queries.weeklyCalendar.refetch()},onWeekSelected(t){this.date=t},onFileUploaded({file:t,date:e}){const a=this.weeklyCalendar.find(o=>o.date===e),r={id:C("pre-created-"),isPreCreated:!0,date:e,date_field:this.lowerCaseField,image:t};a.orders.unshift(r)},onCancelOrder(t){const e=this.weeklyCalendar.find(r=>r.date===t.date),a=e.orders.find(r=>r.id===t.id);e.orders.splice(a,1)},onOrderableModeCanceled(){this.refresh()}}};var W=function(){var e=this,a=e._self._c;return a("div",[a("WeeklyCalendarHeader",{staticClass:"my-1",attrs:{field:e.field},on:{"week-selected":e.onWeekSelected,refresh:e.refresh}}),a("WeeklyCalendarBody",{attrs:{field:e.field,dates:e.weeklyCalendar,"selected-date":e.date,"is-loading":e.isLoading},on:{"uploaded-file":e.onFileUploaded,"cancel-create":e.onCancelOrder,"orderable-mode-canceled":e.onOrderableModeCanceled}})],1)},x=[],q=s(P,W,x,!1,null,null,null,null);const B=q.exports,U={metaInfo:{title:"Calendário de Entrega"},components:{WeeklyCalendar:B}};var V=function(){var e=this,a=e._self._c;return a("WeeklyCalendar",{attrs:{field:"DELIVERY_DATE"}})},j=[],H=s(U,V,j,!1,null,null,null,null);const N=H.exports,J=Object.freeze(Object.defineProperty({__proto__:null,default:N},Symbol.toStringTag,{value:"Module"}));export{J as T,A as r};
