import{T as I,d as b,e as L,U as B,D as M,f as q}from"./Order-ebd7beca.js";import{o as V}from"./orderStatesMixin-3d8dcb0c.js";import{n as a,G as _,p as f,aS as A,aT as j,aU as x,a0 as N,X as h,aV as H,aW as G,am as O,a1 as U,i as l,A as k,J as P,F as D,s as y,u as g,aX as Q,N as d,a4 as $,r as z,a5 as p,w as K,b as J,K as W,aC as X,aY as Y,aD as Z,aZ as ee,c as te,a6 as se,a_ as re,aq as ae}from"./index-4e05606f.js";import{C as ne}from"./ClientCard-853a24df.js";import{O as oe}from"./OrderReminder-a79f5072.js";import{P as ie}from"./PaymentExpenseStatus-b4702367.js";import{P as le}from"./PaymentConfirmErrorModal-361ea8ab.js";import{A as de}from"./ActivityItem-f32937c4.js";import{M as ce}from"./ModalOrderStatusOverrideDates-c2f80977.js";import"./_PaginatorFragment-c01a3fe7.js";import"./ActivityFragments-a3df58d3.js";import"./ClientForm-658a958e.js";import"./Client-cfdef3aa.js";import"./City-ae18d4e9.js";import"./Resources-b591129f.js";import"./ShippingCompany-204ada3f.js";import"./masks-168ccaff.js";const ue={props:{order:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isReportLoading:{type:Boolean,default:!1},isOrderClosed:{type:Boolean,required:!0},isOrderPaid:{type:Boolean,required:!0},isOrderPreRegistered:{type:Boolean,required:!0}},data(){return{isToggleLoading:!1,icons:{faEdit:_,faTrashAlt:f,faExchangeAlt:A,faTimesCircle:j,faBoxOpen:x}}},methods:{async toggleOrder(){const r=this.order.closed_at===null;this.isToggleLoading=!0;try{await this.$apollo.mutate({mutation:I,variables:{id:this.order.id}}),this.$emit("toggle-success"),this.$toast.success(r?"Pedido fechado":"Pedido reaberto")}catch{this.$toast.error("Ops! Algo deu errado.")}this.isToggleLoading=!1},redirectToOrderEdit(){const{clientKey:r,orderKey:e}=this.$route.params;if(!this.order.client){this.$helpers.redirectTo(N.editPreRegistered,{order:this.order});return}this.$helpers.redirectTo(N.edit,{client:r,order:e})},onDeleteOrderClick(){this.$emit("open-modal",{modal:"delete-order"})},onChangeStatusClick(){this.$emit("open-modal",{modal:"change-status"})}}};var me=function(){var e=this,t=e._self._c;return e.isLoading?e._e():t("ul",{staticClass:"dropdown-menu",attrs:{"aria-labelledby":"dropdownOptions"},on:{click:function(s){s.stopPropagation()}}},[e.isToggleLoading?t("AppLoading"):e._e(),t("AppDropdownItem",{attrs:{"disabled-message":e.isOrderClosed&&"Não é possível editar pedidos fechados.",icon:e.icons.faEdit,text:e.isOrderPreRegistered?"Concluir cadastro":"Editar","icon-color":"primary"},on:{click:function(s){return s.preventDefault(),e.redirectToOrderEdit.apply(null,arguments)}}}),t("AppDropdownItem",{attrs:{icon:e.icons.faTrashAlt,text:"Excluir","icon-color":"danger"},on:{click:e.onDeleteOrderClick}}),t("div",{staticClass:"dropdown-divider"}),t("AppDropdownItem",{attrs:{"disabled-message":e.isOrderClosed&&"Não é possível alterar status de pedidos fechados.",icon:e.icons.faExchangeAlt,text:"Alterar status","icon-color":"primary"},on:{click:e.onChangeStatusClick}}),t("AppDropdownItem",{attrs:{"disabled-message":!e.isOrderPaid&&"Não é possível fechar pedidos com pendência financeira.",icon:e.isOrderClosed?e.icons.faBoxOpen:e.icons.faTimesCircle,text:e.isOrderClosed?"Reabrir pedido":"Fechar pedido","icon-color":"primary"},on:{click:function(s){return s.preventDefault(),e.toggleOrder.apply(null,arguments)}}})],1)},pe=[],_e=a(ue,me,pe,!1,null,null,null,null);const fe=_e.exports,ve={components:{TheOrderHeaderCogOptions:fe},props:{order:{type:Object,default:()=>{}},isLoading:{type:Boolean,default:!1},isReportLoading:{type:Boolean,default:!1},isOrderClosed:{type:Boolean,required:!0},isOrderPaid:{type:Boolean,required:!0},isOrderPreRegistered:{type:Boolean,required:!0}},data(){return{clients:h,icons:{faEllipsisH:H,faFileInvoice:G,faDollarSign:O,faArrowAltCircleLeft:U}}},computed:{isReportDisabled(){return!this.order||!this.order.code},paymentBtnDisabledMessage(){return l(this.order)?!0:this.isOrderPaid?"Pedido já pago":this.isOrderClosed?"Não é possível registrar pagamento em pedidos fechados.":this.order.price===null?"Pedido em pré-registro sem preço, impossível efetuar pagamentos.":!1}},methods:{isEmpty:l,onAddPaymentClick(){this.$emit("open-modal",{modal:"payment",payload:{isEdit:!1}})},onGenerateReportClick(){this.$emit("open-modal",{modal:"report"})},onOpenModal(r){this.$emit("open-modal",r)},onToggleSuccess(){this.$emit("toggle-success")}}};var he=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-flex row flex-column flex-sm-row justify-content-between"},[t("div",{staticClass:"col-sm-3 mb-2 mb-sm-0"},[t("AppButton",{attrs:{outlined:"","disabled-message":!e.order.client&&"O pedido não possui cliente"},on:{click:function(s){return e.$helpers.redirectTo(e.clients.show,{client:e.order.client})}}},[t("FontAwesomeIcon",{attrs:{icon:e.icons.faArrowAltCircleLeft}}),e._v(" Cliente ")],1)],1),t("div",{staticClass:"col d-flex flex-column flex-sm-row justify-content-between"},[t("div",{staticClass:"col col-sm-4 d-flex mb-2 mb-sm-0"},[t("AppButton",{staticClass:"flex-grow-1 flex-sm-grow-0",attrs:{color:"success",outlined:"",icon:e.icons.faDollarSign,"disabled-message":e.paymentBtnDisabledMessage},on:{click:e.onAddPaymentClick}},[e._v(" Adicionar pagamento ")])],1),t("div",{staticClass:"col col-sm-4 d-flex justify-content-end"},[t("AppButton",{staticClass:"me-1 flex-grow-1 flex-sm-grow-0",attrs:{icon:e.icons.faFileInvoice,disabled:e.isReportDisabled,loading:e.isReportLoading},on:{click:function(s){return s.preventDefault(),e.onGenerateReportClick.apply(null,arguments)}}},[e._v(" Gerar relatório ")]),t("AppButton",{attrs:{id:"dropdownOptions","data-bs-toggle":"dropdown",icon:e.icons.faEllipsisH,disabled:!e.order}}),t("TheOrderHeaderCogOptions",e._b({on:{"open-modal":e.onOpenModal,"toggle-success":e.onToggleSuccess}},"TheOrderHeaderCogOptions",{order:e.order,isLoading:e.isLoading,isOrderClosed:e.isOrderClosed,isOrderPreRegistered:e.isOrderPreRegistered,isOrderPaid:e.isOrderPaid},!1))],1)])])},ye=[],ge=a(ve,he,ye,!1,null,null,null,null);const Ce=ge.exports;var c={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"NoteParts"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Note"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"text"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created_at"},arguments:[],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CreateNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"order_id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"text"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"noteCreate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"order_id"},value:{kind:"Variable",name:{kind:"Name",value:"order_id"}}},{kind:"Argument",name:{kind:"Name",value:"text"},value:{kind:"Variable",name:{kind:"Name",value:"text"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NoteParts"},directives:[]},{kind:"Field",name:{kind:"Name",value:"order"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"client"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UpdateNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"text"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"noteUpdate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"text"},value:{kind:"Variable",name:{kind:"Name",value:"text"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NoteParts"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"noteDelete"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NoteParts"},directives:[]}]}}]}}],loc:{start:0,end:436}};c.loc.source={body:`fragment NoteParts on Note {
  id
  text
  created_at
}

mutation CreateNote ($order_id: ID! $text: String!) {
  noteCreate (order_id: $order_id text: $text) {
    ...NoteParts
    order {
      id

      client {
        id
      }
    }
  }
}

mutation UpdateNote ($id: ID! $text: String!) {
  noteUpdate (id: $id text: $text) {
    ...NoteParts
  }
}

mutation DeleteNote ($id: ID!) {
  noteDelete (id: $id) {
    ...NoteParts
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function m(r,e){if(r.kind==="FragmentSpread")e.add(r.name.value);else if(r.kind==="VariableDefinition"){var t=r.type;t.kind==="NamedType"&&e.add(t.name.value)}r.selectionSet&&r.selectionSet.selections.forEach(function(s){m(s,e)}),r.variableDefinitions&&r.variableDefinitions.forEach(function(s){m(s,e)}),r.definitions&&r.definitions.forEach(function(s){m(s,e)})}var C={};(function(){c.definitions.forEach(function(e){if(e.name){var t=new Set;m(e,t),C[e.name.value]=t}})})();function w(r,e){for(var t=0;t<r.definitions.length;t++){var s=r.definitions[t];if(s.name&&s.name.value==e)return s}}function v(r,e){var t={kind:r.kind,definitions:[w(r,e)]};r.hasOwnProperty("loc")&&(t.loc=r.loc);var s=C[e]||new Set,n=new Set,o=new Set;for(s.forEach(function(i){o.add(i)});o.size>0;){var T=o;o=new Set,T.forEach(function(i){if(!n.has(i)){n.add(i);var u=C[i]||new Set;u.forEach(function(F){o.add(F)})}})}return n.forEach(function(i){var u=w(r,i);u&&t.definitions.push(u)}),t}v(c,"NoteParts");const be=v(c,"CreateNote"),xe=v(c,"UpdateNote"),Oe=v(c,"DeleteNote"),ke={props:{note:{type:Object,default:()=>({})},isEdit:{type:Boolean,default:!1},orderId:{type:String,required:!0}},data(){return{isLoading:!1,icons:{faCheck:k,faTimes:P},form:new D({text:""})}},mounted(){this.$refs.input.focusInput(),this.isEdit&&(this.form.text=this.note.text)},methods:{async onSubmit(){this.isEdit?await this.onUpdate():await this.onCreate()},onCancel(){this.$emit("cancel")},async onCreate(){const{text:r}=this.form.data();this.isLoading=!0;try{await this.$apollo.mutate({mutation:be,variables:{order_id:this.orderId,text:r},refetchQueries:[b],awaitRefetchQueries:!0}),y(this,{message:"Anotação registrada!"})}catch(e){g(this,e)}this.isLoading=!1},async onUpdate(){const{id:r}=this.note,{text:e}=this.form.data();this.isLoading=!0;try{await this.$apollo.mutate({mutation:xe,variables:{id:r,text:e}}),y(this,{message:"Anotação atualizada!"})}catch(t){g(this,t)}this.isLoading=!1}}};var $e=function(){var e=this,t=e._self._c;return t("AppForm",{staticClass:"w-100",attrs:{form:e.form,"on-submit":e.onSubmit}},[t("div",{staticClass:"d-flex flex-column"},[t("div",{staticClass:"mb-2"},[t("AppTextarea",{ref:"input",attrs:{name:"text",placeholder:"Digite a anotação...","default-margin":!1,error:e.form.errors.get("text")},model:{value:e.form.text,callback:function(s){e.$set(e.form,"text",s)},expression:"form.text"}})],1),t("div",[t("AppButton",{attrs:{"btn-class":"btn-sm me-2 px-4",loading:e.isLoading,icon:e.icons.faCheck,color:"success"},on:{click:function(s){return s.preventDefault(),e.onSubmit.apply(null,arguments)}}}),t("AppButton",{attrs:{"btn-class":"btn-sm px-4",disabled:e.isLoading,type:"button",icon:e.icons.faTimes,color:"light"},on:{click:function(s){return s.preventDefault(),e.onCancel.apply(null,arguments)}}})],1)])])},Ne=[],we=a(ke,$e,Ne,!1,null,null,null,null);const Se=we.exports,Ae={props:{deleteNote:{type:Object,required:!0},note:{type:Object,required:!0}},data(){return{icons:{faTrashAlt:f,faEdit:_}}},methods:{onEditClick(){this.$emit("edit",this.note)},onDeleteClick(){this.$emit("delete",this.note)},onCancelDeleteClick(){this.$emit("cancel-delete")},onConfirmDeleteClick(){this.$emit("confirm-delete")}}};var Pe=function(){var e=this,t=e._self._c;return e.deleteNote.note.id===e.note.id?t("div",{staticClass:"d-flex"},[t("AppButton",{attrs:{"btn-class":"btn-sm fw-bold",color:"success",loading:e.deleteNote.isLoading},on:{click:function(s){return s.preventDefault(),e.onConfirmDeleteClick(e.note)}}},[e._v(" Confirmar ")]),t("AppButton",{staticClass:"ms-2",attrs:{"btn-class":"btn-sm",color:"light",disabled:e.deleteNote.isLoading},on:{click:function(s){return s.preventDefault(),e.onCancelDeleteClick(e.note)}}},[e._v(" Cancelar ")])],1):t("div",{staticClass:"d-flex"},[t("AppButton",{staticClass:"me-3",attrs:{tooltip:"Editar","btn-class":"btn-sm px-4",outlined:"",icon:e.icons.faEdit},on:{click:function(s){return s.preventDefault(),e.onEditClick(e.note)}}}),t("AppButton",{attrs:{color:"danger",tooltip:"Deletar","btn-class":"btn-sm px-4",outlined:"",icon:e.icons.faTrashAlt},on:{click:function(s){return s.preventDefault(),e.onDeleteClick(e.note)}}})],1)},De=[],Re=a(Ae,Pe,De,!1,null,null,null,null);const Ee=Re.exports,Te={components:{OrderNotesForm:Se,OrderNotesActionButtons:Ee},props:{orderId:{type:String,default:""},notes:{type:Array,default:()=>[]}},data(){return{newNote:{value:!1},editNote:{note:{}},deleteNote:{note:{},isLoading:!1},form:new D({text:""}),icons:{faStickyNote:Q}}},methods:{formatDatetime:d,async onDelete(){const{id:r}=this.deleteNote.note;this.deleteNote.isLoading=!0;try{await this.$apollo.mutate({mutation:Oe,variables:{id:r}}),this.$helpers.clearCacheFrom({id:r,__typename:"Note"}),this.$toast.success("Anotação deletada!")}catch{this.$toast.error("Ops! Algo deu errado, tente novamente!")}this.deleteNote.note={},this.deleteNote.isLoading=!1},onNewNoteClick(){this.form.reset(),this.editNote.note={},this.newNote.value=!this.newNote.value},onEditNote(r){this.form.reset(),this.newNote.value=!1,this.form.text=r.text,this.editNote.note=r},dismissNewNote(){this.newNote.value=!1},dismissEditNote(){this.editNote.note={}},onDeleteNote(r){this.deleteNote.note=r},onConfirmDelete(){this.onDelete()},onCancelDelete(){this.deleteNote.note={}}}};var Fe=function(){var e=this,t=e._self._c;return t("AppContainer",{scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faStickyNote}}),e._v(" Anotações "),t("span",{staticClass:"link-white clickable small ms-2",on:{click:function(s){return s.preventDefault(),e.onNewNoteClick.apply(null,arguments)}}},[e._v(" (+ NOVA NOTA) ")])]},proxy:!0},{key:"body",fn:function(){return[e.notes.length||e.newNote.value?t("ul",{staticClass:"list-group list-group-flush"},[e.newNote.value?t("li",{staticClass:"list-group-item d-flex align-items-center"},[t("OrderNotesForm",{attrs:{"order-id":e.orderId},on:{cancel:e.dismissNewNote,success:e.dismissNewNote}})],1):e._e(),e._l(e.notes,function(s){return t("li",{key:s.id,staticClass:"list-group-item text-subtitle"},[e.editNote.note.id===s.id?[t("OrderNotesForm",{attrs:{"is-edit":!0,"order-id":e.orderId,note:e.editNote.note},on:{cancel:e.dismissEditNote,success:e.dismissEditNote}})]:t("div",{staticClass:"d-flex flex-column"},[t("div",{staticClass:"d-flex justify-content-between mb-2"},[t("div",[e._v(" "+e._s(s.text)+" ")]),t("div",{staticClass:"text-secondary small"},[e._v(" "+e._s(e.formatDatetime(s.created_at,"dd/MM/y 'ás' HH:mm"))+" ")])]),t("OrderNotesActionButtons",e._b({on:{edit:e.onEditNote,delete:e.onDeleteNote,"cancel-delete":e.onCancelDelete,"confirm-delete":e.onConfirmDelete}},"OrderNotesActionButtons",{note:s,deleteNote:e.deleteNote},!1))],1)],2)})],2):t("div",{staticClass:"text-secondary text-center py-3"},[e._v(" Nenhuma anotação registrada ")])]},proxy:!0}])})},Ie=[],Le=a(Te,Fe,Ie,!1,null,null,null,null);const Be=Le.exports,Me={components:{PaymentForm:()=>$(()=>import("./PaymentForm-07141de2.js"),["assets/PaymentForm-07141de2.js","assets/index-4e05606f.js","assets/index-1259f392.css","assets/Via-eb0eedf9.js","assets/Payment-7f758fb7.js","assets/_PaginatorFragment-c01a3fe7.js","assets/SelectEntriesFind-d5313c57.js","assets/masks-168ccaff.js","assets/SelectClientsFind-5d32440f.js","assets/Resources-b591129f.js"])},props:{value:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},payment:{type:Object,default:()=>{}},order:{type:Object,default:()=>{}}},data(){return{formatCurrencyBRL:z,formatDatetime:d,icons:{faDollarSign:O}}},methods:{onSuccess(){this.$emit("success")}}};var qe=function(){var e=this,t=e._self._c;return t("AppModal",e._g({attrs:{id:"paymentModal",color:"success",value:e.value,centered:""},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faDollarSign,"fixed-width":""}}),e._v(" "+e._s(e.isEdit?"Alterar pagamento":"Novo pagamento")+" ")]},proxy:!0},{key:"body",fn:function(){return[e.payment?t("div",{staticClass:"text-center my-3"},[e._v(" Pagamento de "),t("b",[e._v(e._s(e.formatCurrencyBRL(e.payment.value)))]),e._v(" em "),t("b",[e._v(e._s(e.formatDatetime(e.payment.date)))])]):e._e(),e.value?t("PaymentForm",{attrs:{order:e.order,"is-edit":e.isEdit,payment:e.payment},on:{success:e.onSuccess}}):e._e()]},proxy:!0}])},e.$listeners))},Ve=[],je=a(Me,qe,Ve,!1,null,null,null,null);const R=je.exports,He={components:{PaymentExpenseStatus:ie},props:{payment:{type:Object,required:!0}},data(){return{roles:p,icons:{faEdit:_,faTrashAlt:f}}},computed:{isEditEnabled(){return!!(this.payment.is_confirmed===null||this.payment.is_confirmed===!0&&this.$helpers.canView(p.GERENCIA))}}};var Ge=function(){var e=this,t=e._self._c;return t("div",{staticClass:"d-flex flex-row align-items-center"},[t("PaymentExpenseStatus",{staticClass:"me-2",attrs:{entry:e.payment,"is-expense":!1}}),t("AppButton",{attrs:{disabled:!e.isEditEnabled,color:e.isEditEnabled?"primary":"secondary",tooltip:e.isEditEnabled?"Editar":"Não é possível editar",icon:e.icons.faEdit,"btn-class":"btn-sm px-3",outlined:""},on:{click:function(s){return s.preventDefault(),e.$emit("edit",e.payment)}}}),e.$helpers.canView(e.roles.GERENCIA)?t("AppButton",{attrs:{icon:e.icons.faTrashAlt,color:"danger",outlined:"",tooltip:"Excluir","btn-class":"btn-sm ms-1 px-3"},on:{click:function(s){return s.preventDefault(),e.$emit("delete",e.payment)}}}):e._e()],1)},Ue=[],Qe=a(He,Ge,Ue,!1,null,null,null,null);const ze=Qe.exports,Ke={null:"PENDENTE",false:"RECUSADO",true:"APROVADO"},Je={components:{ModalPaymentForm:R,OrderPaymentState:ze,PaymentConfirmErrorModal:le,PaymentExpenseDeleteModal:()=>$(()=>import("./PaymentExpenseDeleteModal-aad496aa.js"),["assets/PaymentExpenseDeleteModal-aad496aa.js","assets/index-4e05606f.js","assets/index-1259f392.css","assets/Payment-7f758fb7.js","assets/_PaginatorFragment-c01a3fe7.js","assets/Expense-8b8780bc.js","assets/Order-ebd7beca.js","assets/ActivityFragments-a3df58d3.js"])},props:{payments:{type:Array,default:()=>[]}},data(){return{roles:p,icons:{faEdit:_,faCheck:k,faTimes:P,faHandHoldingUsd:K,faExclamationCircle:J,faTruck:W},selectedPayment:{},loadingId:"",modalPaymentError:{value:!1,payment:{}},modalPaymentDelete:{value:!1,payment:{}}}},methods:{formatDatetime:d,getPaymentState(r){return Ke[r.is_confirmed]},onEditPayment(r){this.$emit("open-modal",{modal:"payment",payload:{payment:r,isEdit:!0}})},onDeletePayment(r){this.modalPaymentDelete.payment=r,this.modalPaymentDelete.value=!0},onDeletePaymentSuccess(){this.modalPaymentDelete.value=!1,this.modalPaymentDelete.payment={}},onPaymentError(r){this.modalPaymentError.payment=r,this.modalPaymentError.value=!0},onPaymentModalErrorHidden(){this.modalPaymentError.value=!1,this.modalPaymentError.payment={}},getListGroupClass(r){return{"list-group-item-success":r.is_confirmed===!0,"list-group-item-danger":r.is_confirmed===!1,"list-group-item-warning":r.is_confirmed===null}}}};var We=function(){var e=this,t=e._self._c;return t("AppContainer",{scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faHandHoldingUsd}}),e._v(" Pagamentos ")]},proxy:!0},{key:"body",fn:function(){return[e.payments.length?t("div",[t("ModalPaymentForm",{attrs:{"modal-id":"editPaymentModal","is-edit":!0,payment:e.selectedPayment},on:{refresh:function(s){return e.$emit("refresh")}}}),e.$helpers.canView(e.roles.GERENCIA)?t("PaymentExpenseDeleteModal",{attrs:{entry:e.modalPaymentDelete.payment,"is-expense":!1},on:{success:e.onDeletePaymentSuccess},model:{value:e.modalPaymentDelete.value,callback:function(s){e.$set(e.modalPaymentDelete,"value",s)},expression:"modalPaymentDelete.value"}}):e._e(),t("PaymentConfirmErrorModal",{attrs:{value:e.modalPaymentError.value,payment:e.modalPaymentError.payment},on:{hidden:e.onPaymentModalErrorHidden}}),t("ul",{staticClass:"list-group list-group-flush"},e._l(e.payments,function(s){return t("li",{key:s.id,staticClass:"list-group-item text-subtitle",class:e.getListGroupClass(s)},[t("div",{staticClass:"d-flex flex-column flex-sm-row justify-content-between align-items-sm-center"},[t("div",{staticClass:"mb-3 mb-sm-0"},[t("div",[t("b",[e._v(e._s(e.$helpers.toBRL(s.value)))]),s.date?[e._v(" em "),t("b",[e._v(e._s(e.formatDatetime(s.date)))])]:e._e(),e._v(" via "),t("b",[e._v(e._s(e.$helpers.fallback(s.via,"name")))]),s.is_confirmed?e._e():t("span",{staticClass:"fw-bold"},[e._v(" - ["+e._s(e.getPaymentState(s))+"] ")]),s.is_shipping?t("small",[e._v(" • "),t("FontAwesomeIcon",{staticClass:"small",attrs:{icon:e.icons.faTruck}})],1):e._e()],2),s.is_sponsor?t("div",{staticClass:"small text-secondary"},[t("b",[e._v("PATROCINADOR:")]),e._v(" "),t("a",{staticClass:"fw-bold text-decoration-none",attrs:{href:e.$helpers.getUrl("clients.show",{client:s.sponsorship_client.id}),target:"blank"}},[e._v(e._s(s.sponsorship_client.name))])]):e._e(),s.note?t("div",{staticClass:"small text-secondary"},[t("strong",[e._v("NOTA:")]),e._v(" "+e._s(s.note)+" ")]):e._e(),s.clientBalances.length?t("div",{staticClass:"small text-secondary"},[t("b",[e._v("SALDO:")]),e._l(s.clientBalances,function(n){return t("span",{key:n.id,staticClass:"me-1"},[e._v(" "+e._s(e.$helpers.toBRL(n.value,!1,n.value>0))+" ")])}),s.is_sponsor?t("FontAwesomeIcon",{directives:[{name:"tippy",rawName:"v-tippy"}],attrs:{icon:e.icons.faExclamationCircle,content:"Saldo contabilizado para o patrocinador"}}):e._e()],2):e._e(),s.is_bonus?t("div",[t("div",{staticClass:"small text-secondary"},[e._v(" Bônus do cliente utilizado ")])]):e._e()]),t("div",{staticClass:"d-flex"},[t("OrderPaymentState",{attrs:{payment:s},on:{error:e.onPaymentError,edit:e.onEditPayment,delete:e.onDeletePayment}})],1)])])}),0)],1):t("div",{staticClass:"text-secondary text-center py-3"},[e._v(" Nenhum pagamento registrado ")])]},proxy:!0}])})},Xe=[],Ye=a(Je,We,Xe,!1,null,null,null,null);const Ze=Ye.exports,et={props:{order:{type:Object,required:!0},filesMap:{type:Object,required:!0}},methods:{isEmpty:l}};var tt=function(){var e=this,t=e._self._c;return t("div",[e._l(e.filesMap,function(s,n){return[t("div",{key:`order_label_${e.filesMap[n]}`,staticClass:"text-subtitle fw-bold text-secondary mb-1"},[e._v(" "+e._s(s)+" ")]),e.isEmpty(e.order[n])?t("div",{key:`order_files_empty_${e.filesMap[n]}`},[t("div",{staticClass:"text-center text-secondary py-5"},[e._v(" Nenhum anexo registrado ")])]):t("AppViewerItems",{key:`order_files_${e.filesMap[n]}`,staticClass:"mb-3",attrs:{alt:s,files:e.order[n]}})]})],2)},st=[],rt=a(et,tt,st,!1,null,null,null,null);const at=rt.exports,S={art_paths:"Imagens da arte",size_paths:"Imagens do tamanho",payment_voucher_paths:"Comprovantes de pagamento"},nt={components:{OrderFilesItems:at},props:{order:{type:Object,required:!0}},data(){return{FILES_MAP:S,icons:{faFileImage:X}}},computed:{filesCount(){return Y(S).reduce((e,t)=>(l(this.order[t])?0:this.order[t].length)+e,0)}}};var ot=function(){var e=this,t=e._self._c;return t("AppContainer",{attrs:{id:"files","header-class":"text-secondary",collapsible:"",value:!e.filesCount},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faFileImage,"fixed-width":""}}),t("span",{staticClass:"me-2"},[e._v("Anexos")]),e.filesCount?t("small",{staticClass:"badge rounded-pill bg-light text-dark"},[e._v(e._s(e.filesCount))]):e._e()]},proxy:!0},{key:"body",fn:function(){return[e.filesCount?t("div",[t("OrderFilesItems",{attrs:{order:e.order,"files-map":e.FILES_MAP}})],1):t("div",[t("div",{staticClass:"text-center text-secondary py-3"},[e._v(" Nenhum anexo registrado ")])])]},proxy:!0}])})},it=[],lt=a(nt,ot,it,!1,null,null,null,null);const dt=lt.exports,ct={props:{status:{type:Object,required:!0}},computed:{getIcon(){return this.status.pivot.is_confirmed?k:Z}},methods:{formatDatetime:d}};var ut=function(){var e=this,t=e._self._c;return t("li",{staticClass:"list-group-item d-flex justify-content-between"},[t("div",{class:{"text-success":e.status.pivot.is_confirmed,"text-secondary":!e.status.pivot.is_confirmed}},[t("div",{class:{"fw-bold":e.status.pivot.is_confirmed}},[t("FontAwesomeIcon",{attrs:{icon:e.getIcon,"fixed-width":""}}),e._v(" "+e._s(e.status.text)+" ")],1),e.status.pivot.is_confirmed&&e.status.pivot.user?t("div",{staticClass:"small text-secondary"},[e._v(" "+e._s(e.status.pivot.user.name)+" ")]):e.status.pivot.is_confirmed&&!e.status.pivot.user?t("div",{staticClass:"small text-secondary"},[e._v(" [Concluído pelo sistema] ")]):e._e()]),e.status.pivot.confirmed_at?t("div",{staticClass:"text-secondary small position-relative",class:{"text-decoration-line-through":!e.status.pivot.is_confirmed}},[e.status.pivot.is_confirmed?e._e():t("span",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"position-absolute",staticStyle:{"z-index":"100",left:"0",top:"0",right:"0",bottom:"0"},attrs:{content:"Pedido possivelmente cancelado pelo sistema, devido a alterações nos status gerais, mas sua data de confirmação foi mantida."}}),e._v(" "+e._s(e.formatDatetime(e.status.pivot.confirmed_at,"dd/MM/yy HH:mm:ss"))+" ")]):e._e()])},mt=[],pt=a(ct,ut,mt,!1,null,null,null,null);const _t=pt.exports,ft={components:{OrderStatusProgressItem:_t},props:{order:{type:Object,required:!0}},data(){return{icons:{faTasks:ee}}},computed:{status(){return this.order.closed_at?JSON.parse(this.order.final_status):this.order.linked_status}}};var vt=function(){var e=this,t=e._self._c;return t("AppContainer",{attrs:{collapsible:""},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faTasks,"fixed-width":""}}),e._v(" Controle de Pedido ")]},proxy:!0},{key:"body",fn:function(){return[t("ul",{staticClass:"list-group list-group-flush"},[e.order.closed_at?e._l(e.status,function(s){return t("OrderStatusProgressItem",{key:s.id,attrs:{status:s}})}):e._l(e.status,function(s){return t("OrderStatusProgressItem",{key:s.id,attrs:{status:s}})})],2)]},proxy:!0}])})},ht=[],yt=a(ft,vt,ht,!1,null,null,null,null);const gt=yt.exports,Ct={apollo:{ordersActivities:{query:L,variables(){return{id:this.order.id}},skip(){return!this.value},fetchPolicy:"network-only"}},components:{ActivityItem:de},props:{order:{type:Object,required:!0}},data(){return{ordersActivities:[],value:!1,icons:{faListAlt:te}}},computed:{isQueryLoading(){return!!this.$apollo.queries.ordersActivities.loading}}};var bt=function(){var e=this,t=e._self._c;return t("AppContainer",{attrs:{collapsible:""},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faListAlt,"fixed-width":""}}),e._v(" Atividades ")]},proxy:!0},{key:"body",fn:function(){return[t("AppLoading",{directives:[{name:"show",rawName:"v-show",value:e.isQueryLoading,expression:"isQueryLoading"}]}),e.ordersActivities.length?t("div",[e._l(e.ordersActivities,function(s){return[t("ActivityItem",{key:s.id,attrs:{item:s}})]})],2):t("div",{staticClass:"text-center text-secondary small my-4"},[e._v(" Nenhuma atividade encontrada ")])]},proxy:!0}]),model:{value:e.value,callback:function(s){e.value=s},expression:"value"}})},xt=[],Ot=a(Ct,bt,xt,!1,null,null,null,null);const kt=Ot.exports,$t={props:{order:{type:Object,required:!0}},data:()=>({icons:{faFileAlt:se}}),methods:{formatDatetime:d}};var Nt=function(){var e=this,t=e._self._c;return t("AppContainer",{scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faFileAlt,"fixed-width":""}}),e._v(" Detalhes do Pedido ")]},proxy:!0},{key:"body",fn:function(){return[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-sm mb-3 mb-sm-0"},[t("div",{staticClass:"fw-bold small text-secondary"},[e._v(" Nome ")]),t("b",{staticClass:"text-subtitle"},[e._v(" "+e._s(e.$helpers.fallback(e.order.name))+" ")])]),t("div",{staticClass:"col text-right text-sm-center"},[t("div",{staticClass:"fw-bold small text-secondary"},[e._v(" Código ")]),t("b",{staticClass:"text-subtitle"},[e._v(" "+e._s(e.$helpers.fallback(e.order.code))+" ")])]),t("div",{staticClass:"col text-start text-sm-end"},[t("div",{staticClass:"fw-bold small text-secondary"},[e._v(" Registrado em ")]),t("b",{staticClass:"text-subtitle"},[e._v(" "+e._s(e.formatDatetime(e.order.created_at))+" ")])])]),t("div",{staticClass:"d-flex justify-content-between mt-3"},[t("div",[t("b",{staticClass:"small text-secondary"},[e._v("Status")]),t("h6",{staticClass:"fw-bold",class:e.order.status.is_available?"text-success":"text-warning"},[e._v(" "+e._s(e.order.status.text)+" ")])]),t("div",[t("b",{staticClass:"small text-secondary"},[e._v("Quantidade")]),t("h5",{staticClass:"fw-bold text-center"},[e._v(" "+e._s(e.$helpers.fallback(e.order.quantity))+" ")])])]),t("div",{staticClass:"mt-3 d-flex flex-column flex-sm-row justify-content-between"},[e.order.print_date?t("div",[t("b",{staticClass:"small text-secondary"},[e._v("Data de estampa")]),t("div",[e._v(" "+e._s(e.$helpers.fallback(e.formatDatetime(e.order.print_date)))+" ")])]):e._e(),e.order.seam_date?t("div",[t("b",{staticClass:"small text-secondary"},[e._v("Data de costura")]),t("div",[e._v(" "+e._s(e.$helpers.fallback(e.formatDatetime(e.order.seam_date)))+" ")])]):e._e(),t("div",[t("b",{staticClass:"small text-secondary"},[e._v("Data de entrega")]),t("div",[e._v(" "+e._s(e.$helpers.fallback(e.formatDatetime(e.order.delivery_date)))+" ")])])])]},proxy:!0}])})},wt=[],St=a($t,Nt,wt,!1,null,null,null,null);const At=St.exports,E=r=>["model","material","neck_type","sleeve_type"].map(s=>{var n;return((n=r.match[s])==null?void 0:n.name)||null}).filter(s=>!!s),Pt={props:{hasIndividualItems:{type:Boolean,required:!0},garments:{type:Array,required:!0}},methods:{filledNames:E}};var Dt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"table-responsive-sm"},[t("table",{staticClass:"table"},[t("thead",[t("tr",[e.hasIndividualItems?t("th",[e._v(" Item ")]):e._e(),t("th",[e._v(" Roupa ")]),t("th",[e._v("Tamanhos")]),t("th",{staticClass:"text-center"},[e._v(" Valor ")])])]),t("tbody",e._l(e.garments,function(s,n){return t("tr",{key:s.id},[e.hasIndividualItems?t("td",{staticClass:"align-middle text-center"},[t("span",{staticClass:"fw-bold text-primary"},[e._v(" "+e._s(n+1)+" ")])]):e._e(),t("td",[t("ul",{staticClass:"list-group list-group-sm"},e._l(e.filledNames(s),function(o){return t("li",{key:o,staticClass:"list-group-item small"},[e._v(" "+e._s(o)+" ")])}),0)]),t("td",[t("ul",{staticClass:"list-group list-group-sm"},e._l(s.sizes,function(o){return t("li",{key:o.pivot.id,staticClass:"list-group-item text-nowrap"},[t("b",[e._v(e._s(o.name))]),o.pivot.value?[e._v(" ("+e._s(e.$helpers.toBRL(o.pivot.value))+"): ")]:e._e(),e._v(": "),t("b",[e._v(e._s(o.pivot.quantity))]),e._v(" peças ")],2)}),0),s.sizes_value?t("div",{staticClass:"small mt-1 text-nowrap"},[e._v(" Total: "),t("b",[e._v(e._s(e.$helpers.toBRL(s.sizes_value,!1,!0)))])]):e._e()]),t("td",{staticClass:"align-middle text-center text-nowrap"},[t("h6",{domProps:{innerHTML:e._s(e.$helpers.toBRL(s.value,!0))}}),t("div",{staticClass:"small text-secondary"},[e._v(" "+e._s(e.$helpers.toBRL(s.value_per_unit))+" x "+e._s(s.quantity)+" pçs ")])])])}),0)])])},Rt=[],Et=a(Pt,Dt,Rt,!1,null,null,null,null);const Tt=Et.exports,Ft={props:{garments:{type:Array,required:!0}},methods:{filledNames:E,isEmpty:l}};var It=function(){var e=this,t=e._self._c;return t("tbody",[e._l(e.garments,function(s,n){return[e.isEmpty(s.individual_names)?e._e():[t("tr",{key:`garment__${s.id}`,staticClass:"table-secondary"},[t("td",{staticClass:"fw-bold text-center small",attrs:{colspan:"3"}},[t("span",{staticClass:"me-1 text-primary"},[e._v("["+e._s(n+1)+"] ")]),e._v(" "+e._s(e.filledNames(s).join(" - "))+" ")])]),e._l(s.individual_names,function(o){return t("tr",{key:`garmentName__${s.id}__${o.id}`},[t("td",[e._v(e._s(o.name||"N/A"))]),t("td",[e._v(e._s(o.size||"N/A"))]),t("td",[e._v(e._s(o.number||"N/A"))])])})]]})],2)},Lt=[],Bt=a(Ft,It,Lt,!1,null,null,null,null);const Mt=Bt.exports,qt={components:{OrderBodyIndividualNamesTBody:Mt},props:{order:{type:Object,required:!0}},data:()=>({icons:{faSpellCheck:re}}),computed:{garmentsWithNames(){return this.order.garments.filter(r=>r.individual_names)}}};var Vt=function(){var e=this,t=e._self._c;return t("AppContainer",{attrs:{collapsible:""},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faSpellCheck,"fixed-width":""}}),e._v(" Nomes nas roupas ")]},proxy:!0},{key:"body",fn:function(){return[t("table",{staticClass:"table table-bordered table-sm"},[t("thead",[t("tr",{staticClass:"table-primary"},[t("th",[e._v("Nome")]),t("th",[e._v("Tamanho")]),t("th",[e._v("Número")])])]),t("OrderBodyIndividualNamesTBody",{attrs:{garments:e.order.garments}})],1)]},proxy:!0}])})},jt=[],Ht=a(qt,Vt,jt,!1,null,null,null,null);const Gt=Ht.exports,Ut=()=>$(()=>import("./OrderClothingTypes-7ccd3c07.js"),["assets/OrderClothingTypes-7ccd3c07.js","assets/index-4e05606f.js","assets/index-1259f392.css"]),Qt={components:{OrderClothingTypes:Ut,OrderGarments:Tt,OrderBodyIndividualNames:Gt},props:{order:{type:Object,required:!0}},data:()=>({icons:{faTshirt:ae}}),computed:{shouldShowClothingTypes(){return!this.order.quantity||this.order.clothing_types.length}}};var zt=function(){var e=this,t=e._self._c;return t("AppContainer",{staticClass:"mt-3",scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faTshirt,"fixed-width":""}}),e._v(" Roupas ")]},proxy:!0},{key:"body",fn:function(){return[t("div",[e.shouldShowClothingTypes?t("OrderClothingTypes",{staticClass:"mt-3",attrs:{order:e.order}}):t("OrderGarments",{staticClass:"mt-3",attrs:{garments:e.order.garments,"has-individual-items":e.order.has_individual_names}})],1),e.order.has_individual_names?t("div",[t("OrderBodyIndividualNames",{attrs:{order:e.order}})],1):e._e()]},proxy:!0}])})},Kt=[],Jt=a(Qt,zt,Kt,!1,null,null,null,null);const Wt=Jt.exports,Xt={props:{color:{type:String,default:"primary"},label:{type:String,default:""},text:{type:String,default:""},subitems:{type:Array,default:()=>[]}},computed:{computedSubitems(){return this.subitems.filter(r=>r.is_shown!==!1)}}};var Yt=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("b",{staticClass:"small text-secondary"},[e._v(e._s(e.label))])]),t("h5",{staticClass:"mb-0",class:`text-${e.color}`,domProps:{innerHTML:e._s(e.text)}}),e._l(e.computedSubitems,function(s){return t("div",{key:s.label,staticClass:"small",class:s.class??"text-secondary"},[e._v(" "+e._s(s.label)+": "),t("b",[e._v(e._s(s.text))])])})],2)},Zt=[],es=a(Xt,Yt,Zt,!1,null,null,null,null);const ts=es.exports,ss={components:{OrderBodyTotalValueItem:ts},props:{order:{type:Object,required:!0}},data:()=>({icons:{faDollarSign:O}}),computed:{totalValue(){return this.$helpers.toBRL(this.order.price,!0)},totalGarments(){return this.order.original_price-(this.order.shipping_value||0)},showTotalClothes(){return this.order.discount||this.order.shipping_value},totalValueSubItems(){const r=this.totalGarments,e=this.order.shipping_value,t=this.order.discount;return[{label:"TOTAL ROUPAS: ",text:this.$helpers.toBRL(r),is_shown:!!this.showTotalClothes,class:"text-primary"},{label:"FRETE: ",text:this.$helpers.toBRL(e,!1,!0),is_shown:!!e},{label:"DESCONTO: ",text:this.$helpers.toBRL(-t),is_shown:!!t}]},totalPaidSubItems(){return[{label:"PATROCÍNIO",text:this.$helpers.toBRL(this.order.total_paid_sponsor),is_shown:this.order.has_sponsor},{label:"CLIENTE",text:this.$helpers.toBRL(this.order.total_paid_non_sponsor),is_shown:this.order.has_sponsor}]}}};var rs=function(){var e=this,t=e._self._c;return e.order.price!==null?t("AppContainer",{staticClass:"mt-3",scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faDollarSign,"fixed-width":""}}),e._v(" Valor total ")]},proxy:!0},{key:"body",fn:function(){return[t("div",{staticClass:"my-3 d-flex flex-column flex-sm-row justify-content-around"},[t("OrderBodyTotalValueItem",{attrs:{label:"Valor total",text:e.totalValue,subitems:e.totalValueSubItems}}),t("OrderBodyTotalValueItem",{attrs:{label:"Total pago",text:e.$helpers.toBRL(e.order.total_paid,!0),color:"success",subitems:e.totalPaidSubItems}}),t("OrderBodyTotalValueItem",{attrs:{label:"Falta pagar",text:e.$helpers.toBRL(e.order.total_owing,!0),color:e.order.total_owing<=0?"success":"danger"}})],1)]},proxy:!0}],null,!1,2464419279)}):e._e()},as=[],ns=a(ss,rs,as,!1,null,null,null,null);const os=ns.exports,is={components:{OrderNotes:Be,OrderPayments:Ze,OrderFiles:dt,OrderReminder:oe,OrderStatusProgress:gt,OrderActivities:kt,OrderBodyDetails:At,OrderBodyClothes:Wt,OrderBodyTotalValue:os},props:{order:{type:Object,required:!0},isOrderPreRegistered:{type:Boolean,required:!0}},data(){return{roles:p}},computed:{showReminder(){return this.isOrderPreRegistered&&this.order.reminder}},methods:{formatDatetime:d}};var ls=function(){var e=this,t=e._self._c;return t("div",[e.showReminder?t("OrderReminder",[e._v(" "+e._s(e.order.reminder)+" ")]):e._e(),t("OrderBodyDetails",{attrs:{order:e.order}}),t("OrderBodyClothes",{attrs:{order:e.order}}),t("OrderBodyTotalValue",{attrs:{order:e.order}}),e.order.has_order_control?t("OrderStatusProgress",{staticClass:"mt-3",attrs:{order:e.order}}):e._e(),t("OrderNotes",{staticClass:"mt-3",attrs:{"order-id":e.order.id,notes:e.order.notes}}),t("OrderPayments",{staticClass:"mt-3",attrs:{payments:e.order.payments},on:{"open-modal":function(s){return e.$emit("open-modal",s)}}}),t("OrderFiles",{staticClass:"mt-3",attrs:{order:e.order}}),e.$helpers.canView(e.roles.GERENCIA)?t("OrderActivities",{staticClass:"mt-3",attrs:{order:e.order}}):e._e()],1)},ds=[],cs=a(is,ls,ds,!1,null,null,null,null);const us=cs.exports,ms={props:{order:{type:Object,default:()=>({})},isOrderClosed:{type:Boolean,required:!0}},data(){return{icons:{faBoxOpen:x}}},methods:{formatDatetime:d}};var ps=function(){var e=this,t=e._self._c;return e.order?t("div",{staticClass:"d-flex flex-column flex-sm-row justify-content-between fw-bold align-items-sm-center mb-0"},[t("div",[t("FontAwesomeIcon",{staticClass:"me-1",attrs:{icon:e.icons.faBoxOpen}}),e._v(" Pedido - "+e._s(e.$helpers.fallback(e.order.name,null,"[SEM NOME]"))+" ")],1),e.isOrderClosed?t("div",[e._v(" FECHADO "),t("span",{staticClass:"d-inline d-sm-none"},[e._v("-")]),t("span",{staticClass:"small d-inline d-sm-block"},[e._v(" Em "+e._s(e.formatDatetime(e.order.closed_at))+" ")])]):e._e()]):e._e()},_s=[],fs=a(ms,ps,_s,!1,null,null,null,null);const vs=fs.exports,hs={data(){return{icons:{faBoxOpen:x}}}};var ys=function(){var e=this,t=e._self._c;return t("AppCard",{scopedSlots:e._u([{key:"header",fn:function(){return[t("h6",{staticClass:"fw-bold mb-0"},[t("FontAwesomeIcon",{staticClass:"me-1",attrs:{icon:e.icons.faBoxOpen}}),e._v("Pedido - ")],1)]},proxy:!0},{key:"body",fn:function(){return[t("div",{staticClass:"py-5"},[t("AppLoading")],1)]},proxy:!0}])})},gs=[],Cs=a(hs,ys,gs,!1,null,null,null,null);const bs=Cs.exports,xs={components:{TheOrderCardBody:us,TheOrderCardHeader:vs,TheOrderCardPlaceholder:bs},props:{isLoading:{type:Boolean,default:!1},order:{type:Object,default:null},isOrderClosed:{type:Boolean,default:!1},isOrderPreRegistered:{type:Boolean,default:!1}},computed:{cardColor(){return this.order.states.includes("CLOSED")?"secondary":this.order.states.includes("PRE-REGISTERED")?"warning":"primary"}},methods:{onOpenModalRequest(r){this.$emit("on-open-modal",r)}}};var Os=function(){var e=this,t=e._self._c;return e.isLoading?t("TheOrderCardPlaceholder"):t("AppCard",{attrs:{color:e.cardColor},scopedSlots:e._u([{key:"header",fn:function(){return[t("TheOrderCardHeader",e._b({},"TheOrderCardHeader",{order:e.order,isOrderClosed:e.isOrderClosed},!1))]},proxy:!0},{key:"body",fn:function(){return[t("TheOrderCardBody",e._b({on:{"open-modal":e.onOpenModalRequest}},"TheOrderCardBody",{order:e.order,isOrderPreRegistered:e.isOrderPreRegistered},!1))]},proxy:!0}],null,!1,2889264065)})},ks=[],$s=a(xs,Os,ks,!1,null,null,null,null);const Ns=$s.exports,ws={props:{status:{type:Object,required:!0}}};var Ss=function(){var e=this,t=e._self._c;return t("div",{staticClass:"text-center mb-3"},[t("div",{staticClass:"text-secondary small"},[e._v(" STATUS ATUAL ")]),t("h5",{staticClass:"fw-bold",class:e.status.avaliable?"text-success":"text-warning"},[e._v(" "+e._s(e.status.text)+" ")])])},As=[],Ps=a(ws,Ss,As,!1,null,null,null,null);const Ds=Ps.exports,Rs={props:{value:{type:[Number,String],required:!0},status:{type:Array,required:!0}},methods:{onInputChange(r){this.$emit("input",r)},labelClass(r){return r.pivot.is_confirmed?"text-success fw-bold":""}}};var Es=function(){var e=this,t=e._self._c;return t("div",[t("AppRadio",{attrs:{align:"vertical",value:e.value,name:"order-status",options:e.status,"label-prop":(s,n)=>`${n+1}. ${s.text}`,"value-prop":"id","label-class":e.labelClass},on:{input:e.onInputChange}})],1)},Ts=[],Fs=a(Rs,Es,Ts,!1,null,null,null,null);const Is=Fs.exports,Ls={components:{ModalOrderStatusHeader:Ds,ModalOrderStatusOptions:Is,ModalOrderStatusOverrideDates:ce},props:{order:{type:Object,default:()=>({})},value:{type:Boolean,default:!1}},data(){return{icons:{faExchangeAlt:A},isLoading:!1,selectedStatus:this.order.status.id,overrideOption:null,overrideStatus:[]}},computed:{status(){return this.order.linked_status},hasOverrideDates(){return!!this.overrideStatus.length}},methods:{onOptionChange(){const r=this.status.find(t=>t.id===this.selectedStatus),e=this.order.status;if(r.order>e.order){const t=this.$helpers.getStatusBetween(e,r,this.status);if(t.some(s=>s.pivot.confirmed_at)){this.overrideStatus=t,this.overrideOption="UPDATE";return}}this.overrideStatus=[]},async updateStatus(){this.isLoading=!0;try{await this.$apollo.mutate({mutation:B,variables:{id:this.order.id,status_id:this.selectedStatus,override_option:this.overrideOption},refetchQueries:[b],awaitRefetchQueries:!0}),y(this,{message:"Status alterado!"})}catch(r){g(this,r)}this.isLoading=!1}}};var Bs=function(){var e=this,t=e._self._c;return t("AppModal",e._g({attrs:{id:"orderStatusModal",color:"success",centered:"",value:e.value},scopedSlots:e._u([{key:"title",fn:function(){return[t("FontAwesomeIcon",{attrs:{icon:e.icons.faExchangeAlt,"fixed-width":""}}),e._v(" Alterar status do pedido ")]},proxy:!0},{key:"body",fn:function(){return[t("div",{staticClass:"mb-4"},[t("ModalOrderStatusHeader",{attrs:{status:e.order.status}}),t("ModalOrderStatusOptions",{attrs:{status:e.order.linked_status},on:{input:e.onOptionChange},model:{value:e.selectedStatus,callback:function(s){e.selectedStatus=s},expression:"selectedStatus"}})],1),e.hasOverrideDates?t("div",[t("ModalOrderStatusOverrideDates",{attrs:{status:e.overrideStatus},model:{value:e.overrideOption,callback:function(s){e.overrideOption=s},expression:"overrideOption"}})],1):e._e(),t("div",{staticClass:"row mt-3"},[t("div",{staticClass:"col"},[t("AppButton",{staticClass:"fw-bold",attrs:{loading:e.isLoading,color:"success",block:""},on:{click:function(s){return s.preventDefault(),e.updateStatus.apply(null,arguments)}}},[e._v(" Salvar ")])],1),t("div",{staticClass:"col"},[t("AppButton",{attrs:{type:"button",block:"",color:"light","data-bs-dismiss":"modal"}},[e._v(" Fechar ")])],1)])]},proxy:!0}])},e.$listeners))},Ms=[],qs=a(Ls,Bs,Ms,!1,null,null,null,null);const Vs=qs.exports,js={props:{value:{type:Boolean,default:!1},order:{type:Object,default:()=>{}}},data(){return{orderCode:"",icons:{faTrashAlt:f},isLoading:!1}},computed:{isPreConfirmed(){return this.order.code?this.orderCode===this.order.code:!0},clientKey(){return this.$route.params.clientKey},orderKey(){return this.$route.params.orderKey}},methods:{async delete(){await this.$apollo.mutate({mutation:M,variables:{id:this.order.id}}),this.$helpers.clearCacheFrom({id:this.order.id,__typename:"Order"}),this.$emit("success")},deleteOrder(){if(this.isLoading=!0,!this.isPreConfirmed){this.isLoading=!1,this.$toast.error("Confirme o código do pedido primeiramente.");return}this.delete()}}};var Hs=function(){var e=this,t=e._self._c;return t("AppModal",e._g({attrs:{id:"orderDeleteModal",color:"danger",centered:"",value:e.value},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" Deletar pedido - "+e._s(e.order.code)+" ")]},proxy:!0},{key:"body",fn:function(){return[t("div",[t("div",{staticClass:"text-center"},[t("FontAwesomeIcon",{staticClass:"text-danger",attrs:{icon:e.icons.faTrashAlt,size:"4x"}}),t("h5",{staticClass:"fw-bold mt-3"},[e._v(" Você tem certeza? ")]),t("div",[e._v("Isso deleterá todos os pagamentos, anexos e anotações do pedido.")])],1),e.order.code?t("div",{staticClass:"mt-3"},[t("AppInput",{attrs:{id:"code",name:"code",placeholder:"Digite o código do pedido..."},model:{value:e.orderCode,callback:function(s){e.orderCode=s},expression:"orderCode"}},[e._v(" Confirme o código do pedido ("+e._s(e.order.code)+"): ")])],1):e._e(),t("div",{staticClass:"row mt-5"},[t("div",{staticClass:"col"},[t("AppButton",{staticClass:"fw-bold",attrs:{color:"success",disabled:!e.isPreConfirmed,loading:e.isLoading,block:""},on:{click:e.deleteOrder}},[e._v(" CONFIRMAR ")])],1),t("div",{staticClass:"col"},[t("AppButton",{attrs:{"data-bs-dismiss":"modal",color:"light",block:""}},[e._v(" Cancelar ")])],1)])])]},proxy:!0}])},e.$listeners))},Gs=[],Us=a(js,Hs,Gs,!1,null,null,null,null);const Qs=Us.exports,zs={metaInfo(){if(l(this.order))return{title:"Carregando..."};if(this.isOrderPreRegistered)return{title:"PRE-REGISTRO"};if(this.order)return{title:this.order.code}},components:{ClientCard:ne,TheOrderCard:Ns,TheOrderHeader:Ce,ModalPaymentForm:R,ModalOrderStatus:Vs,ModalOrderDelete:Qs},mixins:[V],apollo:{order:{query:b,fetchPolicy:"no-cache",variables(){const{clientKey:r,orderKey:e}=this.$route.params;return{id:e,client_id:r}},result({data:{order:r}}){r||this.$store.commit("SET_ERROR",404)}}},data(){return{order:{},modalOrderPayment:{payment:null,value:!1,isEdit:!1},modalOrderStatus:{value:!1},modalOrderDelete:{value:!1},modalOrderReport:{value:!1,src:"",loading:!1}}},computed:{isLoading(){return l(this.order)}},methods:{refreshOrder(){this.$apollo.queries.order.refetch()},openModal(r){this[r].value=!0},closeModal(r){this[r].value=!1},onModalPaymentHidden(){this.modalOrderPayment.payment=null},async openModalReport(){this.modalOrderReport.loading=!0;const{data:r}=await this.$apollo.query({query:q,variables:{id:this.order.id},fetchPolicy:"network-only"});this.modalOrderReport.loading=!1,this.modalOrderReport.src=r.orderReport,this.openModal("modalOrderReport")},onCloseModalReport(){this.modalOrderReport.src=""},openModalOrderPayment({payment:r,isEdit:e}){this.modalOrderPayment.isEdit=e,this.modalOrderPayment.payment=r||null,this.modalOrderPayment.value=!0},onPaymentCreated(){this.closeModal("modalOrderPayment"),this.refreshOrder()},onStatusUpdated(){this.closeModal("modalOrderStatus")},onOrderDeleted(){this.closeModal("modalOrderDelete"),this.$nextTick(()=>{if(!this.order.client){this.$helpers.redirectTo(h.index);return}this.$helpers.redirectTo(h.show,{client:this.order.client})})},onOpenModal({modal:r,payload:e}){r==="payment"&&this.openModalOrderPayment(e),r==="delete-order"&&this.openModal("modalOrderDelete"),r==="change-status"&&this.openModal("modalOrderStatus"),r==="report"&&this.openModalReport()}}};var Ks=function(){var e=this,t=e._self._c;return t("div",{staticClass:"py-5 mx-auto"},[e.isLoading?e._e():t("ModalPaymentForm",e._b({on:{success:e.onPaymentCreated,hidden:e.onModalPaymentHidden},model:{value:e.modalOrderPayment.value,callback:function(s){e.$set(e.modalOrderPayment,"value",s)},expression:"modalOrderPayment.value"}},"ModalPaymentForm",{...e.modalOrderPayment,order:e.order},!1)),e.isLoading?e._e():t("ModalOrderStatus",{attrs:{order:e.order},on:{success:e.onStatusUpdated},model:{value:e.modalOrderStatus.value,callback:function(s){e.$set(e.modalOrderStatus,"value",s)},expression:"modalOrderStatus.value"}}),e.isLoading?e._e():t("ModalOrderDelete",{attrs:{order:e.order},on:{success:e.onOrderDeleted},model:{value:e.modalOrderDelete.value,callback:function(s){e.$set(e.modalOrderDelete,"value",s)},expression:"modalOrderDelete.value"}}),e.isLoading?e._e():t("AppFileModal",{attrs:{id:"orderReport",src:e.modalOrderReport.src,title:"Relatório do pedido"},on:{hidden:e.onCloseModalReport},model:{value:e.modalOrderReport.value,callback:function(s){e.$set(e.modalOrderReport,"value",s)},expression:"modalOrderReport.value"}}),t("div",[t("TheOrderHeader",e._b({staticClass:"mb-2",on:{"open-modal":e.onOpenModal,"toggle-success":e.refreshOrder}},"TheOrderHeader",{order:e.order,isLoading:e.isLoading,isOrderClosed:e.isOrderClosed,isOrderPaid:e.isOrderPaid,isOrderPreRegistered:e.isOrderPreRegistered,isReportLoading:e.modalOrderReport.loading},!1))],1),t("div",{staticClass:"d-flex row flex-column flex-sm-row"},[t("div",{staticClass:"col col-sm-3 mb-2 mb-sm-0"},[t("ClientCard",{attrs:{"is-loading":e.isLoading,client:e.order.client}})],1),t("div",{staticClass:"col col-sm-9"},[t("TheOrderCard",e._b({on:{"on-open-modal":e.onOpenModal}},"TheOrderCard",{isLoading:e.isLoading,isOrderClosed:e.isOrderClosed,isOrderPreRegistered:e.isOrderPreRegistered,order:e.order},!1))],1)])],1)},Js=[],Ws=a(zs,Ks,Js,!1,null,null,null,null);const _r=Ws.exports;export{_r as default};
