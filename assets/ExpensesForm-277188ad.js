import{m as D,a as C}from"./masks-168ccaff.js";import{n as P,L as h,F as x,i as p,a as $,N as V,r as b,s as S,u as g}from"./index-4e05606f.js";import{f as R}from"./filesMixin-04d56c50.js";import{p as Q}from"./pasteFilesMixin-1129ca11.js";import{U as A,b as E,c as T,C as G,a as L}from"./Expense-8b8780bc.js";import{a as N,b as O}from"./DailyCash-da8f8b01.js";import{G as U}from"./Via-eb0eedf9.js";import{G as B}from"./User-8fb57da5.js";import{V as I}from"./ViewerItemsCardFile-0d33846c.js";import{S as q}from"./SelectEntriesFind-d5313c57.js";import{t as z}from"./truncate-000a7a5d.js";import{o as M}from"./omit-49c12860.js";var d={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ExpenseTypeParts"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ExpenseType"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetExpenseTypes"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"expenseTypes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ExpenseTypeParts"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CreateExpenseType"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ExpenseTypesInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"expenseTypesCreate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ExpenseTypeParts"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UpdateExpenseType"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ExpenseTypesInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"expenseTypesUpdate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ExpenseTypeParts"},directives:[]}]}}]}}],loc:{start:0,end:402}};d.loc.source={body:`fragment ExpenseTypeParts on ExpenseType {
  id
  name
}

query GetExpenseTypes {
  expenseTypes {
    ...ExpenseTypeParts
  }
}

mutation CreateExpenseType ($input: ExpenseTypesInput!) {
  expenseTypesCreate (input: $input) {
    ...ExpenseTypeParts
  }
}

mutation UpdateExpenseType ($id: ID! $input: ExpenseTypesInput!) {
  expenseTypesUpdate (id: $id input: $input) {
    ...ExpenseTypeParts
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function m(i,e){if(i.kind==="FragmentSpread")e.add(i.name.value);else if(i.kind==="VariableDefinition"){var t=i.type;t.kind==="NamedType"&&e.add(t.name.value)}i.selectionSet&&i.selectionSet.selections.forEach(function(n){m(n,e)}),i.variableDefinitions&&i.variableDefinitions.forEach(function(n){m(n,e)}),i.definitions&&i.definitions.forEach(function(n){m(n,e)})}var y={};(function(){d.definitions.forEach(function(e){if(e.name){var t=new Set;m(e,t),y[e.name.value]=t}})})();function F(i,e){for(var t=0;t<i.definitions.length;t++){var n=i.definitions[t];if(n.name&&n.name.value==e)return n}}function c(i,e){var t={kind:i.kind,definitions:[F(i,e)]};i.hasOwnProperty("loc")&&(t.loc=i.loc);var n=y[e]||new Set,o=new Set,r=new Set;for(n.forEach(function(a){r.add(a)});r.size>0;){var f=r;r=new Set,f.forEach(function(a){if(!o.has(a)){o.add(a);var s=y[a]||new Set;s.forEach(function(v){r.add(v)})}})}return o.forEach(function(a){var s=F(i,a);s&&t.definitions.push(s)}),t}c(d,"ExpenseTypeParts");const j=c(d,"GetExpenseTypes"),ue=c(d,"CreateExpenseType"),ce=c(d,"UpdateExpenseType");var l={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetProductTypes"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"productTypes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CreateProductType"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NamedType",name:{kind:"Name",value:"ProductTypeInput"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"productTypeCreate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UpdateProductType"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NamedType",name:{kind:"Name",value:"ProductTypeInput"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"productTypeUpdate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:314}};l.loc.source={body:`query GetProductTypes {
  productTypes {
    id
    name
  }
}

mutation CreateProductType ($input: ProductTypeInput) {
  productTypeCreate (input: $input){
    id
    name
  }
}

mutation UpdateProductType ($id: ID! $input: ProductTypeInput) {
  productTypeUpdate (id: $id input: $input) {
    id
    name
  }
}

`,name:"GraphQL request",locationOffset:{line:1,column:1}};function u(i,e){if(i.kind==="FragmentSpread")e.add(i.name.value);else if(i.kind==="VariableDefinition"){var t=i.type;t.kind==="NamedType"&&e.add(t.name.value)}i.selectionSet&&i.selectionSet.selections.forEach(function(n){u(n,e)}),i.variableDefinitions&&i.variableDefinitions.forEach(function(n){u(n,e)}),i.definitions&&i.definitions.forEach(function(n){u(n,e)})}var k={};(function(){l.definitions.forEach(function(e){if(e.name){var t=new Set;u(e,t),k[e.name.value]=t}})})();function w(i,e){for(var t=0;t<i.definitions.length;t++){var n=i.definitions[t];if(n.name&&n.name.value==e)return n}}function _(i,e){var t={kind:i.kind,definitions:[w(i,e)]};i.hasOwnProperty("loc")&&(t.loc=i.loc);var n=k[e]||new Set,o=new Set,r=new Set;for(n.forEach(function(a){r.add(a)});r.size>0;){var f=r;r=new Set,f.forEach(function(a){if(!o.has(a)){o.add(a);var s=k[a]||new Set;s.forEach(function(v){r.add(v)})}})}return o.forEach(function(a){var s=w(i,a);s&&t.definitions.push(s)}),t}const H=_(l,"GetProductTypes"),fe=_(l,"CreateProductType"),ve=_(l,"UpdateProductType"),J=6,K={components:{ViewerItemsCardFile:I,SelectEntriesFind:q},mixins:[R,Q],apollo:{vias:{query:U,result(){this.loadingQueries--}},expenseTypes:{query:j,result(){this.loadingQueries--}},productTypes:{query:H,result(){this.loadingQueries--}},users:{query:B,result(){this.loadingQueries--}},productTypeExpense:{query:h,variables:{name:"app",key:"product_types_expense",encoded:!1},update({configGet:i}){return i},result(){this.loadingQueries--}},employeeExpense:{query:h,variables:{name:"app",key:"employee_expense",encoded:!1},update({configGet:i}){return i},result(){this.loadingQueries--}}},props:{hideBankEntries:{type:Boolean,default:!1},expense:{type:Object,default:()=>({})},isEdit:{type:Boolean,default:!1}},data(){return{maskDate:D,maskCurrencyBRL:C,isLoading:!1,vias:[],productTypeExpense:null,employeeExpense:null,expenseTypes:[],productTypes:[],users:[],loadingQueries:J,bank_entry:"",form:new x({description:"",value:"R$ ",date:"",bank_uid:"",receipt_path:"",expense_type_id:"",product_type_id:"",employee_id:"",expense_via_id:"",filename_entry_from:""})}},computed:{isFromBankEntry(){return!p(this.form.bank_uid)||!p(this.expense.bank_uid)||!p(this.bank_entry)},isQueryLoading(){return this.loadingQueries>0},expenseSelected(){return this.expenseTypes.find(i=>i.id===this.form.expense_type_id)}},watch:{loadingQueries:{immediate:!0,handler(){!this.isQueryLoading&&(this.isEdit||!p(this.expense))&&this.populateForm()}},"form.receipt_path"(){this.form.errors.get("receipt_path")&&this.form.errors.clear("receipt_path")}},beforeDestroy(){this.destroyEventListener()},mounted(){this.attachEventListener()},methods:{formatBytes:$,truncate:z,populateForm(){this.form=new x({...this.form.data(),...M(this.expense,["id","value","date"]),date:V(this.expense.date),value:b(this.expense.value)})},attachEventListener(){document.addEventListener("paste",this.onPasteEvent)},destroyEventListener(){document.removeEventListener("paste",this.onPasteEvent)},afterPaste(i){const e=this.getOnlyValidFiles(i,["pdf","image"]);this.form.receipt_path=e[0]},async onReceiptUploaded(i){const e=await this.getBase64Files(i),t=this.getOnlyValidFiles(e,["pdf","image"]);p(t)||(this.form.receipt_path=t[0])},onDeleteFile(){this.form.receipt_path=""},async onSubmit(){const i=this.getFormattedForm(this.form.data());this.isLoading=!0,this.isEdit?await this.update(i):await this.create(i),this.isLoading=!1},getFormattedForm(){var e;const i=this.form.data();return i.receipt_path=((e=i.receipt_path)==null?void 0:e.base64)||i.receipt_path,i},async update(i){try{await this.$apollo.mutate({mutation:A,variables:{id:this.expense.id,input:i},refetchQueries:[N,E,T],awaitRefetchQueries:!0}),this.$helpers.clearCacheFrom({fieldName:"cashFlowEntries"}),S(this,{message:"Despesa atualizada!"})}catch(e){g(this,e)}},async create(i){try{await this.$apollo.mutate({mutation:G,variables:{input:i},refetchQueries:[L,N,O,E,T],awaitRefetchQueries:!0}),this.$helpers.clearCacheFrom([{fieldName:"expenses"},{fieldName:"cashFlowEntries"},{fieldName:"dailyCash"}]),S(this,{message:"Despesa cadastrada!",resetForm:!0})}catch(e){g(this,e)}},onSelectEntry(i){this.form.set({bank_uid:i.bank_uid,value:b(Math.abs(i.value)),date:i.date,description:i.description})}}};var W=function(){var e=this,t=e._self._c;return t("AppForm",{attrs:{"on-submit":e.onSubmit,form:e.form}},[t("AppLoading",{directives:[{name:"show",rawName:"v-show",value:e.isQueryLoading,expression:"isQueryLoading"}]}),e.form.errors.get("bank_uid")?t("AppAlert",{attrs:{color:"warning",small:""}},[e._v(" "+e._s(e.form.errors.get("bank_uid"))+" ")]):e._e(),e.hideBankEntries?e._e():t("SelectEntriesFind",{attrs:{"is-expense":""},on:{select:e.onSelectEntry},model:{value:e.bank_entry,callback:function(n){e.bank_entry=n},expression:"bank_entry"}}),t("AppInput",{attrs:{id:"description",name:"description",placeholder:"Descrição da despesa...",error:e.form.errors.get("description")},model:{value:e.form.description,callback:function(n){e.$set(e.form,"description",n)},expression:"form.description"}},[e._v(" Descrição ")]),t("AppSimpleSelect",{attrs:{id:"expense_type_id",name:"expense_type_id",options:e.expenseTypes,"label-prop":"name",placeholder:"Selecione um tipo",error:e.form.errors.get("expense_type_id")},model:{value:e.form.expense_type_id,callback:function(n){e.$set(e.form,"expense_type_id",n)},expression:"form.expense_type_id"}},[e._v(" Tipo de despesa ")]),t("AppSimpleSelect",{directives:[{name:"show",rawName:"v-show",value:e.employeeExpense===e.form.expense_type_id,expression:"employeeExpense === form.expense_type_id"}],attrs:{id:"employee_id",options:e.users,name:"employee_id","label-prop":"name",placeholder:"Selecione um funcionário",error:e.form.errors.get("employee_id")},scopedSlots:e._u([e.expenseSelected?{key:"hint",fn:function(){return[e._v(" O campo produto é obrigatório quando a despesa é "),t("b",[e._v(e._s(e.expenseSelected.name))])]},proxy:!0}:null],null,!0),model:{value:e.form.employee_id,callback:function(n){e.$set(e.form,"employee_id",n)},expression:"form.employee_id"}},[e._v(" Funcionário ")]),t("AppSimpleSelect",{directives:[{name:"show",rawName:"v-show",value:e.productTypeExpense===e.form.expense_type_id,expression:"productTypeExpense === form.expense_type_id"}],attrs:{id:"product_type_id",name:"product_type_id",options:e.productTypes,"label-prop":"name",placeholder:"Selecione um produto",error:e.form.errors.get("product_type_id")},scopedSlots:e._u([e.expenseSelected?{key:"hint",fn:function(){return[e._v(" O campo produto é obrigatório quando a despesa é "),t("b",[e._v(e._s(e.expenseSelected.name))])]},proxy:!0}:null],null,!0),model:{value:e.form.product_type_id,callback:function(n){e.$set(e.form,"product_type_id",n)},expression:"form.product_type_id"}},[e._v(" Produto ")]),t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-sm"},[t("AppInput",{attrs:{id:"value",name:"value",mask:e.maskCurrencyBRL(),error:e.form.errors.get("value"),numeric:"",disabled:e.isFromBankEntry},model:{value:e.form.value,callback:function(n){e.$set(e.form,"value",n)},expression:"form.value"}},[e._v(" Valor ")])],1),t("div",{staticClass:"col-12 col-sm"},[t("AppSimpleSelect",{attrs:{id:"expense_via_id",name:"expense_via_id",options:e.vias,"label-prop":"name",error:e.form.errors.get("expense_via_id")},model:{value:e.form.expense_via_id,callback:function(n){e.$set(e.form,"expense_via_id",n)},expression:"form.expense_via_id"}},[e._v(" Via ")])],1)]),t("AppInputFile",{attrs:{id:"receipt_path",accept:"image/*,application/pdf",centered:"",optional:"","default-margin":!1},on:{input:e.onReceiptUploaded}},[e._v(" Comprovante ")]),e.form.receipt_path?t("div",{staticClass:"col-5"},[t("ViewerItemsCardFile",{attrs:{"is-invalid":!!e.form.errors.get("receipt_path"),file:e.form.receipt_path,alt:"Comprovante de pagamento","show-delete-button":""},on:{"delete-file":e.onDeleteFile}}),typeof e.form.receipt_path=="object"?t("div",{staticClass:"small text-secondary text-center"},[e._v(" ("+e._s(e.truncate(e.form.receipt_path.name,{length:15}))+" - "),t("b",[e._v(e._s(e.formatBytes(e.form.receipt_path.size)))]),e._v(") ")]):e._e()],1):e._e(),e.form.errors.get("receipt_path")?t("div",{staticClass:"small text-danger"},[e._v(" "+e._s(e.form.errors.get("receipt_path"))+" ")]):e._e(),t("AppInput",{attrs:{id:"date",name:"date",type:"date",numeric:"",mask:e.maskDate,placeholder:"dd/mm/aaaa",error:e.form.errors.get("date"),"today-button":"",disabled:e.isFromBankEntry},model:{value:e.form.date,callback:function(n){e.$set(e.form,"date",n)},expression:"form.date"}},[e._v(" Data ")]),e.$scopedSlots.footer?e._t("footer",null,{form:e.form,getFormattedForm:e.getFormattedForm}):t("div",{staticClass:"row mt-4"},[t("div",{staticClass:"col"},[t("AppButton",{attrs:{color:"success","btn-class":"fw-bold",loading:e.isLoading,block:""},on:{click:function(n){return n.preventDefault(),e.onSubmit.apply(null,arguments)}}},[e._v(" "+e._s(e.isEdit?"Atualizar":"Registrar")+" ")])],1),t("div",{staticClass:"col"},[t("AppButton",{attrs:{type:"button",color:"light","data-bs-dismiss":"modal",block:""}},[e._v(" Fechar ")])],1)])],2)},X=[],Y=P(K,W,X,!1,null,null,null,null);const Z=Y.exports,ye=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"}));export{ue as C,Z as E,j as G,ce as U,H as a,fe as b,ve as c,ye as d};
